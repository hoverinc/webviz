var ReglWorldview=function(e,t,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r="default"in n?n.default:n;function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function u(e,t){return e(t={exports:{}},t.exports),t.exports}var f="object"==typeof s&&s&&s.Object===Object&&s,l="object"==typeof self&&self&&self.Object===Object&&self,p=f||l||Function("return this")(),d=p.Symbol,h=Object.prototype,m=h.hasOwnProperty,v=h.toString,g=d?d.toStringTag:void 0;var b=function(e){var t=m.call(e,g),n=e[g];try{e[g]=void 0}catch(e){}var r=v.call(e);return t?e[g]=n:delete e[g],r},y=Object.prototype.toString;var x=function(e){return y.call(e)},w="[object Null]",_="[object Undefined]",j=d?d.toStringTag:void 0;var C=function(e){return null==e?void 0===e?_:w:j&&j in Object(e)?b(e):x(e)};var A=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},S="[object AsyncFunction]",E="[object Function]",k="[object GeneratorFunction]",O="[object Proxy]";var M,T=function(e){if(!A(e))return!1;var t=C(e);return t==E||t==k||t==S||t==O},D=p["__core-js_shared__"],P=(M=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"";var z=function(e){return!!P&&P in e},I=Function.prototype.toString;var B=function(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""},F=/^\[object .+?Constructor\]$/,R=Function.prototype,L=Object.prototype,H=R.toString,N=L.hasOwnProperty,W=RegExp("^"+H.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var U=function(e){return!(!A(e)||z(e))&&(T(e)?W:F).test(B(e))};var K=function(e,t){return null==e?void 0:e[t]};var q=function(e,t){var n=K(e,t);return U(n)?n:void 0},G=function(){try{var e=q(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var V=function(e,t,n){"__proto__"==t&&G?G(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var $=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var c=a[e?s:++i];if(!1===n(o[c],c,o))break}return t}}();var Y=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var Z=function(e){return null!=e&&"object"==typeof e},X="[object Arguments]";var Q=function(e){return Z(e)&&C(e)==X},J=Object.prototype,ee=J.hasOwnProperty,te=J.propertyIsEnumerable,ne=Q(function(){return arguments}())?Q:function(e){return Z(e)&&ee.call(e,"callee")&&!te.call(e,"callee")},re=Array.isArray;var ie=function(){return!1},oe=u(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?p.Buffer:void 0,o=(i?i.isBuffer:void 0)||ie;e.exports=o}),ae=9007199254740991,se=/^(?:0|[1-9]\d*)$/;var ce=function(e,t){var n=typeof e;return!!(t=null==t?ae:t)&&("number"==n||"symbol"!=n&&se.test(e))&&e>-1&&e%1==0&&e<t},ue=9007199254740991;var fe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ue},le={};le["[object Float32Array]"]=le["[object Float64Array]"]=le["[object Int8Array]"]=le["[object Int16Array]"]=le["[object Int32Array]"]=le["[object Uint8Array]"]=le["[object Uint8ClampedArray]"]=le["[object Uint16Array]"]=le["[object Uint32Array]"]=!0,le["[object Arguments]"]=le["[object Array]"]=le["[object ArrayBuffer]"]=le["[object Boolean]"]=le["[object DataView]"]=le["[object Date]"]=le["[object Error]"]=le["[object Function]"]=le["[object Map]"]=le["[object Number]"]=le["[object Object]"]=le["[object RegExp]"]=le["[object Set]"]=le["[object String]"]=le["[object WeakMap]"]=!1;var pe=function(e){return Z(e)&&fe(e.length)&&!!le[C(e)]};var de=function(e){return function(t){return e(t)}},he=u(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&f.process,o=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=o}),me=he&&he.isTypedArray,ve=me?de(me):pe,ge=Object.prototype.hasOwnProperty;var be=function(e,t){var n=re(e),r=!n&&ne(e),i=!n&&!r&&oe(e),o=!n&&!r&&!i&&ve(e),a=n||r||i||o,s=a?Y(e.length,String):[],c=s.length;for(var u in e)!t&&!ge.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ce(u,c))||s.push(u);return s},ye=Object.prototype;var xe=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ye)};var we=function(e,t){return function(n){return e(t(n))}},_e=we(Object.keys,Object),je=Object.prototype.hasOwnProperty;var Ce=function(e){if(!xe(e))return _e(e);var t=[];for(var n in Object(e))je.call(e,n)&&"constructor"!=n&&t.push(n);return t};var Ae=function(e){return null!=e&&fe(e.length)&&!T(e)};var Se=function(e){return Ae(e)?be(e):Ce(e)};var Ee=function(e,t){return e&&$(e,t,Se)};var ke=function(){this.__data__=[],this.size=0};var Oe=function(e,t){return e===t||e!=e&&t!=t};var Me=function(e,t){for(var n=e.length;n--;)if(Oe(e[n][0],t))return n;return-1},Te=Array.prototype.splice;var De=function(e){var t=this.__data__,n=Me(t,e);return!(n<0||(n==t.length-1?t.pop():Te.call(t,n,1),--this.size,0))};var Pe=function(e){var t=this.__data__,n=Me(t,e);return n<0?void 0:t[n][1]};var ze=function(e){return Me(this.__data__,e)>-1};var Ie=function(e,t){var n=this.__data__,r=Me(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Be(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Be.prototype.clear=ke,Be.prototype.delete=De,Be.prototype.get=Pe,Be.prototype.has=ze,Be.prototype.set=Ie;var Fe=Be;var Re=function(){this.__data__=new Fe,this.size=0};var Le=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var He=function(e){return this.__data__.get(e)};var Ne=function(e){return this.__data__.has(e)},We=q(p,"Map"),Ue=q(Object,"create");var Ke=function(){this.__data__=Ue?Ue(null):{},this.size=0};var qe=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ge="__lodash_hash_undefined__",Ve=Object.prototype.hasOwnProperty;var $e=function(e){var t=this.__data__;if(Ue){var n=t[e];return n===Ge?void 0:n}return Ve.call(t,e)?t[e]:void 0},Ye=Object.prototype.hasOwnProperty;var Ze=function(e){var t=this.__data__;return Ue?void 0!==t[e]:Ye.call(t,e)},Xe="__lodash_hash_undefined__";var Qe=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ue&&void 0===t?Xe:t,this};function Je(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Je.prototype.clear=Ke,Je.prototype.delete=qe,Je.prototype.get=$e,Je.prototype.has=Ze,Je.prototype.set=Qe;var et=Je;var tt=function(){this.size=0,this.__data__={hash:new et,map:new(We||Fe),string:new et}};var nt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var rt=function(e,t){var n=e.__data__;return nt(t)?n["string"==typeof t?"string":"hash"]:n.map};var it=function(e){var t=rt(this,e).delete(e);return this.size-=t?1:0,t};var ot=function(e){return rt(this,e).get(e)};var at=function(e){return rt(this,e).has(e)};var st=function(e,t){var n=rt(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function ct(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ct.prototype.clear=tt,ct.prototype.delete=it,ct.prototype.get=ot,ct.prototype.has=at,ct.prototype.set=st;var ut=ct,ft=200;var lt=function(e,t){var n=this.__data__;if(n instanceof Fe){var r=n.__data__;if(!We||r.length<ft-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ut(r)}return n.set(e,t),this.size=n.size,this};function pt(e){var t=this.__data__=new Fe(e);this.size=t.size}pt.prototype.clear=Re,pt.prototype.delete=Le,pt.prototype.get=He,pt.prototype.has=Ne,pt.prototype.set=lt;var dt=pt,ht="__lodash_hash_undefined__";var mt=function(e){return this.__data__.set(e,ht),this};var vt=function(e){return this.__data__.has(e)};function gt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ut;++t<n;)this.add(e[t])}gt.prototype.add=gt.prototype.push=mt,gt.prototype.has=vt;var bt=gt;var yt=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var xt=function(e,t){return e.has(t)},wt=1,_t=2;var jt=function(e,t,n,r,i,o){var a=n&wt,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var f=-1,l=!0,p=n&_t?new bt:void 0;for(o.set(e,t),o.set(t,e);++f<s;){var d=e[f],h=t[f];if(r)var m=a?r(h,d,f,t,e,o):r(d,h,f,e,t,o);if(void 0!==m){if(m)continue;l=!1;break}if(p){if(!yt(t,function(e,t){if(!xt(p,t)&&(d===e||i(d,e,n,r,o)))return p.push(t)})){l=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){l=!1;break}}return o.delete(e),o.delete(t),l},Ct=p.Uint8Array;var At=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n};var St=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n},Et=1,kt=2,Ot="[object Boolean]",Mt="[object Date]",Tt="[object Error]",Dt="[object Map]",Pt="[object Number]",zt="[object RegExp]",It="[object Set]",Bt="[object String]",Ft="[object Symbol]",Rt="[object ArrayBuffer]",Lt="[object DataView]",Ht=d?d.prototype:void 0,Nt=Ht?Ht.valueOf:void 0;var Wt=function(e,t,n,r,i,o,a){switch(n){case Lt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Rt:return!(e.byteLength!=t.byteLength||!o(new Ct(e),new Ct(t)));case Ot:case Mt:case Pt:return Oe(+e,+t);case Tt:return e.name==t.name&&e.message==t.message;case zt:case Bt:return e==t+"";case Dt:var s=At;case It:var c=r&Et;if(s||(s=St),e.size!=t.size&&!c)return!1;var u=a.get(e);if(u)return u==t;r|=kt,a.set(e,t);var f=jt(s(e),s(t),r,i,o,a);return a.delete(e),f;case Ft:if(Nt)return Nt.call(e)==Nt.call(t)}return!1};var Ut=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e};var Kt=function(e,t,n){var r=t(e);return re(e)?r:Ut(r,n(e))};var qt=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o};var Gt=function(){return[]},Vt=Object.prototype.propertyIsEnumerable,$t=Object.getOwnPropertySymbols,Yt=$t?function(e){return null==e?[]:(e=Object(e),qt($t(e),function(t){return Vt.call(e,t)}))}:Gt;var Zt=function(e){return Kt(e,Se,Yt)},Xt=1,Qt=Object.prototype.hasOwnProperty;var Jt=function(e,t,n,r,i,o){var a=n&Xt,s=Zt(e),c=s.length;if(c!=Zt(t).length&&!a)return!1;for(var u=c;u--;){var f=s[u];if(!(a?f in t:Qt.call(t,f)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var p=!0;o.set(e,t),o.set(t,e);for(var d=a;++u<c;){var h=e[f=s[u]],m=t[f];if(r)var v=a?r(m,h,f,t,e,o):r(h,m,f,e,t,o);if(!(void 0===v?h===m||i(h,m,n,r,o):v)){p=!1;break}d||(d="constructor"==f)}if(p&&!d){var g=e.constructor,b=t.constructor;g!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(p=!1)}return o.delete(e),o.delete(t),p},en=q(p,"DataView"),tn=q(p,"Promise"),nn=q(p,"Set"),rn=q(p,"WeakMap"),on=B(en),an=B(We),sn=B(tn),cn=B(nn),un=B(rn),fn=C;(en&&"[object DataView]"!=fn(new en(new ArrayBuffer(1)))||We&&"[object Map]"!=fn(new We)||tn&&"[object Promise]"!=fn(tn.resolve())||nn&&"[object Set]"!=fn(new nn)||rn&&"[object WeakMap]"!=fn(new rn))&&(fn=function(e){var t=C(e),n="[object Object]"==t?e.constructor:void 0,r=n?B(n):"";if(r)switch(r){case on:return"[object DataView]";case an:return"[object Map]";case sn:return"[object Promise]";case cn:return"[object Set]";case un:return"[object WeakMap]"}return t});var ln=fn,pn=1,dn="[object Arguments]",hn="[object Array]",mn="[object Object]",vn=Object.prototype.hasOwnProperty;var gn=function(e,t,n,r,i,o){var a=re(e),s=re(t),c=a?hn:ln(e),u=s?hn:ln(t),f=(c=c==dn?mn:c)==mn,l=(u=u==dn?mn:u)==mn,p=c==u;if(p&&oe(e)){if(!oe(t))return!1;a=!0,f=!1}if(p&&!f)return o||(o=new dt),a||ve(e)?jt(e,t,n,r,i,o):Wt(e,t,c,n,r,i,o);if(!(n&pn)){var d=f&&vn.call(e,"__wrapped__"),h=l&&vn.call(t,"__wrapped__");if(d||h){var m=d?e.value():e,v=h?t.value():t;return o||(o=new dt),i(m,v,n,r,o)}}return!!p&&(o||(o=new dt),Jt(e,t,n,r,i,o))};var bn=function e(t,n,r,i,o){return t===n||(null==t||null==n||!Z(t)&&!Z(n)?t!=t&&n!=n:gn(t,n,r,i,e,o))},yn=1,xn=2;var wn=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],u=e[c],f=s[1];if(a&&s[2]){if(void 0===u&&!(c in e))return!1}else{var l=new dt;if(r)var p=r(u,f,c,e,t,l);if(!(void 0===p?bn(f,u,yn|xn,r,l):p))return!1}}return!0};var _n=function(e){return e==e&&!A(e)};var jn=function(e){for(var t=Se(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,_n(i)]}return t};var Cn=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}};var An=function(e){var t=jn(e);return 1==t.length&&t[0][2]?Cn(t[0][0],t[0][1]):function(n){return n===e||wn(n,e,t)}},Sn="[object Symbol]";var En=function(e){return"symbol"==typeof e||Z(e)&&C(e)==Sn},kn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,On=/^\w*$/;var Mn=function(e,t){if(re(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!En(e))||On.test(e)||!kn.test(e)||null!=t&&e in Object(t)},Tn="Expected a function";function Dn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Tn);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Dn.Cache||ut),n}Dn.Cache=ut;var Pn=Dn,zn=500;var In=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Bn=/\\(\\)?/g,Fn=function(e){var t=Pn(e,function(e){return n.size===zn&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(In,function(e,n,r,i){t.push(r?i.replace(Bn,"$1"):n||e)}),t});var Rn=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},Ln=1/0,Hn=d?d.prototype:void 0,Nn=Hn?Hn.toString:void 0;var Wn=function e(t){if("string"==typeof t)return t;if(re(t))return Rn(t,e)+"";if(En(t))return Nn?Nn.call(t):"";var n=t+"";return"0"==n&&1/t==-Ln?"-0":n};var Un=function(e){return null==e?"":Wn(e)};var Kn=function(e,t){return re(e)?e:Mn(e,t)?[e]:Fn(Un(e))},qn=1/0;var Gn=function(e){if("string"==typeof e||En(e))return e;var t=e+"";return"0"==t&&1/e==-qn?"-0":t};var Vn=function(e,t){for(var n=0,r=(t=Kn(t,e)).length;null!=e&&n<r;)e=e[Gn(t[n++])];return n&&n==r?e:void 0};var $n=function(e,t,n){var r=null==e?void 0:Vn(e,t);return void 0===r?n:r};var Yn=function(e,t){return null!=e&&t in Object(e)};var Zn=function(e,t,n){for(var r=-1,i=(t=Kn(t,e)).length,o=!1;++r<i;){var a=Gn(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&fe(i)&&ce(a,i)&&(re(e)||ne(e))};var Xn=function(e,t){return null!=e&&Zn(e,t,Yn)},Qn=1,Jn=2;var er=function(e,t){return Mn(e)&&_n(t)?Cn(Gn(e),t):function(n){var r=$n(n,e);return void 0===r&&r===t?Xn(n,e):bn(t,r,Qn|Jn)}};var tr=function(e){return e};var nr=function(e){return function(t){return null==t?void 0:t[e]}};var rr=function(e){return function(t){return Vn(t,e)}};var ir=function(e){return Mn(e)?nr(Gn(e)):rr(e)};var or=function(e){return"function"==typeof e?e:null==e?tr:"object"==typeof e?re(e)?er(e[0],e[1]):An(e):ir(e)};var ar=function(e,t){var n={};return t=or(t,3),Ee(e,function(e,r,i){V(n,r,t(e,r,i))}),n},sr=Object.prototype.hasOwnProperty;var cr=function(e,t,n){var r=e[t];sr.call(e,t)&&Oe(r,n)&&(void 0!==n||t in e)||V(e,t,n)};var ur=function(e,t,n,r){if(!A(e))return e;for(var i=-1,o=(t=Kn(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var c=Gn(t[i]),u=n;if(i!=a){var f=s[c];void 0===(u=r?r(f,c,s):void 0)&&(u=A(f)?f:ce(t[i+1])?[]:{})}cr(s,c,u),s=s[c]}return e};var fr=function(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=Vn(e,a);n(s,a)&&ur(o,Kn(a,e),s)}return o},lr=we(Object.getPrototypeOf,Object),pr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ut(t,Yt(e)),e=lr(e);return t}:Gt;var dr=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},hr=Object.prototype.hasOwnProperty;var mr=function(e){if(!A(e))return dr(e);var t=xe(e),n=[];for(var r in e)("constructor"!=r||!t&&hr.call(e,r))&&n.push(r);return n};var vr=function(e){return Ae(e)?be(e,!0):mr(e)};var gr=function(e){return Kt(e,vr,pr)};var br=function(e,t){if(null==e)return{};var n=Rn(gr(e),function(e){return[e]});return t=or(t),fr(e,n,function(e,n){return t(e,n[0])})},yr=Object.getOwnPropertySymbols,xr=Object.prototype.hasOwnProperty,wr=Object.prototype.propertyIsEnumerable;var _r=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))xr.call(n,a)&&(i[a]=n[a]);if(yr){r=yr(n);for(var s=0;s<r.length;s++)wr.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i},jr="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Cr=function(){},Ar=jr,Sr={};Cr=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}};var Er=function(e,t,n,r,i){for(var o in e)if(e.hasOwnProperty(o)){var a;try{if("function"!=typeof e[o]){var s=Error((r||"React class")+": "+n+" type `"+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[o]+"`.");throw s.name="Invariant Violation",s}a=e[o](t,o,r,n,null,Ar)}catch(e){a=e}if(!a||a instanceof Error||Cr((r||"React class")+": type specification of "+n+" `"+o+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof a+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),a instanceof Error&&!(a.message in Sr)){Sr[a.message]=!0;var c=i?i():"";Cr("Failed "+n+" type: "+a.message+(null!=c?c:""))}}},kr=function(){};function Or(){return null}kr=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}};var Mr=function(e,t){var n="function"==typeof Symbol&&Symbol.iterator,r="@@iterator";var i="<<anonymous>>",o={array:u("array"),bool:u("boolean"),func:u("function"),number:u("number"),object:u("object"),string:u("string"),symbol:u("symbol"),any:c(Or),arrayOf:function(e){return c(function(t,n,r,i,o){if("function"!=typeof e)return new s("Property `"+o+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var a=t[n];if(!Array.isArray(a)){var c=l(a);return new s("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+r+"`, expected an array.")}for(var u=0;u<a.length;u++){var f=e(a,u,r,i,o+"["+u+"]",jr);if(f instanceof Error)return f}return null})},element:function(){return c(function(t,n,r,i,o){var a=t[n];if(!e(a)){var c=l(a);return new s("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+r+"`, expected a single ReactElement.")}return null})}(),instanceOf:function(e){return c(function(t,n,r,o,a){if(!(t[n]instanceof e)){var c=e.name||i,u=function(e){if(!e.constructor||!e.constructor.name)return i;return e.constructor.name}(t[n]);return new s("Invalid "+o+" `"+a+"` of type `"+u+"` supplied to `"+r+"`, expected instance of `"+c+"`.")}return null})},node:function(){return c(function(e,t,n,r,i){if(!f(e[t]))return new s("Invalid "+r+" `"+i+"` supplied to `"+n+"`, expected a ReactNode.");return null})}(),objectOf:function(e){return c(function(t,n,r,i,o){if("function"!=typeof e)return new s("Property `"+o+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var a=t[n],c=l(a);if("object"!==c)return new s("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+r+"`, expected an object.");for(var u in a)if(a.hasOwnProperty(u)){var f=e(a,u,r,i,o+"."+u,jr);if(f instanceof Error)return f}return null})},oneOf:function(e){if(!Array.isArray(e))return kr("Invalid argument supplied to oneOf, expected an instance of array."),Or;return c(function(t,n,r,i,o){for(var c=t[n],u=0;u<e.length;u++)if(a(c,e[u]))return null;var f=JSON.stringify(e);return new s("Invalid "+i+" `"+o+"` of value `"+c+"` supplied to `"+r+"`, expected one of "+f+".")})},oneOfType:function(e){if(!Array.isArray(e))return kr("Invalid argument supplied to oneOfType, expected an instance of array."),Or;for(var t=0;t<e.length;t++){var n=e[t];if("function"!=typeof n)return kr("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+d(n)+" at index "+t+"."),Or}return c(function(t,n,r,i,o){for(var a=0;a<e.length;a++){var c=e[a];if(null==c(t,n,r,i,o,jr))return null}return new s("Invalid "+i+" `"+o+"` supplied to `"+r+"`.")})},shape:function(e){return c(function(t,n,r,i,o){var a=t[n],c=l(a);if("object"!==c)return new s("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+r+"`, expected `object`.");for(var u in e){var f=e[u];if(f){var p=f(a,u,r,i,o+"."+u,jr);if(p)return p}}return null})},exact:function(e){return c(function(t,n,r,i,o){var a=t[n],c=l(a);if("object"!==c)return new s("Invalid "+i+" `"+o+"` of type `"+c+"` supplied to `"+r+"`, expected `object`.");var u=_r({},t[n],e);for(var f in u){var p=e[f];if(!p)return new s("Invalid "+i+" `"+o+"` key `"+f+"` supplied to `"+r+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var d=p(a,f,r,i,o+"."+f,jr);if(d)return d}return null})}};function a(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s(e){this.message=e,this.stack=""}function c(e){var n={},r=0;function o(o,a,c,u,f,l,p){if(u=u||i,l=l||c,p!==jr){if(t){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}if("undefined"!=typeof console){var h=u+":"+c;!n[h]&&r<3&&(kr("You are manually calling a React.PropTypes validation function for the `"+l+"` prop on `"+u+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),n[h]=!0,r++)}}return null==a[c]?o?null===a[c]?new s("The "+f+" `"+l+"` is marked as required in `"+u+"`, but its value is `null`."):new s("The "+f+" `"+l+"` is marked as required in `"+u+"`, but its value is `undefined`."):null:e(a,c,u,f,l)}var a=o.bind(null,!1);return a.isRequired=o.bind(null,!0),a}function u(e){return c(function(t,n,r,i,o,a){var c=t[n];return l(c)!==e?new s("Invalid "+i+" `"+o+"` of type `"+p(c)+"` supplied to `"+r+"`, expected `"+e+"`."):null})}function f(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(f);if(null===t||e(t))return!0;var i=function(e){var t=e&&(n&&e[n]||e[r]);if("function"==typeof t)return t}(t);if(!i)return!1;var o,a=i.call(t);if(i!==t.entries){for(;!(o=a.next()).done;)if(!f(o.value))return!1}else for(;!(o=a.next()).done;){var s=o.value;if(s&&!f(s[1]))return!1}return!0;default:return!1}}function l(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function p(e){if(null==e)return""+e;var t=l(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function d(e){var t=p(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return s.prototype=Error.prototype,o.checkPropTypes=Er,o.PropTypes=o,o},Tr=u(function(e){var t="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=Mr(function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},!0)}),Dr=u(function(e){(e.exports={}).forEach=function(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}}}),Pr=u(function(e){var t=e.exports={};t.isIE=function(e){return(-1!==(t=navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==t.indexOf("trident")||-1!==t.indexOf(" edge/"))&&(!e||e===function(){var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");do{t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(n[0]);return e>4?e:void 0}());var t},t.isLegacyOpera=function(){return!!window.opera}}),zr=u(function(e){(e.exports={}).getOption=function(e,t,n){var r=e[t];if(null==r&&void 0!==n)return n;return r}}),Ir=function(e){var t=(e=e||{}).reporter,n=zr.getOption(e,"async",!0),r=zr.getOption(e,"auto",!0);r&&!n&&(t&&t.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),n=!0);var i,o=Br(),a=!1;function s(){for(a=!0;o.size();){var e=o;o=Br(),e.process()}a=!1}function c(){var e;e=s,i=setTimeout(e,0)}return{add:function(e,t){!a&&r&&n&&0===o.size()&&c(),o.add(e,t)},force:function(e){a||(void 0===e&&(e=n),i&&(clearTimeout(i),i=null),e?c():s())}}};function Br(){var e={},t=0,n=0,r=0;return{add:function(i,o){o||(o=i,i=0),i>n?n=i:i<r&&(r=i),e[i]||(e[i]=[]),e[i].push(o),t++},process:function(){for(var t=r;t<=n;t++)for(var i=e[t],o=0;o<i.length;o++)(0,i[o])()},size:function(){return t}}}var Fr="_erd";function Rr(e){return e[Fr]}var Lr={initState:function(e){return e[Fr]={},Rr(e)},getState:Rr,cleanState:function(e){delete e[Fr]}},Hr=Dr.forEach,Nr=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,r=e.stateHandler.getState,i=(e.stateHandler.hasState,e.idHandler);if(!n)throw new Error("Missing required dependency: batchProcessor");if(!t)throw new Error("Missing required dependency: reporter.");var o=function(){var e=document.createElement("div");e.style.cssText="position: absolute; width: 1000px; height: 1000px; visibility: hidden; margin: 0; padding: 0;";var t=document.createElement("div");t.style.cssText="position: absolute; width: 500px; height: 500px; overflow: scroll; visibility: none; top: -1500px; left: -1500px; visibility: hidden; margin: 0; padding: 0;",t.appendChild(e),document.body.insertBefore(t,document.body.firstChild);var n=500-t.clientWidth,r=500-t.clientHeight;return document.body.removeChild(t),{width:n,height:r}}(),a="erd_scroll_detection_container";function s(e,n,r){if(e.addEventListener)e.addEventListener(n,r);else{if(!e.attachEvent)return t.error("[scroll] Don't know how to add event listeners.");e.attachEvent("on"+n,r)}}function c(e,n,r){if(e.removeEventListener)e.removeEventListener(n,r);else{if(!e.detachEvent)return t.error("[scroll] Don't know how to remove event listeners.");e.detachEvent("on"+n,r)}}function u(e){return r(e).container.childNodes[0].childNodes[0].childNodes[0]}function f(e){return r(e).container.childNodes[0].childNodes[0].childNodes[1]}return function(e,t){if(!document.getElementById(e)){var n=t+"_animation",r=t+"_animation_active",i="/* Created by the element-resize-detector library. */\n";i+="."+t+" > div::-webkit-scrollbar { display: none; }\n\n",i+="."+r+" { -webkit-animation-duration: 0.1s; animation-duration: 0.1s; -webkit-animation-name: "+n+"; animation-name: "+n+"; }\n",i+="@-webkit-keyframes "+n+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n",function(t,n){n=n||function(e){document.head.appendChild(e)};var r=document.createElement("style");r.innerHTML=t,r.id=e,n(r)}(i+="@keyframes "+n+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }")}}("erd_scroll_detection_scrollbar_style",a),{makeDetectable:function(e,c,l){function p(){if(e.debug){var n=Array.prototype.slice.call(arguments);if(n.unshift(i.get(c),"Scroll: "),t.log.apply)t.log.apply(null,n);else for(var r=0;r<n.length;r++)t.log(n[r])}}function d(e){var t=r(e).container.childNodes[0],n=window.getComputedStyle(t);return!n.width||-1===n.width.indexOf("px")}function h(){var e=window.getComputedStyle(c),t={};return t.position=e.position,t.width=c.offsetWidth,t.height=c.offsetHeight,t.top=e.top,t.right=e.right,t.bottom=e.bottom,t.left=e.left,t.widthCSS=e.width,t.heightCSS=e.height,t}function m(){if(p("storeStyle invoked."),r(c)){var e=h();r(c).style=e}else p("Aborting because element has been uninstalled")}function v(e,t,n){r(e).lastWidth=t,r(e).lastHeight=n}function g(){return 2*o.width+1}function b(){return 2*o.height+1}function y(e){return e+10+g()}function x(e){return e+10+b()}function w(e,t,n){var r=u(e),i=f(e),o=y(t),a=x(n),s=function(e){return 2*e+g()}(t),c=function(e){return 2*e+b()}(n);r.scrollLeft=o,r.scrollTop=a,i.scrollLeft=s,i.scrollTop=c}function _(){var e=r(c).container;if(!e){(e=document.createElement("div")).className=a,e.style.cssText="visibility: hidden; display: inline; width: 0px; height: 0px; z-index: -1; overflow: hidden; margin: 0; padding: 0;",r(c).container=e,function(e){e.className+=" "+a+"_animation_active"}(e),c.appendChild(e);var t=function(){r(c).onRendered&&r(c).onRendered()};s(e,"animationstart",t),r(c).onAnimationStart=t}return e}function j(){if(p("Injecting elements"),r(c)){!function(){var e=r(c).style;if("static"===e.position){c.style.position="relative";var n=function(e,t,n,r){var i=n[r];"auto"!==i&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(i)&&(e.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",t),t.style[r]=0)};n(t,c,e,"top"),n(t,c,e,"right"),n(t,c,e,"bottom"),n(t,c,e,"left")}}();var e=r(c).container;e||(e=_());var n,i,u,f,l=o.width,d=o.height,h="position: absolute; flex: none; overflow: hidden; z-index: -1; visibility: hidden; left: "+(n=(n=-(1+l))?n+"px":"0")+"; top: "+(i=(i=-(1+d))?i+"px":"0")+"; right: "+(f=(f=-l)?f+"px":"0")+"; bottom: "+(u=(u=-d)?u+"px":"0")+";",m=document.createElement("div"),v=document.createElement("div"),g=document.createElement("div"),b=document.createElement("div"),y=document.createElement("div"),x=document.createElement("div");m.dir="ltr",m.style.cssText="position: absolute; flex: none; overflow: hidden; z-index: -1; visibility: hidden; width: 100%; height: 100%; left: 0px; top: 0px;",m.className=a,v.className=a,v.style.cssText=h,g.style.cssText="position: absolute; flex: none; overflow: scroll; z-index: -1; visibility: hidden; width: 100%; height: 100%;",b.style.cssText="position: absolute; left: 0; top: 0;",y.style.cssText="position: absolute; flex: none; overflow: scroll; z-index: -1; visibility: hidden; width: 100%; height: 100%;",x.style.cssText="position: absolute; width: 200%; height: 200%;",g.appendChild(b),y.appendChild(x),v.appendChild(g),v.appendChild(y),m.appendChild(v),e.appendChild(m),s(g,"scroll",w),s(y,"scroll",j),r(c).onExpandScroll=w,r(c).onShrinkScroll=j}else p("Aborting because element has been uninstalled");function w(){r(c).onExpand&&r(c).onExpand()}function j(){r(c).onShrink&&r(c).onShrink()}}function C(){function o(e,t,n){var r=function(e){return u(e).childNodes[0]}(e),i=y(t),o=x(n);r.style.width=i+"px",r.style.height=o+"px"}function a(a){var u=c.offsetWidth,f=c.offsetHeight;p("Storing current size",u,f),v(c,u,f),n.add(0,function(){if(r(c))if(s()){if(e.debug){var n=c.offsetWidth,a=c.offsetHeight;n===u&&a===f||t.warn(i.get(c),"Scroll: Size changed before updating detector elements.")}o(c,u,f)}else p("Aborting because element container has not been initialized");else p("Aborting because element has been uninstalled")}),n.add(1,function(){r(c)?s()?w(c,u,f):p("Aborting because element container has not been initialized"):p("Aborting because element has been uninstalled")}),a&&n.add(2,function(){r(c)?s()?a():p("Aborting because element container has not been initialized"):p("Aborting because element has been uninstalled")})}function s(){return!!r(c).container}function l(){p("notifyListenersIfNeeded invoked");var e=r(c);return void 0===r(c).lastNotifiedWidth&&e.lastWidth===e.startSize.width&&e.lastHeight===e.startSize.height?p("Not notifying: Size is the same as the start size, and there has been no notification yet."):e.lastWidth===e.lastNotifiedWidth&&e.lastHeight===e.lastNotifiedHeight?p("Not notifying: Size already notified"):(p("Current size not notified, notifying..."),e.lastNotifiedWidth=e.lastWidth,e.lastNotifiedHeight=e.lastHeight,void Hr(r(c).listeners,function(e){e(c)}))}function h(){if(p("Scroll detected."),d(c))p("Scroll event fired while unrendered. Ignoring...");else{var e=c.offsetWidth,t=c.offsetHeight;e!==r(c).lastWidth||t!==r(c).lastHeight?(p("Element size changed."),a(l)):p("Element size has not changed ("+e+"x"+t+").")}}if(p("registerListenersAndPositionElements invoked."),r(c)){r(c).onRendered=function(){if(p("startanimation triggered."),d(c))p("Ignoring since element is still unrendered...");else{p("Element rendered.");var e=u(c),t=f(c);0!==e.scrollLeft&&0!==e.scrollTop&&0!==t.scrollLeft&&0!==t.scrollTop||(p("Scrollbars out of sync. Updating detector elements..."),a(l))}},r(c).onExpand=h,r(c).onShrink=h;var m=r(c).style;o(c,m.width,m.height)}else p("Aborting because element has been uninstalled")}function A(){if(p("finalizeDomMutation invoked."),r(c)){var e=r(c).style;v(c,e.width,e.height),w(c,e.width,e.height)}else p("Aborting because element has been uninstalled")}function S(){l(c)}function E(){var e;p("Installing..."),r(c).listeners=[],e=h(),r(c).startSize={width:e.width,height:e.height},p("Element start size",r(c).startSize),n.add(0,m),n.add(1,j),n.add(2,C),n.add(3,A),n.add(4,S)}l||(l=c,c=e,e=null),e=e||{},p("Making detectable..."),function(e){return!function(e){return e===e.ownerDocument.body||e.ownerDocument.body.contains(e)}(e)||null===window.getComputedStyle(e)}(c)?(p("Element is detached"),_(),p("Waiting until element is attached..."),r(c).onRendered=function(){p("Element is now attached"),E()}):E()},addListener:function(e,t){if(!r(e).listeners.push)throw new Error("Cannot add listener to an element that is not detectable.");r(e).listeners.push(t)},uninstall:function(e){var t=r(e);t&&(t.onExpandScroll&&c(u(e),"scroll",t.onExpandScroll),t.onShrinkScroll&&c(f(e),"scroll",t.onShrinkScroll),t.onAnimationStart&&c(t.container,"animationstart",t.onAnimationStart),t.container&&e.removeChild(t.container))}}},Wr=Dr.forEach;function Ur(e){return Array.isArray(e)||void 0!==e.length}function Kr(e){if(Array.isArray(e))return e;var t=[];return Wr(e,function(e){t.push(e)}),t}function qr(e){return e&&1===e.nodeType}var Gr=function(e){var t;if((e=e||{}).idHandler)t={get:function(t){return e.idHandler.get(t,!0)},set:e.idHandler.set};else{var n=function(e){var t=e.idGenerator,n=e.stateHandler.getState;return{get:function(e){var t=n(e);return t&&void 0!==t.id?t.id:null},set:function(e){var r=n(e);if(!r)throw new Error("setId required the element to have a resize detection state.");var i=t.generate();return r.id=i,i}}}({idGenerator:function(){var e=1;return{generate:function(){return e++}}}(),stateHandler:Lr});t=n}var r=e.reporter;r||(r=function(e){function t(){}var n={log:t,warn:t,error:t};if(!e&&window.console){var r=function(e,t){e[t]=function(){var e=console[t];if(e.apply)e.apply(console,arguments);else for(var n=0;n<arguments.length;n++)e(arguments[n])}};r(n,"log"),r(n,"warn"),r(n,"error")}return n}(!1===r));var i=Vr(e,"batchProcessor",Ir({reporter:r})),o={};o.callOnAdd=!!Vr(e,"callOnAdd",!0),o.debug=!!Vr(e,"debug",!1);var a,s=function(e){var t={};function n(n){var r=e.get(n);return void 0===r?[]:t[r]||[]}return{get:n,add:function(n,r){var i=e.get(n);t[i]||(t[i]=[]),t[i].push(r)},removeListener:function(e,t){for(var r=n(e),i=0,o=r.length;i<o;++i)if(r[i]===t){r.splice(i,1);break}},removeAllListeners:function(e){var t=n(e);t&&(t.length=0)}}}(t),c=function(e){var t=e.stateHandler.getState;return{isDetectable:function(e){var n=t(e);return n&&!!n.isDetectable},markAsDetectable:function(e){t(e).isDetectable=!0},isBusy:function(e){return!!t(e).busy},markBusy:function(e,n){t(e).busy=!!n}}}({stateHandler:Lr}),u=Vr(e,"strategy","object"),f={reporter:r,batchProcessor:i,stateHandler:Lr,idHandler:t};if("scroll"===u&&(Pr.isLegacyOpera()?(r.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),u="object"):Pr.isIE(9)&&(r.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),u="object")),"scroll"===u)a=Nr(f);else{if("object"!==u)throw new Error("Invalid strategy name: "+u);a=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,r=e.stateHandler.getState;if(!t)throw new Error("Missing required dependency: reporter.");function i(e){return r(e).object}return{makeDetectable:function(e,i,o){o||(o=i,i=e,e=null),(e=e||{}).debug,Pr.isIE(8)?o(i):function(e,i){var o="display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; padding: 0; margin: 0; opacity: 0; z-index: -1000; pointer-events: none;",a=!1,s=window.getComputedStyle(e),c=e.offsetWidth,u=e.offsetHeight;function f(){function n(){if("static"===s.position){e.style.position="relative";var n=function(e,t,n,r){var i=n[r];"auto"!==i&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(i)&&(e.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",t),t.style[r]=0)};n(t,e,s,"top"),n(t,e,s,"right"),n(t,e,s,"bottom"),n(t,e,s,"left")}}""!==s.position&&(n(),a=!0);var c=document.createElement("object");c.style.cssText=o,c.tabIndex=-1,c.type="text/html",c.onload=function(){a||n(),function e(t,n){t.contentDocument?n(t.contentDocument):setTimeout(function(){e(t,n)},100)}(this,function(t){i(e)})},Pr.isIE()||(c.data="about:blank"),e.appendChild(c),r(e).object=c,Pr.isIE()&&(c.data="about:blank")}r(e).startSize={width:c,height:u},n?n.add(f):f()}(i,o)},addListener:function(e,t){if(!i(e))throw new Error("Element is not detectable by this strategy.");function n(){t(e)}Pr.isIE(8)?(r(e).object={proxy:n},e.attachEvent("onresize",n)):i(e).contentDocument.defaultView.addEventListener("resize",n)},uninstall:function(e){Pr.isIE(8)?e.detachEvent("onresize",r(e).object.proxy):e.removeChild(i(e)),delete r(e).object}}}(f)}var l={};return{listenTo:function(e,n,i){function u(e){var t=s.get(e);Wr(t,function(t){t(e)})}function f(e,t,n){s.add(t,n),e&&n(t)}if(i||(i=n,n=e,e={}),!n)throw new Error("At least one element required.");if(!i)throw new Error("Listener required.");if(qr(n))n=[n];else{if(!Ur(n))return r.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");n=Kr(n)}var p=0,d=Vr(e,"callOnAdd",o.callOnAdd),h=Vr(e,"onReady",function(){}),m=Vr(e,"debug",o.debug);Wr(n,function(e){Lr.getState(e)||(Lr.initState(e),t.set(e));var o=t.get(e);if(m&&r.log("Attaching listener to element",o,e),!c.isDetectable(e))return m&&r.log(o,"Not detectable."),c.isBusy(e)?(m&&r.log(o,"System busy making it detectable"),f(d,e,i),l[o]=l[o]||[],void l[o].push(function(){++p===n.length&&h()})):(m&&r.log(o,"Making detectable..."),c.markBusy(e,!0),a.makeDetectable({debug:m},e,function(e){if(m&&r.log(o,"onElementDetectable"),Lr.getState(e)){c.markAsDetectable(e),c.markBusy(e,!1),a.addListener(e,u),f(d,e,i);var t=Lr.getState(e);if(t&&t.startSize){var s=e.offsetWidth,v=e.offsetHeight;t.startSize.width===s&&t.startSize.height===v||u(e)}l[o]&&Wr(l[o],function(e){e()})}else m&&r.log(o,"Element uninstalled before being detectable.");delete l[o],++p===n.length&&h()}));m&&r.log(o,"Already detecable, adding listener."),f(d,e,i),p++}),p===n.length&&h()},removeListener:s.removeListener,removeAllListeners:s.removeAllListeners,uninstall:function(e){if(!e)return r.error("At least one element is required.");if(qr(e))e=[e];else{if(!Ur(e))return r.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");e=Kr(e)}Wr(e,function(e){s.removeAllListeners(e),a.uninstall(e),Lr.cleanState(e)})}}};function Vr(e,t,n){var r=e[t];return null==r&&void 0!==n?n:r}var $r=function(e,t,n,r,i,o,a,s){if(void 0===t)throw new Error("invariant requires an error message argument");if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,r,i,o,a,s],f=0;(c=new Error(t.replace(/%s/g,function(){return u[f++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}},Yr=c(u(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=l(r),s=l(Tr),c=l(t),u=l(Gr),f=l($r);function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={initiated:!1},e.onResize=e.onResize.bind(e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Component),o(t,null,[{key:"getDomNodeDimensions",value:function(e){var t=e.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height}}}]),o(t,[{key:"componentDidMount",value:function(){this.parentNode=c.default.findDOMNode(this).parentNode,this.elementResizeDetector=(0,u.default)({strategy:"scroll",callOnAdd:!1}),this.elementResizeDetector.listenTo(this.parentNode,this.onResize),this.onResize()}},{key:"componentWillUnmount",value:function(){this.elementResizeDetector.uninstall(this.parentNode)}},{key:"onResize",value:function(){var e=t.getDomNodeDimensions(this.parentNode);this.setState(i({initiated:!0},e))}},{key:"render",value:function(){if((0,f.default)(this.props.children,"Expected children to be one of function or React.Element"),!this.state.initiated)return a.default.createElement("div",null);if("function"==typeof this.props.children){var e=this.props.children(this.state);return e&&r.Children.only(e)}return r.Children.only(a.default.cloneElement(this.props.children,this.state))}}]),t}();p.propTypes={children:s.default.oneOfType([s.default.element,s.default.func]).isRequired},n.default=p})),Zr=1e-6,Xr="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function Qr(){var e=new Xr(16);return Xr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Jr(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],f=t[8],l=t[9],p=t[10],d=t[11],h=t[12],m=t[13],v=t[14],g=t[15],b=n*s-r*a,y=n*c-i*a,x=n*u-o*a,w=r*c-i*s,_=r*u-o*s,j=i*u-o*c,C=f*m-l*h,A=f*v-p*h,S=f*g-d*h,E=l*v-p*m,k=l*g-d*m,O=p*g-d*v,M=b*O-y*k+x*E+w*S-_*A+j*C;return M?(M=1/M,e[0]=(s*O-c*k+u*E)*M,e[1]=(i*k-r*O-o*E)*M,e[2]=(m*j-v*_+g*w)*M,e[3]=(p*_-l*j-d*w)*M,e[4]=(c*S-a*O-u*A)*M,e[5]=(n*O-i*S+o*A)*M,e[6]=(v*x-h*j-g*y)*M,e[7]=(f*j-p*x+d*y)*M,e[8]=(a*k-s*S+u*C)*M,e[9]=(r*S-n*k-o*C)*M,e[10]=(h*_-m*x+g*b)*M,e[11]=(l*x-f*_-d*b)*M,e[12]=(s*A-a*E-c*C)*M,e[13]=(n*E-r*A+i*C)*M,e[14]=(m*y-h*w-v*b)*M,e[15]=(f*w-l*y+p*b)*M,e):null}function ei(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],f=t[7],l=t[8],p=t[9],d=t[10],h=t[11],m=t[12],v=t[13],g=t[14],b=t[15],y=n[0],x=n[1],w=n[2],_=n[3];return e[0]=y*r+x*s+w*l+_*m,e[1]=y*i+x*c+w*p+_*v,e[2]=y*o+x*u+w*d+_*g,e[3]=y*a+x*f+w*h+_*b,y=n[4],x=n[5],w=n[6],_=n[7],e[4]=y*r+x*s+w*l+_*m,e[5]=y*i+x*c+w*p+_*v,e[6]=y*o+x*u+w*d+_*g,e[7]=y*a+x*f+w*h+_*b,y=n[8],x=n[9],w=n[10],_=n[11],e[8]=y*r+x*s+w*l+_*m,e[9]=y*i+x*c+w*p+_*v,e[10]=y*o+x*u+w*d+_*g,e[11]=y*a+x*f+w*h+_*b,y=n[12],x=n[13],w=n[14],_=n[15],e[12]=y*r+x*s+w*l+_*m,e[13]=y*i+x*c+w*p+_*v,e[14]=y*o+x*u+w*d+_*g,e[15]=y*a+x*f+w*h+_*b,e}function ti(e,t,n){var r=n[0],i=n[1],o=n[2],a=void 0,s=void 0,c=void 0,u=void 0,f=void 0,l=void 0,p=void 0,d=void 0,h=void 0,m=void 0,v=void 0,g=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*o+t[12],e[13]=t[1]*r+t[5]*i+t[9]*o+t[13],e[14]=t[2]*r+t[6]*i+t[10]*o+t[14],e[15]=t[3]*r+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],c=t[2],u=t[3],f=t[4],l=t[5],p=t[6],d=t[7],h=t[8],m=t[9],v=t[10],g=t[11],e[0]=a,e[1]=s,e[2]=c,e[3]=u,e[4]=f,e[5]=l,e[6]=p,e[7]=d,e[8]=h,e[9]=m,e[10]=v,e[11]=g,e[12]=a*r+f*i+h*o+t[12],e[13]=s*r+l*i+m*o+t[13],e[14]=c*r+p*i+v*o+t[14],e[15]=u*r+d*i+g*o+t[15]),e}function ni(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],c=t[7],u=t[8],f=t[9],l=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+u*r,e[5]=a*i+f*r,e[6]=s*i+l*r,e[7]=c*i+p*r,e[8]=u*i-o*r,e[9]=f*i-a*r,e[10]=l*i-s*r,e[11]=p*i-c*r,e}function ri(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],c=t[3],u=t[8],f=t[9],l=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-u*r,e[1]=a*i-f*r,e[2]=s*i-l*r,e[3]=c*i-p*r,e[8]=o*r+u*i,e[9]=a*r+f*i,e[10]=s*r+l*i,e[11]=c*r+p*i,e}function ii(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],c=i+i,u=o+o,f=a+a,l=i*c,p=i*u,d=i*f,h=o*u,m=o*f,v=a*f,g=s*c,b=s*u,y=s*f,x=r[0],w=r[1],_=r[2];return e[0]=(1-(h+v))*x,e[1]=(p+y)*x,e[2]=(d-b)*x,e[3]=0,e[4]=(p-y)*w,e[5]=(1-(l+v))*w,e[6]=(m+g)*w,e[7]=0,e[8]=(d+b)*_,e[9]=(m-g)*_,e[10]=(1-(l+h))*_,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}var oi=ei;function ai(){var e=new Xr(3);return Xr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function si(e,t,n){var r=new Xr(3);return r[0]=e,r[1]=t,r[2]=n,r}function ci(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ui(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function fi(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function li(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function pi(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function di(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function hi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function mi(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],c=n[2];return e[0]=i*c-o*s,e[1]=o*a-r*c,e[2]=r*s-i*a,e}function vi(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function gi(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],c=t[1],u=t[2],f=i*u-o*c,l=o*s-r*u,p=r*c-i*s,d=i*p-o*l,h=o*f-r*p,m=r*l-i*f,v=2*a;return f*=v,l*=v,p*=v,d*=2,h*=2,m*=2,e[0]=s+f+d,e[1]=c+l+h,e[2]=u+p+m,e}var bi,yi=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)};bi=ai();!function(){var e,t=(e=new Xr(4),Xr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function xi(){var e=new Xr(4);return Xr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function wi(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function _i(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c-o*s,e[1]=i*c+a*s,e[2]=o*c+r*s,e[3]=a*c-i*s,e}function ji(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],c=n[0],u=n[1],f=n[2],l=n[3],p=void 0,d=void 0,h=void 0,m=void 0,v=void 0;return(d=i*c+o*u+a*f+s*l)<0&&(d=-d,c=-c,u=-u,f=-f,l=-l),1-d>Zr?(p=Math.acos(d),h=Math.sin(p),m=Math.sin((1-r)*p)/h,v=Math.sin(r*p)/h):(m=1-r,v=r),e[0]=m*i+v*c,e[1]=m*o+v*u,e[2]=m*a+v*f,e[3]=m*s+v*l,e}var Ci,Ai,Si,Ei,ki,Oi,Mi,Ti=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a),e},Di=(Ci=ai(),Ai=si(1,0,0),Si=si(0,1,0),function(e,t,n){var r=hi(t,n);return r<-.999999?(mi(Ci,Ai,t),yi(Ci)<1e-6&&mi(Ci,Si,t),di(Ci,Ci),wi(e,Ci,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(mi(Ci,t,n),e[0]=Ci[0],e[1]=Ci[1],e[2]=Ci[2],e[3]=1+r,Ti(e,e))});Ei=xi(),ki=xi(),Oi=new Xr(9),Xr!=Float32Array&&(Oi[1]=0,Oi[2]=0,Oi[3]=0,Oi[5]=0,Oi[6]=0,Oi[7]=0),Oi[0]=1,Oi[4]=1,Oi[8]=1,Mi=Oi;!function(){var e,t=(e=new Xr(2),Xr!=Float32Array&&(e[0]=0,e[1]=0),e)}();class Pi{constructor(e,t){o(this,"left",void 0),o(this,"right",void 0),o(this,"top",void 0),o(this,"bottom",void 0),o(this,"width",void 0),o(this,"height",void 0),this.left=e,this.top=t,this.right=-e,this.bottom=-t,this.width=2*Math.abs(e),this.height=2*Math.abs(t)}}function zi(e,t,n){const r=t/n,i=Math.abs(e);return new Pi(-i/2*r,i/2)}const Ii=0,Bi=1,Fi=[0,0,0,0];var Ri=u(function(e,t){function n(e,t){return e===t}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=null,i=null;return function(){return function(e,t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var r=t.length,i=0;i<r;i++)if(!e(t[i],n[i]))return!1;return!0}(t,r,arguments)||(i=e.apply(null,arguments)),r=arguments,i}}function i(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];var a=0,s=i.pop(),c=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every(function(e){return"function"==typeof e})){var n=t.map(function(e){return typeof e}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return t}(i),u=e.apply(void 0,[function(){return a++,s.apply(null,arguments)}].concat(n)),f=r(function(){for(var e=[],t=c.length,n=0;n<t;n++)e.push(c[n].apply(null,arguments));return u.apply(null,e)});return f.resultFunc=s,f.recomputations=function(){return a},f.resetRecomputations=function(){return a=0},f}}t.__esModule=!0,t.defaultMemoize=r,t.createSelectorCreator=i,t.createStructuredSelector=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;if("object"!=typeof e)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);var n=Object.keys(e);return t(n.map(function(t){return e[t]}),function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t,r){return e[n[r]]=t,e},{})})};var o=t.createSelector=i(r)});c(Ri);Ri.defaultMemoize,Ri.createSelectorCreator,Ri.createStructuredSelector;var Li=Ri.createSelector;const Hi="\n  uniform vec3 _position;\n  uniform vec4 _rotation;\n\n  // rotate a 3d point v by a rotation quaternion q\n  vec3 rotate(vec3 v, vec4 q) {\n    vec3 temp = cross(q.xyz, v) + q.w * v;\n    return v + (2.0 * cross(q.xyz, temp));\n  }\n\n  vec3 applyPose(vec3 point) {\n    // rotate the point and then add the position of the pose\n    return rotate(point, _rotation) + _position;\n  }\n",Ni={r:1,g:1,b:1,a:1},Wi=({x:e,y:t,z:n})=>[e,t,n],Ui=({x:e,y:t,z:n,w:r})=>[e,t,n,r],Ki=([e,t,n])=>({x:e,y:t,z:n}),qi=([e,t,n,r])=>({x:e,y:t,z:n,w:r}),Gi=e=>{const t=new Float32Array(3*e.length);let n=0;for(const r of e){const{x:e,y:i,z:o}=r;t[n++]=e,t[n++]=i,t[n++]=o}return t},Vi=e=>[e.r,e.g,e.b,e.a],$i=e=>({r:e[0],g:e[1],b:e[2],a:e[3]});function Yi(e=Ni){const{r:t,g:n,b:r,a:i}=e;return`rgba(${(255*t).toFixed()}, ${(255*n).toFixed()}, ${(255*r).toFixed()}, ${i.toFixed(3)})`}const Zi=e=>{const t=new Float32Array(4*e.length);let n=0;for(const r of e){const{r:e,g:i,b:o,a:a}=r;t[n++]=e,t[n++]=i,t[n++]=o,t[n++]=a}return t},Xi=(e,{r:t,g:n,b:r,a:i})=>{const o=new Float32Array(4*e);for(let a=0;a<e;a++)o[4*a+0]=t,o[4*a+1]=n,o[4*a+2]=r,o[4*a+3]=i;return o},Qi={enable:!0,func:{src:"src alpha",dst:"one minus src alpha",srcAlpha:1,dstAlpha:"one minus src alpha"},equation:{rgb:"add",alpha:"add"}},Ji={enable:!0,mask:!0},eo={enable:(e,t)=>t.depth&&t.depth.enable||Ji.enable,mask:(e,t)=>t.depth&&t.depth.mask||Ji.mask},to=a({},Qi,{enable:(e,t)=>t.blend&&t.blend.enable||Qi.enable,func:(e,t)=>t.blend&&t.blend.func||Qi.func}),no=to;function ro(e){const{vert:t,uniforms:n}=e,r=t.replace("#WITH_POSE",Hi),i=a({},n,{_position:(e,t)=>{const{position:n}=t.pose;return Array.isArray(n)?n:Wi(n)},_rotation:(e,t)=>{const{orientation:n}=t.pose;return Array.isArray(n)?n:[n.x,n.y,n.z,n.w]}});return a({},e,{vert:r,uniforms:i})}function io({colors:e,color:t,points:n}){return e&&e.length||!t?e?ao(e)?Zi(e):e:[]:Xi(n.length,t)}function oo(e){const t=e.buffer({usage:"dynamic",data:[]});return function(e,n,r){let i,o;return n&&n.length?(i=ao(n)?Zi(n):n,o=1):(i=ao(e)?Vi(e):e,o=r),{buffer:t({usage:"dynamic",data:i}),divisor:o}}}function ao(e){return!(!e||(t=e,t.length&&Array.isArray(t[0]))||!isNaN(e[0]));var t}function so(e=0){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]}function co(e){const t=e[0],n=e[1];return e[2]|n<<8|t<<16}function uo(e,t=1){const n={};for(let t=0;t<e.length;t+=4){const r=e[t],i=e[t+1],o=e[t+2]|i<<8|r<<16;if(o){const e=n[o]||0;n[o]=e+1}}return 1===t?Object.keys(n):Object.keys(n).filter(e=>n[e]>=t)}function fo(e,t,n,r){const i=t*Math.sin(r);return e[0]=i*Math.sin(n),e[1]=t*Math.cos(r),e[2]=i*Math.cos(n),e}const lo=Object.freeze([1,0,0]),po=[0,0,0],ho=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],mo=[0,0,0,0],vo=e=>e,go=Li(vo,({perspective:e})=>e),bo=Li(vo,({distance:e})=>e),yo=Li(vo,({phi:e})=>e),xo=Li(vo,({thetaOffset:e})=>e),wo=Li(vo,({targetOrientation:e})=>e),_o=Li(wo,e=>{const t=gi(po,lo,e);return-Math.atan2(t[1],t[0])}),jo=Li(vo,({roll:e})=>e||0),Co=Li(go,yo,xo,jo,(e,t,n,r)=>{const i=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}([0,0,0,0]);return function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=r*c+i*s,e[1]=i*c-r*s,e[2]=o*c+a*s,e[3]=a*c-o*s}(i,i,-n),e&&(_i(i,i,r),function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=r*c+a*s,e[1]=i*c+o*s,e[2]=o*c-i*s,e[3]=a*c-r*s}(i,i,t)),i}),Ao=Li(xo,yo,bo,(e,t,n)=>{const r=fo([],n,e,t),[i,o,a]=r;return r[0]=-i,r[1]=-a,r[2]=o,r});var So={orientation:Co,position:Ao,targetHeading:_o,view:Li(vo,Co,Ao,_o,({target:e,targetOffset:t,perspective:n,viewMatrix:r},i,o,a)=>{const s=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);return ei(s,s,function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,c=i+i,u=n*a,f=r*a,l=r*s,p=i*a,d=i*s,h=i*c,m=o*a,v=o*s,g=o*c;return e[0]=1-l-h,e[1]=f+g,e[2]=p-v,e[3]=0,e[4]=f-g,e[5]=1-u-h,e[6]=d+m,e[7]=0,e[8]=p+v,e[9]=d-m,e[10]=1-u-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(ho,function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e}(mo,i))),n&&ti(s,s,pi(po,o)),ti(s,s,pi(po,t)),function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],c=t[3],u=t[4],f=t[5],l=t[6],p=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+u*r,e[1]=a*i+f*r,e[2]=s*i+l*r,e[3]=c*i+p*r,e[4]=u*i-o*r,e[5]=f*i-a*r,e[6]=l*i-s*r,e[7]=p*i-c*r}(s,s,a),pi(po,e),n||(po[2]=-2500),ti(s,s,po),r||s})};const Eo=Object.freeze([0,0,1]),ko=[0,0,0,0],Oo={distance:75,perspective:!0,phi:Math.PI/4,target:[0,0,0],targetOffset:[0,0,0],targetOrientation:[0,0,0,1],thetaOffset:0,fovy:Math.PI/4,near:.01,far:5e3};class Mo{constructor(e=(()=>{}),t=Oo){o(this,"state",void 0),o(this,"_onChange",void 0),o(this,"setCameraState",e=>{for(const[t,n]of Object.entries(Oo))null==e[t]&&(e[t]=n);this.state=e}),o(this,"cameraRotate",([e,t])=>{if(0===e&&0===t)return;const{thetaOffset:n,phi:r}=this.state;this.setCameraState(a({},this.state,{thetaOffset:n-e,phi:Math.max(0,Math.min(r+t,Math.PI))})),this._onChange(this.state)}),o(this,"cameraMove",([e,t])=>{if(0===e&&0===t)return;const{targetOffset:n,thetaOffset:r}=this.state,i=[e,t,0],o=gi(i,i,wi(ko,Eo,-r));this.setCameraState(a({},this.state,{targetOffset:ci(o,n,o)})),this._onChange(this.state)}),o(this,"cameraZoom",e=>{const{distance:t}=this.state,n=function(e,t){return Math.max(.001,e*(1-t/100))}(t,e);t!==n&&(this.setCameraState(a({},this.state,{distance:n})),this._onChange(this.state))}),this._onChange=e,this.setCameraState(t)}}const To=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var Do,Po,zo,Io,Bo,Fo,Ro,Lo,Ho,No,Wo,Uo,Ko,qo,Go,Vo=e=>(class{constructor(){o(this,"viewportWidth",0),o(this,"viewportHeight",0),o(this,"cameraState",Oo),o(this,"draw",e({context:{projection(e,t){const{viewportWidth:n,viewportHeight:r}=e;return this.viewportWidth=n,this.viewportHeight=r,this.cameraState=t,this.getProjection()},view(e,t){return this.getView()}},uniforms:{view:e.context("view"),projection:e.context("projection")}}))}getProjection(){const{near:e,far:t,distance:n,fovy:r}=this.cameraState;if(!this.cameraState.perspective){const r=zi(n,this.viewportWidth,this.viewportHeight),{left:i,right:o,bottom:a,top:s}=r;return function(e,t,n,r,i,o,a){var s=1/(t-n),c=1/(r-i),u=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*c,e[14]=(a+o)*u,e[15]=1,e}([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,o,a,s,e,t)}return function(e,t,n,r,i){var o=1/Math.tan(t/2),a=void 0;return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(r-i),e[10]=(i+r)*a,e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e}([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r,this.viewportWidth/this.viewportHeight,e,t)}getView(){return So.view(this.cameraState)}toScreenCoord(e,t){const n=this.getProjection(),r=So.view(this.cameraState),i=ei(To,n,r),[o,a,s,c]=function(e,t,n,r){const i=n[0],o=n[1],a=n[2],s=n[3],c=Ii,u=Bi;!function(e,t,n,r,i){e[0]=t,e[1]=n,e[2]=r,e[3]=i}(Fi,t[0],t[1],t[2],1),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a}(Fi,Fi,r);const f=Fi[3];return 0!==f&&(Fi[0]=Fi[0]/f,Fi[1]=Fi[1]/f,Fi[2]=Fi[2]/f),e[0]=i+a/2*Fi[0]+(0+a/2),e[1]=o+s/2*Fi[1]+(0+s/2),e[2]=(u-c)/2*Fi[2]+(u+c)/2,e[3]=0===f?0:1/f,e}([],t,e,i);if(s<0||s>1||c<0)return;const u=e[3]+e[1];return[o-e[0],u-a,s]}}),$o=!1;function Yo(){if(!$o){$o=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),n=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(Uo=/\b(iPhone|iP[ao]d)/.exec(e),Ko=/\b(iP[ao]d)/.exec(e),No=/Android/i.exec(e),qo=/FBAN\/\w+;/i.exec(e),Go=/Mobile/i.exec(e),Wo=!!/Win64/.exec(e),t){(Do=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(Do=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(e);Fo=r?parseFloat(r[1])+4:Do,Po=t[2]?parseFloat(t[2]):NaN,zo=t[3]?parseFloat(t[3]):NaN,(Io=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),Bo=t&&t[1]?parseFloat(t[1]):NaN):Bo=NaN}else Do=Po=zo=Bo=Io=NaN;if(n){if(n[1]){var i=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);Ro=!i||parseFloat(i[1].replace("_","."))}else Ro=!1;Lo=!!n[2],Ho=!!n[3]}else Ro=Lo=Ho=!1}}var Zo,Xo={ie:function(){return Yo()||Do},ieCompatibilityMode:function(){return Yo()||Fo>Do},ie64:function(){return Xo.ie()&&Wo},firefox:function(){return Yo()||Po},opera:function(){return Yo()||zo},webkit:function(){return Yo()||Io},safari:function(){return Xo.webkit()},chrome:function(){return Yo()||Bo},windows:function(){return Yo()||Lo},osx:function(){return Yo()||Ro},linux:function(){return Yo()||Ho},iphone:function(){return Yo()||Uo},mobile:function(){return Yo()||Uo||Ko||No||Go},nativeApp:function(){return Yo()||qo},android:function(){return Yo()||No},ipad:function(){return Yo()||Ko}},Qo=Xo,Jo=!("undefined"==typeof window||!window.document||!window.document.createElement),ea={canUseDOM:Jo,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:Jo&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:Jo&&!!window.screen,isInWorker:!Jo};ea.canUseDOM&&(Zo=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""));var ta=function(e,t){if(!ea.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&Zo&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r},na=10,ra=40,ia=800;function oa(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=t*na,i=n*na,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1==e.deltaMode?(r*=ra,i*=ra):(r*=ia,i*=ia)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}oa.getEventType=function(){return Qo.firefox()?"DOMMouseScroll":ta("wheel")?"wheel":"mousewheel"};var aa=oa;const sa=4,ca=.3,ua=.3,fa=150,la=1.5,pa={KeyA:"moveLeft",KeyD:"moveRight",KeyE:"rotateRight",KeyF:"tiltUp",KeyQ:"rotateLeft",KeyR:"tiltDown",KeyS:"moveDown",KeyW:"moveUp",KeyX:"zoomOut",KeyZ:"zoomIn"};class da extends n.Component{constructor(...e){super(...e),o(this,"_keyTimer",void 0),o(this,"_keys",new Set),o(this,"_buttons",new Set),o(this,"_listeners",[]),o(this,"_shiftKey",!1),o(this,"_metaKey",!1),o(this,"_ctrlKey",!1),o(this,"_el",void 0),o(this,"_rect",void 0),o(this,"_initialMouse",void 0),o(this,"_getMouseOnScreen",e=>{const{clientX:t,clientY:n}=e,{top:r,left:i,width:o,height:a}=this._rect;return[(t-i)/o,(n-r)/a]}),o(this,"_onMouseDown",e=>{const{_el:t}=this;t&&(e.preventDefault(),this._buttons.add(e.button),t.focus(),this._rect=t.getBoundingClientRect(),this._initialMouse=this._getMouseOnScreen(e),this.startDragging(e))}),o(this,"_onWindowMouseMove",e=>{if(!this._buttons.size)return;this._shiftKey=e.shiftKey;const{cameraStore:{cameraMove:t,cameraRotate:n,state:{perspective:r}}}=this.props;let i,o;const a=this._getMouseOnScreen(e);if(document.pointerLockElement&&(e.movementX||e.movementY)?(i=-e.movementX/this._rect.width,o=-e.movementY/this._rect.height):(i=this._initialMouse[0]-a[0],o=this._initialMouse[1]-a[1]),this._initialMouse=a,this._isRightMouseDown()){const e=this._getMagnitude(sa);n([(r?i:-i)*e,r?o*e:0])}if(this._isLeftMouseDown()){const{x:e,y:n}=this._getMoveMagnitude();t([this._getMagnitude(i*e),this._getMagnitude(-o*n)])}}),o(this,"_onMouseUp",e=>{this._buttons.delete(e.button),this._endDragging()}),o(this,"_onWindowMouseUp",e=>{const{_el:t}=this;t&&(t.contains(e.target)||e.target===t||(this._buttons.clear(),this._endDragging()))}),o(this,"_getKeyMotion",e=>{const t=this._getMagnitude(ua),n=this._getMagnitude(fa),r=this._getMagnitude(la),{keyMap:i,shiftKeys:o}=this.props,a=i&&i[e]||pa[e]||!1;if(this._shiftKey&&!o)return null;switch(a){case"moveRight":return{x:t};case"moveLeft":return{x:-t};case"moveUp":return{y:t};case"moveDown":return{y:-t};case"zoomIn":return{zoom:n};case"zoomOut":return{zoom:-n};case"rotateLeft":return{yaw:-r};case"rotateRight":return{yaw:r};case"tiltUp":return{tilt:-r};case"tiltDown":return{tilt:r};case!1:return null;default:return console.warn("Unrecognized key action:",a),null}}),o(this,"_onKeyDown",e=>{const{keyMap:t}=this.props;this._shiftKey=e.shiftKey,this._metaKey=e.metaKey,this._ctrlKey=e.ctrlKey;const n=e.nativeEvent.code;return e.repeat||this._keys.has(n)?(e.stopPropagation(),void e.preventDefault()):e.altKey||e.ctrlKey||e.metaKey?void 0:!(t&&n in t&&!t[n])&&void(this._getKeyMotion(n)&&(this._keys.add(n),this._startKeyTimer(),e.stopPropagation(),e.preventDefault()))}),o(this,"_onKeyUp",e=>{this._shiftKey=e.shiftKey,this._metaKey=e.metaKey,this._ctrlKey=e.ctrlKey,this._keys.delete(e.nativeEvent.code)}),o(this,"_onWheel",e=>{e.preventDefault(),this._shiftKey=e.shiftKey;const{pixelX:t,pixelY:n}=aa(e),r=n||t,i=-1*Math.sign(r),o=Math.abs(r),a=Math.max(1,Math.min(o,50)),s=this._getMagnitude(a*i*ca);this.props.cameraStore.cameraZoom(s)}),o(this,"_onBlur",e=>{this._keys=new Set,this._ctrlKey=!1,this._shiftKey=!1,this._metaKey=!1,this._stopKeyTimer()}),o(this,"_onContextMenu",e=>{e.preventDefault(),e.stopPropagation()})}componentDidMount(){const{_el:e}=this;if(!e)return;this._rect=e.getBoundingClientRect();const t=(e,t,n)=>{e.addEventListener(t,n),this._listeners.push({target:e,name:t,fn:n})};t(document,"blur",this._onBlur),t(window,"mouseup",this._onWindowMouseUp),e.addEventListener("wheel",this._onWheel,{passive:!1})}componentWillUnmount(){this._listeners.forEach(e=>{e.target.removeEventListener(e.name,e.fn)}),this._endDragging();const{_el:e}=this;e&&e.removeEventListener("wheel",this._onWheel,{passive:!1})}_isLeftMouseDown(){return this._buttons.has(0)}_isRightMouseDown(){return this._buttons.has(2)}_getMagnitude(e=1){return this._shiftKey?e/10:e}_getMoveMagnitude(){if(this._ctrlKey)return{x:0,y:0};const{cameraStore:{state:{distance:e,perspective:t}}}=this.props;if(t)return{x:e,y:e};const{width:n,height:r}=this._rect,i=zi(e,n,r);return{x:i.width,y:i.height}}startDragging(e){0!==e.button&&this._el&&"function"==typeof this._el.requestPointerLock&&this._el.requestPointerLock(),window.addEventListener("mousemove",this._onWindowMouseMove)}_endDragging(){window.removeEventListener("mousemove",this._onWindowMouseMove),"function"==typeof document.exitPointerLock&&document.exitPointerLock()}_moveKeyboard(e){const t={x:0,y:0,zoom:0,yaw:0,tilt:0};this._keys.forEach(e=>{const{x:n=0,y:r=0,zoom:i=0,yaw:o=0,tilt:a=0}=this._getKeyMotion(e)||{};t.x+=n,t.y+=r,t.zoom+=i,t.yaw+=o,t.tilt+=a});const{cameraStore:{cameraMove:n,cameraRotate:r,cameraZoom:i,state:{perspective:o}}}=this.props;if(t.x||t.y){const{x:r,y:i}=this._getMoveMagnitude();n([t.x*r*e,t.y*i*e])}(t.yaw||o&&t.tilt)&&r([t.yaw*e,o?t.tilt*e:0]),t.zoom&&i(t.zoom*e)}_startKeyTimer(e){this._keyTimer||(this._keyTimer=requestAnimationFrame(t=>{this._moveKeyboard((e?t-e:0)/1e3),this._keyTimer=void 0,this._keys.size&&this._startKeyTimer(t)}))}_stopKeyTimer(){this._keyTimer&&cancelAnimationFrame(this._keyTimer),this._keyTimer=void 0}render(){const{children:e}=this.props;return n.createElement("div",{tabIndex:0,style:{outline:"none"},draggable:!0,ref:e=>this._el=e,onMouseDown:this._onMouseDown,onMouseUp:this._onMouseUp,onBlur:this._onBlur,onContextMenu:this._onContextMenu,onKeyDown:this._onKeyDown,onKeyUp:this._onKeyUp},e)}}function ha(){return process&&process.env&&"development"}var ma=r.createContext(void 0);class va extends n.Component{constructor(e){super(e),o(this,"context",void 0),"production"!==ha()&&(this.shouldComponentUpdate=(e=>(e.reglCommand!==this.props.reglCommand&&console.error("Changing the regl command prop on a <Command /> is not supported."),!0)))}componentDidMount(){this.context.onMount(this,this.props.reglCommand),this._updateContext()}componentDidUpdate(){this._updateContext()}componentWillUnmount(){this.context.onUnmount(this)}_updateContext(){const e=this.context;if(!e)return;const{reglCommand:t,layerIndex:n,getChildrenForHitmap:r}=this.props,i=this.props.children||this.props.drawProps;null!=i&&e.registerDrawCall({instance:this,reglCommand:t,children:i,layerIndex:n,getChildrenForHitmap:r})}handleMouseEvent(e,t,n,r){const i=this.props[r];i&&e.length&&i(n,{ray:t,objects:e})}render(){return n.createElement(ma.Consumer,null,e=>(e&&(this.context=e),null))}}function ga(e){const t=new Map;return e.forEach(([e,n])=>{const r=t.get(n)||[];r.push(e),t.has(n)||t.set(n,r)}),t}o(va,"displayName","Command");const ba=[0,0,0],ya=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class xa{constructor(e,t,n){o(this,"origin",void 0),o(this,"dir",void 0),o(this,"point",void 0),this.origin=e,this.dir=t,this.point=n}distanceToPoint(e){return li(this.origin,e)}planeIntersection(e,t){const n=hi(t,e),r=hi(t,this.dir);if(0===r)return null;const i=n-hi(t,this.origin)/r;var o,a,s;return ci([0,0,0],this.origin,(o=ba,a=this.dir,s=i,o[0]=a[0]*s,o[1]=a[1]*s,o[2]=a[2]*s,o))}}function wa(e,{clientX:t,clientY:n,width:r,height:i}){const o=e.getProjection(),a=e.getView(),s=ei(ya,o,a),c=vi([0,0,0],[2*t/r-1,-2*n/i+1,0],Jr(ya,s)),u=vi([0,0,0],[0,0,0],Jr(ya,a)),f=di([0,0,0],ui(ba,c,u));return new xa(u,f,c)}var _a=function(){return p.Date.now()},ja=NaN,Ca=/^\s+|\s+$/g,Aa=/^[-+]0x[0-9a-f]+$/i,Sa=/^0b[01]+$/i,Ea=/^0o[0-7]+$/i,ka=parseInt;var Oa=function(e){if("number"==typeof e)return e;if(En(e))return ja;if(A(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=A(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Ca,"");var n=Sa.test(e);return n||Ea.test(e)?ka(e.slice(2),n?2:8):Aa.test(e)?ja:+e},Ma="Expected a function",Ta=Math.max,Da=Math.min;var Pa=function(e,t,n){var r,i,o,a,s,c,u=0,f=!1,l=!1,p=!0;if("function"!=typeof e)throw new TypeError(Ma);function d(t){var n=r,o=i;return r=i=void 0,u=t,a=e.apply(o,n)}function h(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=o}function m(){var e=_a();if(h(e))return v(e);s=setTimeout(m,function(e){var n=t-(e-c);return l?Da(n,o-(e-u)):n}(e))}function v(e){return s=void 0,p&&r?d(e):(r=i=void 0,a)}function g(){var e=_a(),n=h(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(m,t),f?d(e):a}(c);if(l)return s=setTimeout(m,t),d(c)}return void 0===s&&(s=setTimeout(m,t)),a}return t=Oa(t)||0,A(n)&&(f=!!n.leading,o=(l="maxWait"in n)?Ta(Oa(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=c=i=s=void 0},g.flush=function(){return void 0===s?a:v(_a())},g},za=u(function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function a(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var s=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function u(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function l(e,t,n){this.file=e,this.line=t,this.message=n}function p(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function d(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function h(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new u,0:new u};a.unknown.name=a[0].name=t||p(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var c=r[s],l=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(c);if(l)switch(l[1]){case"line":var d=/(\d+)(\s+\d+)?/.exec(l[2]);d&&(i=0|d[1],d[2]&&((o=0|d[2])in a||(a[o]=new u)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);h&&(a[o].name=h[1]?(n=h[2],"undefined"!=typeof atob?atob(n):"base64:"+n):h[2])}a[o].lines.push(new f(i++,c))}return Object.keys(a).forEach(function(e){var t=a[e];t.lines.forEach(function(e){t.index[e.number]=e})}),a}function m(e){e._commandRef=p()}function v(e,t){var n=d();r(e+" in command "+(t||p())+("unknown"===n?"":" called from "+n))}function g(e,t,n,r){typeof e!==t&&v("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||p())}var b=33071,y=9728,x=9984,w=9985,_=9986,j=9987,C=5126,A=32819,S=32820,E=33635,k=34042,O={};function M(e,t){return e===S||e===A||e===E?2:e===k?4:O[e]*t}function T(e){return!(e&e-1||!e)}O[5120]=O[5121]=1,O[5122]=O[5123]=O[36193]=O[E]=O[A]=O[S]=2,O[5124]=O[5125]=O[C]=O[k]=4;var D=t(i,{optional:function(e){e()},raise:r,commandRaise:v,command:function(e,t,n){e||v(t,n||p())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||v("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||p())},constructor:function(e){Object.keys(e).forEach(function(e){s.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+s)})},type:function(e,t,n){typeof e!==t&&r("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:a,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";g(r,"string",u+" shader source must be a string",a);var f=h(r,a),p=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);n?t.push(new l(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new l("unknown",0,e))}}),t}(s);!function(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(f,p),Object.keys(f).forEach(function(e){var t=f[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){o(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(r){var i=r.message,a=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(i);if(a){var s=a[1];switch(i=a[2],s){case"assign":s="="}t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(c("| ",6)),o(c("^^^",t+3)+n,"font-weight:bold"),o(c("| ",6)),o(i+n,"font-weight:bold")}),o(c("| ",6)+n)}else o(c(e.number,4)+"|  "),o(e.line+n,"color:red")}),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}}),i.raise("Error compiling "+u+" shader, "+f[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),c=h(r,a),u=h(o,a),f='Error linking program with vertex shader, "'+u[0].name+'", and fragment shader "'+c[0].name+'"';"undefined"!=typeof document?console.log("%c"+f+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+n+s),i.raise(f)}},callSite:d,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?a(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):a(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:p,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),(e.wrapS!==b||e.wrapT!==b)&&i(T(o)&&T(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(e.minFilter!==x&&e.minFilter!==_&&e.minFilter!==w&&e.minFilter!==j,"min filter requires mipmap"):(i(T(o)&&T(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),t.type===C&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(e.minFilter===y&&e.magFilter===y,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var c=t.images;for(r=0;r<16;++r)if(c[r]){var u=o>>r,f=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var l=c[r];if(i(l.width===u&&l.height===f,"invalid shape for mip images"),i(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var p=Math.ceil(M(l.type,s)*u/l.unpackAlignment)*l.unpackAlignment;i(l.data.byteLength===p*f,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===b&&t.wrapT===b,"wrap mode not supported by cube map");for(var c=0;c<n.length;++c){var u=n[c];i(u.width===o&&u.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!u.compressed,"can not generate mipmap for compressed textures"),i(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var f=u.images,l=0;l<16;++l){var p=f[l];if(p){var d=o>>l,h=a>>l;i(u.mipmask&1<<l,"missing mipmap data"),i(p.width===d&&p.height===h,"invalid shape for mip images"),i(p.format===e.format&&p.internalformat===e.internalformat&&p.type===e.type,"incompatible type for mip image"),p.compressed||(p.data?i(p.data.byteLength===d*h*Math.max(M(p.type,s),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}}),P=0,z=0;function I(e,t){this.id=P++,this.type=e,this.data=t}function B(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function F(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+B(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+B(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var R={DynamicVariable:I,define:function(e,t){return new I(e,F(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof I},unbox:function(e,t){return"function"==typeof e?new I(z,e):e},accessor:F},L={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},H="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function N(e){return"string"==typeof e?e.split():(D(Array.isArray(e),"invalid extension array"),e)}function W(e){return"string"==typeof e?(D("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function U(e){var n,r,i,o,a,s=e||{},c={},u=[],f=[],l="undefined"==typeof window?1:window.devicePixelRatio,p=!1,d=function(e){e&&D.raise(e)},h=function(){};if("string"==typeof s?(D("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),D(n,"invalid query string for element")):"object"==typeof s?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(o=s).canvas:(D.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=W(s.canvas):"container"in s&&(r=W(s.container)),"attributes"in s&&(c=s.attributes,D.type(c,"object","invalid context attributes")),"extensions"in s&&(u=N(s.extensions)),"optionalExtensions"in s&&(f=N(s.optionalExtensions)),"onDone"in s&&(D.type(s.onDone,"function","invalid or missing onDone callback"),d=s.onDone),"profile"in s&&(p=!!s.profile),"pixelRatio"in s&&(l=+s.pixelRatio,D(l>0,"invalid pixel ratio"))):D.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){D("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(e,n,r){var i=document.createElement("canvas");function o(){var n=window.innerWidth,o=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,o=a.bottom-a.top}i.width=r*n,i.height=r*o,t(i.style,{width:n+"px",height:o+"px"})}return t(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",o,!1),o(),{canvas:i,onDestroy:function(){window.removeEventListener("resize",o),e.removeChild(i)}}}(r||document.body,0,l);if(!m)return null;i=m.canvas,h=m.onDestroy}o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,c)}return o?{gl:o,canvas:i,container:r,extensions:u,optionalExtensions:f,pixelRatio:l,profile:p,onDone:d,onDestroy:h}:(h(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function K(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var q=5120,G=5121,V=5122,$=5123,Y=5124,Z=5125,X=5126;function Q(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function J(){var e=K(8,function(){return[]});function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[Q(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Q(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case q:r=new Int8Array(t(n),0,n);break;case G:r=new Uint8Array(t(n),0,n);break;case V:r=new Int16Array(t(2*n),0,n);break;case $:r=new Uint16Array(t(2*n),0,n);break;case Y:r=new Int32Array(t(4*n),0,n);break;case Z:r=new Uint32Array(t(4*n),0,n);break;case X:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var ee=J();ee.zero=J();var te=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var c=ee.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,c),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===c[0]),ee.freeType(c)}}var u="undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),f=!0;if(!u){var l=e.createTexture(),p=ee.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,p),ee.freeType(p),e.bindTexture(34067,null),e.deleteTexture(l),f=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:f}};function ne(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var re=function(e){return Object.keys(e).map(function(t){return e[t]})},ie={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||ee.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:oe(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var c=n[r];if(n.length-r==4){var u=n[r+1],f=n[r+2],l=n[r+3];for(s=0;s<c;++s)oe(t[s],u,f,l,i,o),o+=a}else for(s=0;s<c;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function oe(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var c=e[s],u=0;u<n;++u)for(var f=c[u],l=0;l<r;++l)i[a++]=f[l]}var ae={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},se={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},ce={dynamic:35048,stream:35040,static:35044},ue=ie.flatten,fe=ie.shape,le=35044,pe=35040,de=5121,he=5126,me=[];function ve(e){return 0|ae[Object.prototype.toString.call(e)]}function ge(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function be(e,t,n,r,i,o,a){for(var s=0,c=0;c<n;++c)for(var u=0;u<r;++u)e[s++]=t[i*c+o*u+a]}me[5120]=1,me[5122]=2,me[5124]=4,me[5121]=1,me[5123]=2,me[5125]=4,me[5126]=4;var ye={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xe=0,we=1,_e=4,je=5120,Ce=5121,Ae=5122,Se=5123,Ee=5124,ke=5125,Oe=34963,Me=35040,Te=35044,De=new Float32Array(1),Pe=new Uint32Array(De.buffer),ze=5123;function Ie(e){for(var t=ee.allocType(ze,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{De[0]=e[n];var r=Pe[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function Be(t){return Array.isArray(t)||e(t)}var Fe=function(e){return!(e&e-1||!e)},Re=34467,Le=3553,He=34067,Ne=34069,We=6408,Ue=6406,Ke=6407,qe=6409,Ge=6410,Ve=32854,$e=32855,Ye=36194,Ze=32819,Xe=32820,Qe=33635,Je=34042,et=6402,tt=34041,nt=35904,rt=35906,it=36193,ot=33776,at=33777,st=33778,ct=33779,ut=35986,ft=35987,lt=34798,pt=35840,dt=35841,ht=35842,mt=35843,vt=36196,gt=5121,bt=5123,yt=5125,xt=5126,wt=10242,_t=10243,jt=10497,Ct=33071,At=33648,St=10240,Et=10241,kt=9728,Ot=9729,Mt=9984,Tt=9985,Dt=9986,Pt=9987,zt=33170,It=4352,Bt=4353,Ft=4354,Rt=34046,Lt=3317,Ht=37440,Nt=37441,Wt=37443,Ut=37444,Kt=33984,qt=[Mt,Dt,Tt,Pt],Gt=[0,qe,Ge,Ke,We],Vt={};function $t(e){return"[object "+e+"]"}Vt[qe]=Vt[Ue]=Vt[et]=1,Vt[tt]=Vt[Ge]=2,Vt[Ke]=Vt[nt]=3,Vt[We]=Vt[rt]=4;var Yt=$t("HTMLCanvasElement"),Zt=$t("CanvasRenderingContext2D"),Xt=$t("ImageBitmap"),Qt=$t("HTMLImageElement"),Jt=$t("HTMLVideoElement"),en=Object.keys(ae).concat([Yt,Zt,Xt,Qt,Jt]),tn=[];tn[gt]=1,tn[xt]=4,tn[it]=2,tn[bt]=2,tn[yt]=4;var nn=[];function rn(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function on(e){if(!Array.isArray(e))return!1;var t=e.length;return!(0===t||!Be(e[0]))}function an(e){return Object.prototype.toString.call(e)}function sn(e){return an(e)===Yt}function cn(e){if(!e)return!1;var t=an(e);return en.indexOf(t)>=0||rn(e)||on(e)||ne(e)}function un(e){return 0|ae[Object.prototype.toString.call(e)]}function fn(e,t){return ee.allocType(e.type===it?xt:e.type,t)}function ln(e,t){e.type===it?(e.data=Ie(t),ee.freeType(t)):e.data=t}function pn(e,t,n,r,i,o){var a;if(a=void 0!==nn[e]?nn[e]:Vt[e]*tn[t],o&&(a*=6),i){for(var s=0,c=n;c>=1;)s+=a*c*c,c/=2;return s}return a*n*r}function dn(n,r,i,o,a,s,c){var u={"don't care":It,"dont care":It,nice:Ft,fast:Bt},f={repeat:jt,clamp:Ct,mirror:At},l={nearest:kt,linear:Ot},p=t({mipmap:Pt,"nearest mipmap nearest":Mt,"linear mipmap nearest":Tt,"nearest mipmap linear":Dt,"linear mipmap linear":Pt},l),d={none:0,browser:Ut},h={uint8:gt,rgba4:Ze,rgb565:Qe,"rgb5 a1":Xe},m={alpha:Ue,luminance:qe,"luminance alpha":Ge,rgb:Ke,rgba:We,rgba4:Ve,"rgb5 a1":$e,rgb565:Ye},v={};r.ext_srgb&&(m.srgb=nt,m.srgba=rt),r.oes_texture_float&&(h.float32=h.float=xt),r.oes_texture_half_float&&(h.float16=h["half float"]=it),r.webgl_depth_texture&&(t(m,{depth:et,"depth stencil":tt}),t(h,{uint16:bt,uint32:yt,"depth stencil":Je})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":ot,"rgba s3tc dxt1":at,"rgba s3tc dxt3":st,"rgba s3tc dxt5":ct}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":ut,"rgba atc explicit alpha":ft,"rgba atc interpolated alpha":lt}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":pt,"rgb pvrtc 2bppv1":dt,"rgba pvrtc 4bppv1":ht,"rgba pvrtc 2bppv1":mt}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=vt);var g=Array.prototype.slice.call(n.getParameter(Re));Object.keys(v).forEach(function(e){var t=v[e];g.indexOf(t)>=0&&(m[e]=t)});var b=Object.keys(m);i.textureFormats=b;var y=[];Object.keys(m).forEach(function(e){var t=m[e];y[t]=e});var x=[];Object.keys(h).forEach(function(e){var t=h[e];x[t]=e});var w=[];Object.keys(l).forEach(function(e){var t=l[e];w[t]=e});var _=[];Object.keys(p).forEach(function(e){var t=p[e];_[t]=e});var j=[];Object.keys(f).forEach(function(e){var t=f[e];j[t]=e});var C=b.reduce(function(e,t){var n=m[t];return n===qe||n===Ue||n===qe||n===Ge||n===et||n===tt?e[n]=n:n===$e||t.indexOf("rgba")>=0?e[n]=We:e[n]=Ke,e},{});function A(){this.internalformat=We,this.format=We,this.type=gt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ut,this.width=0,this.height=0,this.channels=0}function S(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function E(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(D.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(D.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(D.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(D.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;D(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),D(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),D(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(n,h,"invalid texture type"),e.type=h[n]}var o=e.width,a=e.height,s=e.channels,c=!1;"shape"in t?(D(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],D(s>0&&s<=4,"invalid number of channels"),c=!0),D(o>=0&&o<=i.maxTextureSize,"invalid width"),D(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,D(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,D(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,D(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,D(s>0&&s<=4,"invalid number of channels"),c=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var u=!1;if("format"in t){var f=t.format;D(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(f,m,"invalid texture format");var l=e.internalformat=m[f];e.format=C[l],f in h&&("type"in t||(e.type=h[f])),f in v&&(e.compressed=!0),u=!0}!c&&u?e.channels=Vt[e.format]:c&&!u?e.channels!==Gt[e.format]&&(e.format=e.internalformat=Gt[e.channels]):u&&c&&D(e.channels===Vt[e.format],"number of channels inconsistent with specified format")}}function k(e){n.pixelStorei(Ht,e.flipY),n.pixelStorei(Nt,e.premultiplyAlpha),n.pixelStorei(Wt,e.colorSpace),n.pixelStorei(Lt,e.unpackAlignment)}function O(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function M(t,n){var r=null;if(cn(n)?r=n:n&&(D.type(n,"object","invalid pixel data type"),E(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),cn(n.data)&&(r=n.data)),D(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){D(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,D(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==gt||(t.type=un(r));else if(rn(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case gt:case bt:case yt:case xt:var r=ee.allocType(e.type,n);r.set(t),e.data=r;break;case it:e.data=Ie(t);break;default:D.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(ne(r)){var c=r.data;Array.isArray(c)||t.type!==gt||(t.type=un(c));var u,f,l,p,d,h,m=r.shape,v=r.stride;3===m.length?(l=m[2],h=v[2]):(D(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,h=1),u=m[0],f=m[1],p=v[0],d=v[1],t.alignment=1,t.width=u,t.height=f,t.channels=l,t.format=t.internalformat=Gt[l],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,c=e.channels,u=fn(e,a*s*c),f=0,l=0;l<s;++l)for(var p=0;p<a;++p)for(var d=0;d<c;++d)u[f++]=t[n*p+r*l+i*d+o];ln(e,u)}(t,c,p,d,h,r.offset)}else if(sn(r)||an(r)===Zt)sn(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return an(e)===Xt}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return an(e)===Qt}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return an(e)===Jt}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(on(r)){var g=t.width||r[0].length,b=t.height||r.length,y=t.channels;y=Be(r[0][0])?y||r[0][0].length:y||1;for(var x=ie.shape(r),w=1,_=0;_<x.length;++_)w*=x[_];var j=fn(t,w);ie.flatten(r,x,"",j),ln(t,j),t.alignment=1,t.width=g,t.height=b,t.channels=y,t.format=t.internalformat=Gt[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===xt?D(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===it&&D(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function T(e,t,r){var i=e.element,a=e.data,s=e.internalformat,c=e.format,u=e.type,f=e.width,l=e.height,p=e.channels;if(k(e),i)n.texImage2D(t,r,c,c,u,i);else if(e.compressed)n.compressedTexImage2D(t,r,s,f,l,0,a);else if(e.needsCopy)o(),n.copyTexImage2D(t,r,c,e.xOffset,e.yOffset,f,l,0);else{var d=!a;d&&(a=ee.zero.allocType(u,f*l*p)),n.texImage2D(t,r,c,f,l,0,c,u,a),d&&a&&ee.zero.freeType(a)}}function P(e,t,r,i,a){var s=e.element,c=e.data,u=e.internalformat,f=e.format,l=e.type,p=e.width,d=e.height;k(e),s?n.texSubImage2D(t,a,r,i,f,l,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,u,p,d,c):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,p,d)):n.texSubImage2D(t,a,r,i,p,d,f,l,c)}var z=[];function I(){return z.pop()||new O}function B(e){e.needsFree&&ee.freeType(e.data),O.call(e),z.push(e)}function F(){A.call(this),this.genMipmaps=!1,this.mipmapHint=It,this.mipmask=0,this.images=Array(16)}function R(e,t,n){var r=e.images[0]=I();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function L(e,t){var n=null;if(cn(t))S(n=e.images[0]=I(),e),M(n,t),e.mipmask=1;else if(E(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)S(n=e.images[i]=I(),e),n.width>>=i,n.height>>=i,M(n,r[i]),e.mipmask|=1<<i;else S(n=e.images[0]=I(),e),M(n,t),e.mipmask=1;S(e,e.images[0]),(e.compressed&&e.internalformat===ot||e.internalformat===at||e.internalformat===st||e.internalformat===ct)&&D(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function H(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;T(n[r],t,r)}}var N=[];function W(){var e=N.pop()||new F;A.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function U(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&B(t[n]),t[n]=null;N.push(e)}function K(){this.minFilter=kt,this.magFilter=kt,this.wrapS=Ct,this.wrapT=Ct,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=It}function q(e,t){if("min"in t){var n=t.min;D.parameter(n,p),e.minFilter=p[n],qt.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;D.parameter(r,l),e.magFilter=l[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(D.parameter(s,f),o=a=f[s]):Array.isArray(s)&&(D.parameter(s[0],f),D.parameter(s[1],f),o=f[s[0]],a=f[s[1]])}else{if("wrapS"in t){var c=t.wrapS;D.parameter(c,f),o=f[c]}if("wrapT"in t){var d=t.wrapT;D.parameter(d,f),a=f[d]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var h=t.anisotropic;D("number"==typeof h&&h>=1&&h<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":D.parameter(t.mipmap,u,"invalid mipmap hint"),e.mipmapHint=u[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":D(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:D.raise("invalid mipmap type")}!m||"min"in t||(e.minFilter=Mt)}}function G(e,t){n.texParameteri(t,Et,e.minFilter),n.texParameteri(t,St,e.magFilter),n.texParameteri(t,wt,e.wrapS),n.texParameteri(t,_t,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,Rt,e.anisotropic),e.genMipmaps&&(n.hint(zt,e.mipmapHint),n.generateMipmap(t))}var V=0,$={},Y=i.maxTextureUnits,Z=Array(Y).map(function(){return null});function X(e){A.call(this),this.mipmask=0,this.internalformat=We,this.id=V++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new K,c.profile&&(this.stats={size:0})}function Q(e){n.activeTexture(Kt),n.bindTexture(e.target,e.texture)}function J(){var e=Z[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(Le,null)}function te(e){var t=e.texture;D(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Kt+r),n.bindTexture(i,null),Z[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete $[e.id],s.textureCount--}return t(X.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<Y;++t){var r=Z[t];if(r){if(r.bindCount>0)continue;r.unit=-1}Z[t]=this,e=t;break}e>=Y&&D.raise("insufficient number of texture units"),c.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,n.activeTexture(Kt+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&te(this)}}),c.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys($).forEach(function(t){e+=$[t].stats.size}),e}),{create2D:function(e,t){var r=new X(Le);function o(e,t){var n=r.texInfo;K.call(n);var a=W();return"number"==typeof e?R(a,0|e,"number"==typeof t?0|t:0|e):e?(D.type(e,"object","invalid arguments to regl.texture"),q(n,e),L(a,e)):R(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,S(r,a),D.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,Q(r),H(a,Le),G(n,Le),J(),U(a),c.profile&&(r.stats.size=pn(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=y[r.internalformat],o.type=x[r.type],o.mag=w[n.magFilter],o.min=_[n.minFilter],o.wrapS=j[n.wrapS],o.wrapT=j[n.wrapT],o}return $[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){D(!!e,"must specify image data");var a=0|t,s=0|n,c=0|i,u=I();return S(u,r),u.width=0,u.height=0,M(u,e),u.width=u.width||(r.width>>c)-a,u.height=u.height||(r.height>>c)-s,D(r.type===u.type&&r.format===u.format&&r.internalformat===u.internalformat,"incompatible format for texture.subimage"),D(a>=0&&s>=0&&a+u.width<=r.width&&s+u.height<=r.height,"texture.subimage write out of bounds"),D(r.mipmask&1<<c,"missing mipmap data"),D(u.data||u.element||u.needsCopy,"missing image data"),Q(r),P(u,Le,a,s,c),J(),B(u),o},o.resize=function(e,t){var i,a=0|e,s=0|t||a;if(a===r.width&&s===r.height)return o;o.width=r.width=a,o.height=r.height=s,Q(r);for(var u=r.channels,f=r.type,l=0;r.mipmask>>l;++l){var p=a>>l,d=s>>l;if(!p||!d)break;i=ee.zero.allocType(f,p*d*u),n.texImage2D(Le,l,r.format,p,d,0,r.format,r.type,i),i&&ee.zero.freeType(i)}return J(),c.profile&&(r.stats.size=pn(r.internalformat,r.type,a,s,!1,!1)),o},o._reglType="texture2d",o._texture=r,c.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,u){var f=new X(He);$[f.id]=f,s.cubeCount++;var l=new Array(6);function p(e,t,n,r,o,a){var s,u=f.texInfo;for(K.call(u),s=0;s<6;++s)l[s]=W();if("number"!=typeof e&&e)if("object"==typeof e)if(t)L(l[0],e),L(l[1],t),L(l[2],n),L(l[3],r),L(l[4],o),L(l[5],a);else if(q(u,e),E(f,e),"faces"in e){var d=e.faces;for(D(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),s=0;s<6;++s)D("object"==typeof d[s]&&!!d[s],"invalid input for cube map face"),S(l[s],f),L(l[s],d[s])}else for(s=0;s<6;++s)L(l[s],e);else D.raise("invalid arguments to cube map");else{var h=0|e||1;for(s=0;s<6;++s)R(l[s],h,h)}for(S(f,l[0]),i.npotTextureCube||D(Fe(f.width)&&Fe(f.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?f.mipmask=(l[0].width<<1)-1:f.mipmask=l[0].mipmask,D.textureCube(f,u,l,i),f.internalformat=l[0].internalformat,p.width=l[0].width,p.height=l[0].height,Q(f),s=0;s<6;++s)H(l[s],Ne+s);for(G(u,He),J(),c.profile&&(f.stats.size=pn(f.internalformat,f.type,p.width,p.height,u.genMipmaps,!0)),p.format=y[f.internalformat],p.type=x[f.type],p.mag=w[u.magFilter],p.min=_[u.minFilter],p.wrapS=j[u.wrapS],p.wrapT=j[u.wrapT],s=0;s<6;++s)U(l[s]);return p}return p(e,t,r,o,a,u),p.subimage=function(e,t,n,r,i){D(!!t,"must specify image data"),D("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,c=I();return S(c,f),c.width=0,c.height=0,M(c,t),c.width=c.width||(f.width>>s)-o,c.height=c.height||(f.height>>s)-a,D(f.type===c.type&&f.format===c.format&&f.internalformat===c.internalformat,"incompatible format for texture.subimage"),D(o>=0&&a>=0&&o+c.width<=f.width&&a+c.height<=f.height,"texture.subimage write out of bounds"),D(f.mipmask&1<<s,"missing mipmap data"),D(c.data||c.element||c.needsCopy,"missing image data"),Q(f),P(c,Ne+e,o,a,s),J(),B(c),p},p.resize=function(e){var t=0|e;if(t!==f.width){p.width=f.width=t,p.height=f.height=t,Q(f);for(var r=0;r<6;++r)for(var i=0;f.mipmask>>i;++i)n.texImage2D(Ne+r,i,f.format,t>>i,t>>i,0,f.format,f.type,null);return J(),c.profile&&(f.stats.size=pn(f.internalformat,f.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=f,c.profile&&(p.stats=f.stats),p.destroy=function(){f.decRef()},p},clear:function(){for(var e=0;e<Y;++e)n.activeTexture(Kt+e),n.bindTexture(Le,null),Z[e]=null;re($).forEach(te),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<Y;++e){var t=Z[e];t&&(t.bindCount=0,t.unit=-1,Z[e]=null)}re($).forEach(function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Le)n.texImage2D(Le,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(Ne+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);G(e.texInfo,e.target)})}}}nn[Ve]=2,nn[$e]=2,nn[Ye]=2,nn[tt]=4,nn[ot]=.5,nn[at]=.5,nn[st]=1,nn[ct]=1,nn[ut]=.5,nn[ft]=1,nn[lt]=1,nn[pt]=.5,nn[dt]=.25,nn[ht]=.5,nn[mt]=.25,nn[vt]=.5;var hn=36161,mn=32854,vn=[];function gn(e,t,n){return vn[e]*t*n}vn[mn]=2,vn[32855]=2,vn[36194]=2,vn[33189]=2,vn[36168]=1,vn[34041]=4,vn[35907]=4,vn[34836]=16,vn[34842]=8,vn[34843]=6;var bn=function(e,t,n,r,i){var o={rgba4:mn,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach(function(e){var t=o[e];a[t]=e});var s=0,c={};function u(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=mn,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(t){var n=t.renderbuffer;D(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(hn,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete c[t.id],r.renderbufferCount--}return u.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(c).forEach(function(t){e+=c[t].stats.size}),e}),{create:function(t,s){var f=new u(e.createRenderbuffer());function l(t,r){var s=0,c=0,u=mn;if("object"==typeof t&&t){var p=t;if("shape"in p){var d=p.shape;D(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),s=0|d[0],c=0|d[1]}else"radius"in p&&(s=c=0|p.radius),"width"in p&&(s=0|p.width),"height"in p&&(c=0|p.height);"format"in p&&(D.parameter(p.format,o,"invalid renderbuffer format"),u=o[p.format])}else"number"==typeof t?(s=0|t,c="number"==typeof r?0|r:s):t?D.raise("invalid arguments to renderbuffer constructor"):s=c=1;if(D(s>0&&c>0&&s<=n.maxRenderbufferSize&&c<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==f.width||c!==f.height||u!==f.format)return l.width=f.width=s,l.height=f.height=c,f.format=u,e.bindRenderbuffer(hn,f.renderbuffer),e.renderbufferStorage(hn,u,s,c),D(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=gn(f.format,f.width,f.height)),l.format=a[f.format],l}return c[f.id]=f,r.renderbufferCount++,l(t,s),l.resize=function(t,r){var o=0|t,a=0|r||o;return o===f.width&&a===f.height?l:(D(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),l.width=f.width=o,l.height=f.height=a,e.bindRenderbuffer(hn,f.renderbuffer),e.renderbufferStorage(hn,f.format,o,a),D(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=gn(f.format,f.width,f.height)),l)},l._reglType="renderbuffer",l._renderbuffer=f,i.profile&&(l.stats=f.stats),l.destroy=function(){f.decRef()},l},clear:function(){re(c).forEach(f)},restore:function(){re(c).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(hn,t.renderbuffer),e.renderbufferStorage(hn,t.format,t.width,t.height)}),e.bindRenderbuffer(hn,null)}}},yn=36160,xn=36161,wn=3553,_n=34069,jn=36064,Cn=36096,An=36128,Sn=33306,En=36053,kn=6402,On=[6407,6408],Mn=[];Mn[6408]=4,Mn[6407]=3;var Tn=[];Tn[5121]=1,Tn[5126]=4,Tn[36193]=2;var Dn=33189,Pn=36168,zn=34041,In=[32854,32855,36194,35907,34842,34843,34836],Bn={};Bn[En]="complete",Bn[36054]="incomplete attachment",Bn[36057]="incomplete dimensions",Bn[36055]="incomplete, missing attachment",Bn[36061]="unsupported";var Fn=5126;function Rn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Fn,this.offset=0,this.stride=0,this.divisor=0}var Ln=35632,Hn=35633,Nn=35718,Wn=35721,Un=6408,Kn=5121,qn=3333,Gn=5126;function Vn(t,n,r,i,o,a,s){function c(c){var u;null===n.next?(D(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Kn):(D(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(D(u===Kn||u===Gn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),u===Gn&&D(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):D(u===Kn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var f=0,l=0,p=i.framebufferWidth,d=i.framebufferHeight,h=null;e(c)?h=c:c&&(D.type(c,"object","invalid arguments to regl.read()"),f=0|c.x,l=0|c.y,D(f>=0&&f<i.framebufferWidth,"invalid x offset for regl.read"),D(l>=0&&l<i.framebufferHeight,"invalid y offset for regl.read"),p=0|(c.width||i.framebufferWidth-f),d=0|(c.height||i.framebufferHeight-l),h=c.data||null),h&&(u===Kn?D(h instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Gn&&D(h instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),D(p>0&&p+f<=i.framebufferWidth,"invalid width for read pixels"),D(d>0&&d+l<=i.framebufferHeight,"invalid height for read pixels"),r();var m=p*d*4;return h||(u===Kn?h=new Uint8Array(m):u===Gn&&(h=h||new Float32Array(m))),D.isTypedArray(h,"data buffer for regl.read() must be a typedarray"),D(h.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(qn,4),t.readPixels(f,l,p,d,Un,u,h),h}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},function(){t=c(e)}),t}(e):c(e)}}function $n(e){return Array.prototype.slice.call(e)}function Yn(e){return $n(e).join("")}var Zn="xyzw".split(""),Xn=5121,Qn=1,Jn=2,er=0,tr=1,nr=2,rr=3,ir=4,or="dither",ar="blend.enable",sr="blend.color",cr="blend.equation",ur="blend.func",fr="depth.enable",lr="depth.func",pr="depth.range",dr="depth.mask",hr="colorMask",mr="cull.enable",vr="cull.face",gr="frontFace",br="lineWidth",yr="polygonOffset.enable",xr="polygonOffset.offset",wr="sample.alpha",_r="sample.enable",jr="sample.coverage",Cr="stencil.enable",Ar="stencil.mask",Sr="stencil.func",Er="stencil.opFront",kr="stencil.opBack",Or="scissor.enable",Mr="scissor.box",Tr="viewport",Dr="profile",Pr="framebuffer",zr="vert",Ir="frag",Br="elements",Fr="primitive",Rr="count",Lr="offset",Hr="instances",Nr=Pr+"Width",Wr=Pr+"Height",Ur=Tr+"Width",Kr=Tr+"Height",qr="drawingBufferWidth",Gr="drawingBufferHeight",Vr=[ur,cr,Sr,Er,kr,jr,Tr,Mr,xr],$r=34962,Yr=34963,Zr=3553,Xr=34067,Qr=2884,Jr=3042,ei=3024,ti=2960,ni=2929,ri=3089,ii=32823,oi=32926,ai=32928,si=5126,ci=35664,ui=35665,fi=35666,li=5124,pi=35667,di=35668,hi=35669,mi=35670,vi=35671,gi=35672,bi=35673,yi=35674,xi=35675,wi=35676,_i=35678,ji=35680,Ci=4,Ai=1028,Si=1029,Ei=2304,ki=2305,Oi=32775,Mi=32776,Ti=519,Di=7680,Pi=0,zi=1,Ii=32774,Bi=513,Fi=36160,Ri=36064,Li={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Hi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ni={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Wi={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ui={frag:35632,vert:35633},Ki={cw:Ei,ccw:ki};function qi(t){return Array.isArray(t)||e(t)||ne(t)}function Gi(e){return e.sort(function(e,t){return e===Tr?-1:t===Tr?1:e<t?-1:1})}function Vi(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function $i(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Yi(e){return new Vi(!1,!1,!1,e)}function Zi(e,t){var n=e.type;if(n===er){var r=e.data.length;return new Vi(!0,r>=1,r>=2,t)}if(n===ir){var i=e.data;return new Vi(i.thisDep,i.contextDep,i.propDep,t)}return new Vi(n===rr,n===nr,n===tr,t)}var Xi=new Vi(!1,!1,!1,function(){});function Qi(e,n,r,i,o,a,s,c,u,f,l,p,d,h,m){var v=f.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=Oi,g.max=Mi);var b=r.angle_instanced_arrays,y=r.webgl_draw_buffers,x={dirty:!0,profile:m.profile},w={},_=[],j={},C={};function A(e){return e.replace(".","_")}function S(e,t,n){var r=A(e);_.push(e),w[r]=x[r]=!!n,j[r]=t}function E(e,t,n){var r=A(e);_.push(e),Array.isArray(n)?(x[r]=n.slice(),w[r]=n.slice()):x[r]=w[r]=n,C[r]=t}S(or,ei),S(ar,Jr),E(sr,"blendColor",[0,0,0,0]),E(cr,"blendEquationSeparate",[Ii,Ii]),E(ur,"blendFuncSeparate",[zi,Pi,zi,Pi]),S(fr,ni,!0),E(lr,"depthFunc",Bi),E(pr,"depthRange",[0,1]),E(dr,"depthMask",!0),E(hr,hr,[!0,!0,!0,!0]),S(mr,Qr),E(vr,"cullFace",Si),E(gr,gr,ki),E(br,br,1),S(yr,ii),E(xr,"polygonOffset",[0,0]),S(wr,oi),S(_r,ai),E(jr,"sampleCoverage",[1,!1]),S(Cr,ti),E(Ar,"stencilMask",-1),E(Sr,"stencilFunc",[Ti,0,-1]),E(Er,"stencilOpSeparate",[Ai,Di,Di,Di]),E(kr,"stencilOpSeparate",[Si,Di,Di,Di]),S(Or,ri),E(Mr,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),E(Tr,Tr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var k={gl:e,context:d,strings:n,next:w,current:x,draw:p,elements:a,buffer:o,shader:l,attributes:f.state,uniforms:u,framebuffer:c,extensions:r,timer:h,isBufferArgs:qi},O={primTypes:ye,compareFuncs:Ni,blendFuncs:Li,blendEquations:g,stencilOps:Wi,glTypes:se,orientationType:Ki};D.optional(function(){k.isArrayLike=Be}),y&&(O.backBuffer=[Si],O.drawBuffer=K(i.maxDrawbuffers,function(e){return 0===e?[0]:K(e,function(e){return Ri+e})}));var M=0;function T(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t(function(){n.push.apply(n,$n(arguments))},{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,$n(arguments)),n.push(";")),t},toString:function(){return Yn([r.length>0?"var "+r.join(",")+";":"",Yn(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t(function(){e.apply(e,$n(arguments))},{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var c=o(),u=c.toString;return s[e]=t(c,{arg:i,toString:function(){return Yn(["function(",r.join(),"){",u(),"}"])}})},scope:o,cond:function(){var e=Yn(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,$n(arguments)),this},else:function(){return r.apply(r,$n(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Yn(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach(function(t){e.push('"',t,'":',s[t].toString(),",")}),e.push("}");var t=Yn(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=M++,e.batchId="0";var o=r(k),a=e.shared={props:"a0"};Object.keys(k).forEach(function(e){a[e]=i.def(o,".",e)}),D.optional(function(){e.CHECK=r(D),e.commandStr=D.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},O.invalidBlendCombinations=Hi});var s=e.next={},c=e.current={};Object.keys(C).forEach(function(e){Array.isArray(x[e])&&(s[e]=i.def(a.next,".",e),c[e]=i.def(a.current,".",e))});var u=e.constants={};Object.keys(O).forEach(function(e){u[e]=i.def(JSON.stringify(O[e]))}),e.invoke=function(t,n){switch(n.type){case er:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case tr:return t.def(a.props,n.data);case nr:return t.def(a.context,n.data);case rr:return t.def("this",n.data);case ir:return n.data.append(e,t),n.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in l)return l[t];var i=f.scope[t];i||(i=f.scope[t]=new v);var o=l[t]=r(i);return o},e}function P(e,t,r,s,u){var f=e.static,p=e.dynamic;D.optional(function(){var e=[Pr,zr,Ir,Br,Fr,Lr,Rr,Hr,Dr].concat(_);function t(t){Object.keys(t).forEach(function(t){D.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',u.commandStr)})}t(f),t(p)});var d=function(e,t){var n=e.static,r=e.dynamic;if(Pr in n){var i=n[Pr];return i?(i=c.getFramebuffer(i),D.command(i,"invalid framebuffer object"),Yi(function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Nr,n+".width"),t.set(o,"."+Wr,n+".height"),n})):Yi(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Nr,r+"."+qr),t.set(r,"."+Wr,r+"."+Gr),"null"})}if(Pr in r){var o=r[Pr];return Zi(o,function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");D.optional(function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")}),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Nr,a+"?"+a+".width:"+s+"."+qr),t.set(s,"."+Wr,a+"?"+a+".height:"+s+"."+Gr),a})}return null}(e),h=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];D.commandType(o,"object","invalid "+e,n.commandStr);var a,s,c=!0,u=0|o.x,f=0|o.y;return"width"in o?(a=0|o.width,D.command(a>=0,"invalid "+e,n.commandStr)):c=!1,"height"in o?(s=0|o.height,D.command(s>=0,"invalid "+e,n.commandStr)):c=!1,new Vi(!c&&t&&t.thisDep,!c&&t&&t.contextDep,!c&&t&&t.propDep,function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Nr,"-",u));var i=s;return"height"in o||(i=t.def(n,".",Wr,"-",f)),[u,f,r,i]})}if(e in i){var l=i[e],p=Zi(l,function(t,n){var r=t.invoke(n,l);D.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Nr,"-",o,")"),c=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Wr,"-",a,")");return D.optional(function(){t.assert(n,s+">=0&&"+c+">=0","invalid "+e)}),[o,a,s,c]});return t&&(p.thisDep=p.thisDep||t.thisDep,p.contextDep=p.contextDep||t.contextDep,p.propDep=p.propDep||t.propDep),p}return t?new Vi(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Nr),t.def(n,".",Wr)]}):null}var a=o(Tr);if(a){var s=a;a=new Vi(a.thisDep,a.contextDep,a.propDep,function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+Ur,n[2]),t.set(r,"."+Kr,n[3]),n})}return{viewport:a,scissor_box:o(Mr)}}(e,d,u),m=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(Br in n){var e=n[Br];qi(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),D.command(e,"invalid elements",t.commandStr));var i=Yi(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return i.value=e,i}if(Br in r){var o=r[Br];return Zi(o,function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),c=t.def(r,"(",a,")"),u=e.cond(c).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return D.optional(function(){e.assert(u.else,"!"+a+"||"+s,"invalid elements")}),t.entry(u),t.exit(e.cond(c).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s})}return null}();function o(e,o){if(e in n){var a=0|n[e];return D.command(!o||a>=0,"invalid "+e,t.commandStr),Yi(function(e,t){return o&&(e.OFFSET=a),a})}if(e in r){var s=r[e];return Zi(s,function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,D.optional(function(){t.assert(n,r+">=0","invalid "+e)})),r})}return o&&i?Yi(function(e,t){return e.OFFSET="0",0}):null}var s=o(Lr,!0);return{elements:i,primitive:function(){if(Fr in n){var e=n[Fr];return D.commandParameter(e,ye,"invalid primitve",t.commandStr),Yi(function(t,n){return ye[e]})}if(Fr in r){var o=r[Fr];return Zi(o,function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return D.optional(function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(ye))}),t.def(n,"[",r,"]")})}return i?$i(i)?i.value?Yi(function(e,t){return t.def(e.ELEMENTS,".primType")}):Yi(function(){return Ci}):new Vi(i.thisDep,i.contextDep,i.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Ci)}):null}(),count:function(){if(Rr in n){var e=0|n[Rr];return D.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Yi(function(){return e})}if(Rr in r){var o=r[Rr];return Zi(o,function(e,t){var n=e.invoke(t,o);return D.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")}),n})}if(i){if($i(i)){if(i)return s?new Vi(s.thisDep,s.contextDep,s.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return D.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):Yi(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var a=Yi(function(){return-1});return D.optional(function(){a.MISSING=!0}),a}var c=new Vi(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return D.optional(function(){c.DYNAMIC=!0}),c}return null}(),instances:o(Hr,!1),offset:s}}(e,u),y=function(e,t){var n=e.static,r=e.dynamic,o={};return _.forEach(function(e){var a=A(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=Yi(function(){return s})}else if(e in r){var c=r[e];o[a]=Zi(c,function(e,t){return i(e,t,e.invoke(t,c))})}}switch(e){case mr:case ar:case or:case Cr:case fr:case Or:case yr:case wr:case _r:case dr:return s(function(n){return D.commandType(n,"boolean",e,t.commandStr),n},function(t,n,r){return D.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)}),r});case lr:return s(function(n){return D.commandParameter(n,Ni,"invalid "+e,t.commandStr),Ni[n]},function(t,n,r){var i=t.constants.compareFuncs;return D.optional(function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Ni))}),n.def(i,"[",r,"]")});case pr:return s(function(e){return D.command(Be(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,n){return D.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]});case ur:return s(function(e){D.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return D.commandParameter(n,Li,a+".srcRGB",t.commandStr),D.commandParameter(r,Li,a+".srcAlpha",t.commandStr),D.commandParameter(i,Li,a+".dstRGB",t.commandStr),D.commandParameter(o,Li,a+".dstAlpha",t.commandStr),D.command(-1===Hi.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Li[n],Li[i],Li[r],Li[o]]},function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return D.optional(function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Li))}),s}D.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var a=o("src","RGB"),s=o("dst","RGB");D.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var c=n.def(i,"[",a,"]"),u=n.def(i,"[",o("src","Alpha"),"]");return[c,n.def(i,"[",s,"]"),u,n.def(i,"[",o("dst","Alpha"),"]")]});case cr:return s(function(n){return"string"==typeof n?(D.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"==typeof n?(D.commandParameter(n.rgb,g,e+".rgb",t.commandStr),D.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void D.commandRaise("invalid blend.equation",t.commandStr)},function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return D.optional(function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")}),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]});case sr:return s(function(e){return D.command(Be(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),K(4,function(t){return+e[t]})},function(e,t,n){return D.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),K(4,function(e){return t.def("+",n,"[",e,"]")})});case Ar:return s(function(e){return D.commandType(e,"number",a,t.commandStr),0|e},function(e,t,n){return D.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case Sr:return s(function(n){D.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return D.commandParameter(r,Ni,e+".cmp",t.commandStr),D.commandType(i,"number",e+".ref",t.commandStr),D.commandType(o,"number",e+".mask",t.commandStr),[Ni[r],i,o]},function(e,t,n){var r=e.constants.compareFuncs;return D.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Di),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]});case Er:case kr:return s(function(n){D.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return D.commandParameter(r,Wi,e+".fail",t.commandStr),D.commandParameter(i,Wi,e+".zfail",t.commandStr),D.commandParameter(o,Wi,e+".zpass",t.commandStr),[e===kr?Si:Ai,Wi[r],Wi[i],Wi[o]]},function(t,n,r){var i=t.constants.stencilOps;function o(o){return D.optional(function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Wi))}),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Di)}return D.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===kr?Si:Ai,o("fail"),o("zfail"),o("zpass")]});case xr:return s(function(e){D.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return D.commandType(n,"number",a+".factor",t.commandStr),D.commandType(r,"number",a+".units",t.commandStr),[n,r]},function(t,n,r){return D.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[n.def(r,".factor|0"),n.def(r,".units|0")]});case vr:return s(function(e){var n=0;return"front"===e?n=Ai:"back"===e&&(n=Si),D.command(!!n,a,t.commandStr),n},function(e,t,n){return D.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',Ai,":",Si)});case br:return s(function(e){return D.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e},function(e,t,n){return D.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")}),n});case gr:return s(function(e){return D.commandParameter(e,Ki,a,t.commandStr),Ki[e]},function(e,t,n){return D.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+Ei+":"+ki)});case hr:return s(function(e){return D.command(Be(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,n){return D.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),K(4,function(e){return"!!"+n+"["+e+"]"})});case jr:return s(function(e){D.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return D.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]},function(e,t,n){return D.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]})}}),o}(e,u),x=function(e){var t=e.static,r=e.dynamic;function i(e){if(e in t){var i=n.id(t[e]);D.optional(function(){l.shader(Ui[e],i,D.guessCommand())});var o=Yi(function(){return i});return o.id=i,o}if(e in r){var a=r[e];return Zi(a,function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return D.optional(function(){n(t.shared.shader,".shader(",Ui[e],",",i,",",t.command,");")}),i})}return null}var o,a=i(Ir),s=i(zr),c=null;return $i(a)&&$i(s)?(c=l.program(s.id,a.id),o=Yi(function(e,t){return e.link(c)})):o=new Vi(a&&a.thisDep||s&&s.thisDep,a&&a.contextDep||s&&s.contextDep,a&&a.propDep||s&&s.propDep,function(e,t){var n,r,i=e.shared.shader;n=a?a.append(e,t):t.def(i,".",Ir),r=s?s.append(e,t):t.def(i,".",zr);var o=i+".program("+r+","+n;return D.optional(function(){o+=","+e.command}),t.def(o+")")}),{frag:a,vert:s,progVar:o,program:c}}(e);function w(e){var t=h[e];t&&(y[e]=t)}w(Tr),w(A(Mr));var j=Object.keys(y).length>0,C={framebuffer:d,draw:m,shader:x,state:y,dirty:j};return C.profile=function(e){var t,n=e.static,r=e.dynamic;if(Dr in n){var i=!!n[Dr];(t=Yi(function(e,t){return i})).enable=i}else if(Dr in r){var o=r[Dr];t=Zi(o,function(e,t){return e.invoke(t,o)})}return t}(e),C.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach(function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=Yi(function(){return o});else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=Yi(function(e){return e.link(o)}):"framebuffer"===a||"framebufferCube"===a?(D.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=Yi(function(e){return e.link(o.color[0])})):D.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Be(o)?r=Yi(function(t){return t.global.def("[",K(o.length,function(n){return D.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]}),"]")}):D.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r}),Object.keys(r).forEach(function(e){var t=r[e];i[e]=Zi(t,function(e,n){return e.invoke(n,t)})}),i}(r,u),C.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach(function(e){var i=r[e],s=n.id(e),c=new v;if(qi(i))c.state=Qn,c.buffer=o.getBuffer(o.create(i,$r,!1,!0)),c.type=0;else{var u=o.getBuffer(i);if(u)c.state=Qn,c.buffer=u,c.type=0;else if(D.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var f=i.constant;c.buffer="null",c.state=Jn,"number"==typeof f?c.x=f:(D.command(Be(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+e,t.commandStr),Zn.forEach(function(e,t){t<f.length&&(c[e]=f[t])}))}else{u=qi(i.buffer)?o.getBuffer(o.create(i.buffer,$r,!1,!0)):o.getBuffer(i.buffer),D.command(!!u,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|i.offset;D.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var p=0|i.stride;D.command(p>=0&&p<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;D.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var h=!!i.normalized,m=0;"type"in i&&(D.commandParameter(i.type,se,"invalid type for attribute "+e,t.commandStr),m=se[i.type]);var g=0|i.divisor;"divisor"in i&&(D.command(0===g||b,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),D.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),D.optional(function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach(function(t){D.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)})}),c.buffer=u,c.state=Qn,c.size=d,c.normalized=h,c.type=m||u.dtype,c.offset=l,c.stride=p,c.divisor=g}}a[e]=Yi(function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(c).forEach(function(e){r[e]=c[e]}),c.buffer&&(r.buffer=e.link(c.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r})}),Object.keys(i).forEach(function(e){var t=i[e];a[e]=Zi(t,function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,c=o.buffer;D.optional(function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+c+".getBuffer("+i+")||"+c+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')});var u={isStream:r.def(!1)},f=new v;f.state=Qn,Object.keys(f).forEach(function(e){u[e]=r.def(""+f[e])});var l=u.buffer,p=u.type;function d(e){r(u[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",u.isStream,"=true;",l,"=",c,".createStream(",$r,",",i,");",p,"=",l,".dtype;","}else{",l,"=",c,".getBuffer(",i,");","if(",l,"){",p,"=",l,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",Jn,";","if(typeof "+i+'.constant === "number"){',u[Zn[0]],"=",i,".constant;",Zn.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",Zn.map(function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",s,"(",i,".buffer)){",l,"=",c,".createStream(",$r,",",i,".buffer);","}else{",l,"=",c,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",l,".dtype;",u.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",u.isStream,"){",c,".destroyStream(",l,");","}"),u})}),a}(t,u),C.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=Yi(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=Zi(t,function(e,n){return e.invoke(n,t)})}),r}(s),C}function z(e,t,n){var r=e.shared,i=r.context,o=e.scope();Object.keys(n).forEach(function(r){t.save(i,"."+r);var a=n[r];o(i,".",r,"=",a.append(e,t),";")}),t(o)}function I(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;y&&(i=t.def(o.extensions,".webgl_draw_buffers"));var c,u=e.constants,f=u.drawBuffer,l=u.backBuffer;c=n?n.append(e,t):t.def(s,".next"),r||t("if(",c,"!==",s,".cur){"),t("if(",c,"){",a,".bindFramebuffer(",Fi,",",c,".framebuffer);"),y&&t(i,".drawBuffersWEBGL(",f,"[",c,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Fi,",null);"),y&&t(i,".drawBuffersWEBGL(",l,");"),t("}",s,".cur=",c,";"),r||t("}")}function B(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,c=r.next,u=e.cond(s,".dirty");_.forEach(function(t){var r,f,l=A(t);if(!(l in n.state))if(l in a){r=a[l],f=o[l];var p=K(x[l].length,function(e){return u.def(r,"[",e,"]")});u(e.cond(p.map(function(e,t){return e+"!=="+f+"["+t+"]"}).join("||")).then(i,".",C[l],"(",p,");",p.map(function(e,t){return f+"["+t+"]="+e}).join(";"),";"))}else{r=u.def(c,".",l);var d=e.cond(r,"!==",s,".",l);u(d),l in j?d(e.cond(r).then(i,".enable(",j[l],");").else(i,".disable(",j[l],");"),s,".",l,"=",r,";"):d(i,".",C[l],"(",r,");",s,".",l,"=",r,";")}}),0===Object.keys(n.state).length&&u(s,".dirty=false;"),t(u)}function F(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;Gi(Object.keys(n)).forEach(function(i){var c=n[i];if(!r||r(c)){var u=c.append(e,t);if(j[i]){var f=j[i];$i(c)?t(s,u?".enable(":".disable(",f,");"):t(e.cond(u).then(s,".enable(",f,");").else(s,".disable(",f,");")),t(a,".",i,"=",u,";")}else if(Be(u)){var l=o[i];t(s,".",C[i],"(",u,");",u.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(s,".",C[i],"(",u,");",a,".",i,"=",u,";")}})}function L(e,t){b&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function H(e,t,n,r,i){var o,a,s,c=e.shared,u=e.stats,f=c.current,l=c.timer,p=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){o=t.def(),e(o,"=",d(),";"),"string"==typeof i?e(u,".count+=",i,";"):e(u,".count++;"),h&&(r?(a=t.def(),e(a,"=",l,".getNumPendingQueries();")):e(l,".beginQuery(",u,");"))}function v(e){e(u,".cpuTime+=",d(),"-",o,";"),h&&(r?e(l,".pushScopeStats(",a,",",l,".getNumPendingQueries(),",u,");"):e(l,".endQuery();"))}function g(e){var n=t.def(f,".profile");t(f,".profile=",e,";"),t.exit(f,".profile=",n,";")}if(p){if($i(p))return void(p.enable?(m(t),v(t.exit),g("true")):g("false"));g(s=p.append(e,t))}else s=t.def(f,".profile");var b=e.block();m(b),t("if(",s,"){",b,"}");var y=e.block();v(y),t.exit("if(",s,"){",y,"}")}function N(e,t,n,r,i){var o=e.shared;r.forEach(function(r){var a,s=r.name,c=n.attributes[s];if(c){if(!i(c))return;a=c.append(e,t)}else{if(!i(Xi))return;var u=e.scopeAttrib(s);D.optional(function(){e.assert(t,u+".state","missing attribute "+s)}),a={},Object.keys(new v).forEach(function(e){a[e]=t.def(u,".",e)})}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),c=t.def(o.attributes,"[",s,"]"),u=i.state,f=i.buffer,l=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];function d(){t("if(!",c,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",c,".type!==",o,"||",c,".size!==",n,"||",p.map(function(e){return c+"."+e+"!=="+i[e]}).join("||"),"){",a,".bindBuffer(",$r,",",f,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",c,".type=",o,";",c,".size=",n,";",p.map(function(e){return c+"."+e+"="+i[e]+";"}).join(""),"}"),b){var u=i.divisor;t("if(",c,".divisor!==",u,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,u],");",c,".divisor=",u,";}")}}function h(){t("if(",c,".buffer){",a,".disableVertexAttribArray(",s,");",c,".buffer=null;","}if(",Zn.map(function(e,t){return c+"."+e+"!=="+l[t]}).join("||"),"){",a,".vertexAttrib4f(",s,",",l,");",Zn.map(function(e,t){return c+"."+e+"="+l[t]+";"}).join(""),"}")}u===Qn?d():u===Jn?h():(t("if(",u,"===",Qn,"){"),d(),t("}else{"),h(),t("}"))}(e.link(r),function(e){switch(e){case ci:case pi:case vi:return 2;case ui:case di:case gi:return 3;case fi:case hi:case bi:return 4;default:return 1}}(r.info.type),a)})}function W(e,t,r,i,o){for(var a,s=e.shared,c=s.gl,u=0;u<i.length;++u){var f,l=i[u],p=l.name,d=l.info.type,h=r.uniforms[p],m=e.link(l),v=m+".location";if(h){if(!o(h))continue;if($i(h)){var g=h.value;if(D.command(null!=g,'missing uniform "'+p+'"',e.commandStr),d===_i||d===ji){D.command("function"==typeof g&&(d===_i&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||d===ji&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+p,e.commandStr);var b=e.link(g._texture||g.color[0]._texture);t(c,".uniform1i(",v,",",b+".bind());"),t.exit(b,".unbind();")}else if(d===yi||d===xi||d===wi){D.optional(function(){D.command(Be(g),"invalid matrix for uniform "+p,e.commandStr),D.command(d===yi&&4===g.length||d===xi&&9===g.length||d===wi&&16===g.length,"invalid length for matrix uniform "+p,e.commandStr)});var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),x=2;d===xi?x=3:d===wi&&(x=4),t(c,".uniformMatrix",x,"fv(",v,",false,",y,");")}else{switch(d){case si:D.commandType(g,"number","uniform "+p,e.commandStr),a="1f";break;case ci:D.command(Be(g)&&2===g.length,"uniform "+p,e.commandStr),a="2f";break;case ui:D.command(Be(g)&&3===g.length,"uniform "+p,e.commandStr),a="3f";break;case fi:D.command(Be(g)&&4===g.length,"uniform "+p,e.commandStr),a="4f";break;case mi:D.commandType(g,"boolean","uniform "+p,e.commandStr),a="1i";break;case li:D.commandType(g,"number","uniform "+p,e.commandStr),a="1i";break;case vi:case pi:D.command(Be(g)&&2===g.length,"uniform "+p,e.commandStr),a="2i";break;case gi:case di:D.command(Be(g)&&3===g.length,"uniform "+p,e.commandStr),a="3i";break;case bi:case hi:D.command(Be(g)&&4===g.length,"uniform "+p,e.commandStr),a="4i"}t(c,".uniform",a,"(",v,",",Be(g)?Array.prototype.slice.call(g):g,");")}continue}f=h.append(e,t)}else{if(!o(Xi))continue;f=t.def(s.uniforms,"[",n.id(p),"]")}d===_i?t("if(",f,"&&",f,'._reglType==="framebuffer"){',f,"=",f,".color[0];","}"):d===ji&&t("if(",f,"&&",f,'._reglType==="framebufferCube"){',f,"=",f,".color[0];","}"),D.optional(function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){n("typeof "+f+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(s.isArrayLike+"("+f+")&&"+f+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+f+'==="function"&&'+f+'._reglType==="texture'+(t===Zr?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case li:r("number");break;case pi:i(2);break;case di:i(3);break;case hi:i(4);break;case si:r("number");break;case ci:i(2);break;case ui:i(3);break;case fi:i(4);break;case mi:r("boolean");break;case vi:i(2);break;case gi:i(3);break;case bi:case yi:i(4);break;case xi:i(9);break;case wi:i(16);break;case _i:o(Zr);break;case ji:o(Xr)}});var w=1;switch(d){case _i:case ji:var _=t.def(f,"._texture");t(c,".uniform1i(",v,",",_,".bind());"),t.exit(_,".unbind();");continue;case li:case mi:a="1i";break;case pi:case vi:a="2i",w=2;break;case di:case gi:a="3i",w=3;break;case hi:case bi:a="4i",w=4;break;case si:a="1f";break;case ci:a="2f",w=2;break;case ui:a="3f",w=3;break;case fi:a="4f",w=4;break;case yi:a="Matrix2fv";break;case xi:a="Matrix3fv";break;case wi:a="Matrix4fv"}if(t(c,".uniform",a,"(",v,","),"M"===a.charAt(0)){var j=Math.pow(d-yi+2,2),C=e.global.def("new Float32Array(",j,")");t("false,(Array.isArray(",f,")||",f," instanceof Float32Array)?",f,":(",K(j,function(e){return C+"["+e+"]="+f+"["+e+"]"}),",",C,")")}else t(w>1?K(w,function(e){return f+"["+e+"]"}):f);t(");")}}function U(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,c=function(){var i,c=s.elements,u=t;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(u=n),i=c.append(e,u)):i=u.def(a,".",Br),i&&u("if("+i+")"+o+".bindBuffer("+Yr+","+i+".buffer.buffer);"),i}();function u(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var f,l,p=u(Fr),d=u(Lr),h=function(){var i,o=s.count,c=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(c=n),i=o.append(e,c),D.optional(function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(c,i+">=0","missing vertex count")})):(i=c.def(a,".",Rr),D.optional(function(){e.assert(c,i+">=0","missing vertex count")})),i}();if("number"==typeof h){if(0===h)return}else n("if(",h,"){"),n.exit("}");b&&(f=u(Hr),l=e.instancing);var m=c+".type",v=s.elements&&$i(s.elements);function g(){function e(){n(l,".drawElementsInstancedANGLE(",[p,h,m,d+"<<(("+m+"-"+Xn+")>>1)",f],");")}function t(){n(l,".drawArraysInstancedANGLE(",[p,d,h,f],");")}c?v?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[p,h,m,d+"<<(("+m+"-"+Xn+")>>1)"]+");")}function t(){n(o+".drawArrays("+[p,d,h]+");")}c?v?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}b&&("number"!=typeof f||f>=0)?"string"==typeof f?(n("if(",f,">0){"),g(),n("}else if(",f,"<0){"),y(),n("}")):g():y()}function q(e,t,n,r,i){var o=T(),a=o.proc("body",i);return D.optional(function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)}),b&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function G(e,t,n,r){L(e,t),N(e,t,n,r.attributes,function(){return!0}),W(e,t,n,r.uniforms,function(){return!0}),U(e,t,t,n)}function V(e,t,n,r){function i(){return!0}e.batchId="a1",L(e,t),N(e,t,n,r.attributes,i),W(e,t,n,r.uniforms,i),U(e,t,t,n)}function $(e,t,n,r){L(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),c=e.scope();function u(e){return e.contextDep&&i||e.propDep}function f(e){return!u(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",c,"}",s.exit),n.needsContext&&z(e,c,n.context),n.needsFramebuffer&&I(e,c,n.framebuffer),F(e,c,n.state,u),n.profile&&u(n.profile)&&H(e,c,n,!1,!0),r)N(e,s,n,r.attributes,f),N(e,c,n,r.attributes,u),W(e,s,n,r.uniforms,f),W(e,c,n,r.uniforms,u),U(e,s,c,n);else{var l=e.global.def("{}"),p=n.shader.progVar.append(e,c),d=c.def(p,".id"),h=c.def(l,"[",d,"]");c(e.shared.gl,".useProgram(",p,".program);","if(!",h,"){",h,"=",l,"[",d,"]=",e.link(function(t){return q(V,e,n,t,2)}),"(",p,");}",h,".call(this,a0[",o,"],",o,");")}}function Y(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!Be(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(R.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,c=!1,u=e.global.def("{}");o.forEach(function(t){var n=r[t];if(R.isDynamic(n)){"function"==typeof n&&(n=r[t]=R.unbox(n));var o=Zi(n,null);a=a||o.thisDep,c=c||o.propDep,s=s||o.contextDep}else{switch(i(u,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}}),t.dynamic[n]=new R.DynamicVariable(ir,{thisDep:a,contextDep:s,propDep:c,ref:u,append:function(e,t){o.forEach(function(n){var i=r[n];if(R.isDynamic(i)){var o=e.invoke(t,i);t(u,".",n,"=",o,";")}})}}),delete t.static[n]}}return{next:w,current:x,procs:function(){var e=T(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var o,a=e.shared,s=a.gl,c=a.next,u=a.current;r(u,".dirty=false;"),I(e,t),I(e,n,null,!0),b&&(o=e.link(b));for(var f=0;f<i.maxAttributes;++f){var l=n.def(a.attributes,"[",f,"]"),p=e.cond(l,".buffer");p.then(s,".enableVertexAttribArray(",f,");",s,".bindBuffer(",$r,",",l,".buffer.buffer);",s,".vertexAttribPointer(",f,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(s,".disableVertexAttribArray(",f,");",s,".vertexAttrib4f(",f,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),n(p),b&&n(o,".vertexAttribDivisorANGLE(",f,",",l,".divisor);")}return Object.keys(j).forEach(function(i){var o=j[i],a=r.def(c,".",i),f=e.block();f("if(",a,"){",s,".enable(",o,")}else{",s,".disable(",o,")}",u,".",i,"=",a,";"),n(f),t("if(",a,"!==",u,".",i,"){",f,"}")}),Object.keys(C).forEach(function(i){var o,a,f=C[i],l=x[i],p=e.block();if(p(s,".",f,"("),Be(l)){var d=l.length;o=e.global.def(c,".",i),a=e.global.def(u,".",i),p(K(d,function(e){return o+"["+e+"]"}),");",K(d,function(e){return a+"["+e+"]="+o+"["+e+"];"}).join("")),t("if(",K(d,function(e){return o+"["+e+"]!=="+a+"["+e+"]"}).join("||"),"){",p,"}")}else o=r.def(c,".",i),a=r.def(u,".",i),p(o,");",u,".",i,"=",o,";"),t("if(",o,"!==",a,"){",p,"}");n(p)}),e.compile()}(),compile:function(e,t,r,i,o){var a=T();a.stats=a.link(o),Object.keys(t.static).forEach(function(e){Y(a,t,e)}),Vr.forEach(function(t){Y(a,e,t)});var s=P(e,t,r,i,a);return function(e,t){var n=e.proc("draw",1);L(e,n),z(e,n,t.context),I(e,n,t.framebuffer),B(e,n,t),F(e,n,t.state),H(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)G(e,n,t,t.shader.program);else{var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link(function(n){return q(G,e,t,n,1)}),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}z(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),Gi(Object.keys(t.state)).forEach(function(n){var o=t.state[n].append(e,r);Be(o)?o.forEach(function(t,i){r.set(e.next[n],"["+i+"]",t)}):r.set(i.next,"."+n,o)}),H(e,r,t,!0,!0),[Br,Lr,Rr,Hr,Fr].forEach(function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))}),Object.keys(t.uniforms).forEach(function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))}),Object.keys(t.attributes).forEach(function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new v).forEach(function(e){r.set(o,"."+e,i[e])})}),a(zr),a(Ir),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(a,s),function(e,t){var n=e.proc("batch",2);e.batchId="0",L(e,n);var r=!1,i=!0;Object.keys(t.context).forEach(function(e){r=r||t.context[e].propDep}),r||(z(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||I(e,n,o)):I(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),B(e,n,t),F(e,n,t.state,function(e){return!s(e)}),t.profile&&s(t.profile)||H(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var c=t.shader.progVar;if(c.contextDep&&r||c.propDep)$(e,n,t,null);else{var u=c.append(e,n);if(n(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)$(e,n,t,t.shader.program);else{var f=e.global.def("{}"),l=n.def(u,".id"),p=n.def(f,"[",l,"]");n(e.cond(p).then(p,".call(this,a0,a1);").else(p,"=",f,"[",l,"]=",e.link(function(n){return q($,e,t,n,2)}),"(",u,");",p,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),a.compile()}}}var Ji=34918,eo=34919,to=35007,no=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var c=[];function u(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,c.push(r)}var f=[],l=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(to,r),i.push(r),u(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(to)},pushScopeStats:u,update:function(){var e,n,o=i.length;if(0!==o){l.length=Math.max(l.length,o+1),f.length=Math.max(f.length,o+1),f[0]=0,l[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var u=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(u,eo)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(u,Ji),r(u)):i[e++]=u,f[n+1]=a,l[n+1]=e}for(i.length=e,e=0,n=0;n<c.length;++n){var p=c[n],d=p.startQueryIndex,h=p.endQueryIndex;p.sum+=f[h]-f[d];var m=l[d],v=l[h];v===m?(p.stats.gpuTime+=p.sum/1e6,s(p)):(p.startQueryIndex=m,p.endQueryIndex=v,c[e++]=p)}c.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},ro=16384,io=256,oo=1024,ao=34962,so="webglcontextlost",co="webglcontextrestored",uo=1,fo=2,lo=3;function po(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=U(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){D.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)})}}}(i,r);if(!s)return null;var c,u,f=(c={"":0},u=[""],{id:function(e){var t=c[e];return t||(t=c[e]=u.length,u.push(e),t)},str:function(e){return u[e]}}),l={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=s.extensions,d=no(i,p),h=H(),m=i.drawingBufferWidth,v=i.drawingBufferHeight,g={tick:0,time:0,viewportWidth:m,viewportHeight:v,framebufferWidth:m,framebufferHeight:v,drawingBufferWidth:m,drawingBufferHeight:v,pixelRatio:r.pixelRatio},b=te(i,p),y=function(e,t,n,r){for(var i=n.maxAttributes,o=new Array(i),a=0;a<i;++a)o[a]=new Rn;return{Record:Rn,scope:{},state:o}}(0,0,b),x=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=le,this.byteLength=0,this.dimension=1,this.dtype=de,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){l(this)};var c=[];function u(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function f(t,n,r,i,o,a){var s,c;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||he,n.length>0)if(Array.isArray(n[0])){s=fe(n);for(var f=1,l=1;l<s.length;++l)f*=s[l];t.dimension=f,c=ue(n,s,t.dtype),u(t,c,r),a?t.persistentData=c:ee.freeType(c)}else if("number"==typeof n[0]){t.dimension=o;var p=ee.allocType(t.dtype,n.length);ge(p,n),u(t,p,r),a?t.persistentData=p:ee.freeType(p)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||ve(n[0])||he,c=ue(n,[n.length,n[0].length],t.dtype),u(t,c,r),a?t.persistentData=c:ee.freeType(c)):D.raise("invalid buffer data")}else if(e(n))t.dtype=i||ve(n),t.dimension=o,u(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(ne(n)){s=n.shape;var d=n.stride,h=n.offset,m=0,v=0,g=0,b=0;1===s.length?(m=s[0],v=1,g=d[0],b=0):2===s.length?(m=s[0],v=s[1],g=d[0],b=d[1]):D.raise("invalid shape"),t.dtype=i||ve(n.data)||he,t.dimension=v;var y=ee.allocType(t.dtype,m*v);be(y,n.data,m,v,g,b,h),u(t,y,r),a?t.persistentData=y:ee.freeType(y)}else n instanceof ArrayBuffer?(t.dtype=de,t.dimension=o,u(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):D.raise("invalid buffer data")}function l(e){n.bufferCount--;for(var r=0;r<i.state.length;++r){var o=i.state[r];o.buffer===e&&(t.disableVertexAttribArray(r),o.buffer=null)}var s=e.buffer;D(s,"buffer must not be deleted already"),t.deleteBuffer(s),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach(function(t){e+=a[t].stats.size}),e}),{create:function(i,o,c,u){n.bufferCount++;var p=new s(o);function d(n){var i=le,o=null,a=0,s=0,c=1;return Array.isArray(n)||e(n)||ne(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(D.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(D(null===o||Array.isArray(o)||e(o)||ne(o),"invalid data for buffer"),o=n.data),"usage"in n&&(D.parameter(n.usage,ce,"invalid buffer usage"),i=ce[n.usage]),"type"in n&&(D.parameter(n.type,se,"invalid buffer type"),s=se[n.type]),"dimension"in n&&(D.type(n.dimension,"number","invalid dimension"),c=0|n.dimension),"length"in n&&(D.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),p.bind(),o?f(p,o,i,s,c,u):(a&&t.bufferData(p.type,a,i),p.dtype=s||de,p.usage=i,p.dimension=c,p.byteLength=a),r.profile&&(p.stats.size=p.byteLength*me[p.dtype]),d}function h(e,n){D(n+e.byteLength<=p.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+p.byteLength),t.bufferSubData(p.type,n,e)}return a[p.id]=p,c||d(i),d._reglType="buffer",d._buffer=p,d.subdata=function(t,n){var r,i=0|(n||0);if(p.bind(),e(t)||t instanceof ArrayBuffer)h(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=ee.allocType(p.dtype,t.length);ge(o,t),h(o,i),ee.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=fe(t);var a=ue(t,r,p.dtype);h(a,i),ee.freeType(a)}else D.raise("invalid buffer data")}else if(ne(t)){r=t.shape;var s=t.stride,c=0,u=0,f=0,l=0;1===r.length?(c=r[0],u=1,f=s[0],l=0):2===r.length?(c=r[0],u=r[1],f=s[0],l=s[1]):D.raise("invalid shape");var m=Array.isArray(t.data)?p.dtype:ve(t.data),v=ee.allocType(m,c*u);be(v,t.data,c,u,f,l,t.offset),h(v,i),ee.freeType(v)}else D.raise("invalid data for buffer subdata");return d},r.profile&&(d.stats=p.stats),d.destroy=function(){l(p)},d},createStream:function(e,t){var n=c.pop();return n||(n=new s(e)),n.bind(),f(n,t,pe,0,1,!1),n},destroyStream:function(e){c.push(e)},clear:function(){re(a).forEach(l),c.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){re(a).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:f}}(i,l,r,y),w=function(t,n,r,i){var o={},a=0,s={uint8:Ce,uint16:Se};function c(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=_e,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ke),c.prototype.bind=function(){this.buffer.bind()};var u=[];function f(i,o,a,s,c,u,f){if(i.buffer.bind(),o){var l=f;f||e(o)&&(!ne(o)||e(o.data))||(l=n.oes_element_index_uint?ke:Se),r._initBuffer(i.buffer,o,a,l,3)}else t.bufferData(Oe,u,a),i.buffer.dtype=p||Ce,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=u;var p=f;if(!f){switch(i.buffer.dtype){case Ce:case je:p=Ce;break;case Se:case Ae:p=Se;break;case ke:case Ee:p=ke;break;default:D.raise("unsupported type for element array")}i.buffer.dtype=p}i.type=p,D(p!==ke||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=c;d<0&&(d=i.buffer.byteLength,p===Se?d>>=1:p===ke&&(d>>=2)),i.vertCount=d;var h=s;if(s<0){h=_e;var m=i.buffer.dimension;1===m&&(h=xe),2===m&&(h=we),3===m&&(h=_e)}i.primType=h}function l(e){i.elementsCount--,D(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,Oe,!0),a=new c(o._buffer);function u(t){if(t)if("number"==typeof t)o(t),a.primType=_e,a.vertCount=0|t,a.type=Ce;else{var n=null,r=Te,i=-1,c=-1,l=0,p=0;Array.isArray(t)||e(t)||ne(t)?n=t:(D.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,D(Array.isArray(n)||e(n)||ne(n),"invalid data for element buffer")),"usage"in t&&(D.parameter(t.usage,ce,"invalid element buffer usage"),r=ce[t.usage]),"primitive"in t&&(D.parameter(t.primitive,ye,"invalid element buffer primitive"),i=ye[t.primitive]),"count"in t&&(D("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),c=0|t.count),"type"in t&&(D.parameter(t.type,s,"invalid buffer type"),p=s[t.type]),"length"in t?l=0|t.length:(l=c,p===Se||p===Ae?l*=2:p!==ke&&p!==Ee||(l*=4))),f(a,n,r,i,c,l,p)}else o(),a.primType=_e,a.vertCount=0,a.type=Ce;return u}return i.elementsCount++,u(t),u._reglType="elements",u._elements=a,u.subdata=function(e,t){return o.subdata(e,t),u},u.destroy=function(){l(a)},u},createStream:function(e){var t=u.pop();return t||(t=new c(r.create(null,Oe,!0,!1)._buffer)),f(t,e,Me,-1,-1,0,0),t},destroyStream:function(e){u.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof c?e._elements:null},clear:function(){re(o).forEach(l)}}}(i,p,x,l),_=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(n,r,a){var s=n===Ln?i:o,c=s[r];if(!c){var u=t.str(r);c=e.createShader(n),e.shaderSource(c,u),e.compileShader(c),D.shaderError(e,c,u,n,a),s[r]=c}return c}var u={},f=[],l=0;function p(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,i){var o,u,f=c(Ln,n.fragId),l=c(Hn,n.vertId),p=n.program=e.createProgram();e.attachShader(p,f),e.attachShader(p,l),e.linkProgram(p),D.linkError(e,p,t.str(n.fragId),t.str(n.vertId),i);var d=e.getProgramParameter(p,Nn);r.profile&&(n.stats.uniformsCount=d);var h=n.uniforms;for(o=0;o<d;++o)if(u=e.getActiveUniform(p,o))if(u.size>1)for(var m=0;m<u.size;++m){var v=u.name.replace("[0]","["+m+"]");s(h,new a(v,t.id(v),e.getUniformLocation(p,v),u))}else s(h,new a(u.name,t.id(u.name),e.getUniformLocation(p,u.name),u));var g=e.getProgramParameter(p,Wn);r.profile&&(n.stats.attributesCount=g);var b=n.attributes;for(o=0;o<g;++o)(u=e.getActiveAttrib(p,o))&&s(b,new a(u.name,t.id(u.name),e.getAttribLocation(p,u.name),u))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return f.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return f.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);re(i).forEach(t),i={},re(o).forEach(t),o={},f.forEach(function(t){e.deleteProgram(t.program)}),f.length=0,u={},n.shaderCount=0},program:function(e,t,r){D.command(e>=0,"missing vertex shader",r),D.command(t>=0,"missing fragment shader",r);var i=u[t];i||(i=u[t]={});var o=i[e];return o||(o=new p(t,e),n.shaderCount++,d(o,r),i[e]=o,f.push(o)),o},restore:function(){i={},o={};for(var e=0;e<f.length;++e)d(f[e])},shader:c,frag:-1,vert:-1}}(i,f,l,r),j=dn(i,p,b,function(){S.procs.poll()},g,l,r),C=bn(i,p,b,l,r),A=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},c=["rgba"],u=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&u.push("srgba"),n.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&u.push("rgba32f");var f=["uint8"];function l(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);D(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;D(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function h(t,n){n&&(n.texture?e.framebufferTexture2D(yn,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(yn,t,xn,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=wn,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),D.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,D(t===wn)):"textureCube"===o?(n=i,D(t>=_n&&t<_n+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=xn):D.raise("invalid regl object for attachment"),new l(t,n,r)}function v(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new l(wn,s,null)}var c=o.create({width:e,height:t,format:r});return c._renderbuffer.refCount=0,new l(xn,null,c)}function g(e){return e&&(e.texture||e.renderbuffer)}function b(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _(e){e.colorAttachments.forEach(p),p(e.depthAttachment),p(e.stencilAttachment),p(e.depthStencilAttachment)}function j(t){var n=t.framebuffer;D(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete x[t.id]}function C(t){var n;e.bindFramebuffer(yn,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)h(jn+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(yn,jn+n,wn,null,0);e.framebufferTexture2D(yn,Sn,wn,null,0),e.framebufferTexture2D(yn,Cn,wn,null,0),e.framebufferTexture2D(yn,An,wn,null,0),h(Cn,t.depthAttachment),h(An,t.stencilAttachment),h(Sn,t.depthStencilAttachment);var o=e.checkFramebufferStatus(yn);e.isContextLost()||o===En||D.raise("framebuffer configuration not supported, status = "+Bn[o]),e.bindFramebuffer(yn,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function A(e,i){var o=new w;function l(e,t){var i;D(s.next!==o,"can not update framebuffer which is currently in use");var a=0,p=0,h=!0,b=!0,y=null,x=!0,w="rgba",j="uint8",A=1,S=null,E=null,k=null,O=!1;if("number"==typeof e)a=0|e,p=0|t||a;else if(e){D.type(e,"object","invalid arguments for framebuffer");var M=e;if("shape"in M){var T=M.shape;D(Array.isArray(T)&&T.length>=2,"invalid shape for framebuffer"),a=T[0],p=T[1]}else"radius"in M&&(a=p=M.radius),"width"in M&&(a=M.width),"height"in M&&(p=M.height);("color"in M||"colors"in M)&&(y=M.color||M.colors,Array.isArray(y)&&D(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in M&&(A=0|M.colorCount,D(A>0,"invalid color buffer count")),"colorTexture"in M&&(x=!!M.colorTexture,w="rgba4"),"colorType"in M&&(j=M.colorType,x?(D(n.oes_texture_float||!("float"===j||"float32"===j),"you must enable OES_texture_float in order to use floating point framebuffer objects"),D(n.oes_texture_half_float||!("half float"===j||"float16"===j),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===j||"float16"===j?(D(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==j&&"float32"!==j||(D(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),D.oneOf(j,f,"invalid color type")),"colorFormat"in M&&(w=M.colorFormat,c.indexOf(w)>=0?x=!0:u.indexOf(w)>=0?x=!1:x?D.oneOf(M.colorFormat,c,"invalid color format for texture"):D.oneOf(M.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in M||"depthStencilTexture"in M)&&(O=!(!M.depthTexture&&!M.depthStencilTexture),D(!O||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in M&&("boolean"==typeof M.depth?h=M.depth:(S=M.depth,b=!1)),"stencil"in M&&("boolean"==typeof M.stencil?b=M.stencil:(E=M.stencil,h=!1)),"depthStencil"in M&&("boolean"==typeof M.depthStencil?h=b=M.depthStencil:(k=M.depthStencil,h=!1,b=!1))}else a=p=1;var P=null,z=null,I=null,B=null;if(Array.isArray(y))P=y.map(m);else if(y)P=[m(y)];else for(P=new Array(A),i=0;i<A;++i)P[i]=v(a,p,x,w,j);D(n.webgl_draw_buffers||P.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),D(P.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||P[0].width,p=p||P[0].height,S?z=m(S):h&&!b&&(z=v(a,p,O,"depth","uint32")),E?I=m(E):b&&!h&&(I=v(a,p,!1,"stencil","uint8")),k?B=m(k):!S&&!E&&b&&h&&(B=v(a,p,O,"depth stencil","depth stencil")),D(!!S+!!E+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<P.length;++i)if(d(P[i],a,p),D(!P[i]||P[i].texture&&On.indexOf(P[i].texture._texture.format)>=0||P[i].renderbuffer&&In.indexOf(P[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),P[i]&&P[i].texture){var R=Mn[P[i].texture._texture.format]*Tn[P[i].texture._texture.type];null===F?F=R:D(F===R,"all color attachments much have the same number of bits per pixel.")}return d(z,a,p),D(!z||z.texture&&z.texture._texture.format===kn||z.renderbuffer&&z.renderbuffer._renderbuffer.format===Dn,"invalid depth attachment for framebuffer object"),d(I,a,p),D(!I||I.renderbuffer&&I.renderbuffer._renderbuffer.format===Pn,"invalid stencil attachment for framebuffer object"),d(B,a,p),D(!B||B.texture&&B.texture._texture.format===zn||B.renderbuffer&&B.renderbuffer._renderbuffer.format===zn,"invalid depth-stencil attachment for framebuffer object"),_(o),o.width=a,o.height=p,o.colorAttachments=P,o.depthAttachment=z,o.stencilAttachment=I,o.depthStencilAttachment=B,l.color=P.map(g),l.depth=g(z),l.stencil=g(I),l.depthStencil=g(B),l.width=o.width,l.height=o.height,C(o),l}return a.framebufferCount++,l(e,i),t(l,{resize:function(e,t){D(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return l;for(var i=o.colorAttachments,a=0;a<i.length;++a)b(i[a],n,r);return b(o.depthAttachment,n,r),b(o.stencilAttachment,n,r),b(o.depthStencilAttachment,n,r),o.width=l.width=n,o.height=l.height=r,C(o),l},_reglType:"framebuffer",_framebuffer:o,destroy:function(){j(o),_(o)},use:function(e){s.setFBO({framebuffer:l},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:A,createCube:function(e){var o=Array(6);function a(e){var r;D(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var u,l={color:null},p=0,d=null,h="rgba",m="uint8",v=1;if("number"==typeof e)p=0|e;else if(e){D.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var b=g.shape;D(Array.isArray(b)&&b.length>=2,"invalid shape for framebuffer"),D(b[0]===b[1],"cube framebuffer must be square"),p=b[0]}else"radius"in g&&(p=0|g.radius),"width"in g?(p=0|g.width,"height"in g&&D(g.height===p,"must be square")):"height"in g&&(p=0|g.height);("color"in g||"colors"in g)&&(d=g.color||g.colors,Array.isArray(d)&&D(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in g&&(v=0|g.colorCount,D(v>0,"invalid color buffer count")),"colorType"in g&&(D.oneOf(g.colorType,f,"invalid color type"),m=g.colorType),"colorFormat"in g&&(h=g.colorFormat,D.oneOf(g.colorFormat,c,"invalid color format for texture"))),"depth"in g&&(l.depth=g.depth),"stencil"in g&&(l.stencil=g.stencil),"depthStencil"in g&&(l.depthStencil=g.depthStencil)}else p=1;if(d)if(Array.isArray(d))for(u=[],r=0;r<d.length;++r)u[r]=d[r];else u=[d];else{u=Array(v);var y={radius:p,format:h,type:m};for(r=0;r<v;++r)u[r]=i.createCube(y)}for(l.color=Array(u.length),r=0;r<u.length;++r){var x=u[r];D("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),p=p||x.width,D(x.width===p&&x.height===p,"invalid cube map shape"),l.color[r]={target:_n,data:u[r]}}for(r=0;r<6;++r){for(var w=0;w<u.length;++w)l.color[w].target=_n+r;r>0&&(l.depth=o[0].depth,l.stencil=o[0].stencil,l.depthStencil=o[0].depthStencil),o[r]?o[r](l):o[r]=A(l)}return t(a,{width:p,height:p,color:u})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(D(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach(function(e){e.destroy()})}})},clear:function(){re(x).forEach(j)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,re(x).forEach(function(t){t.framebuffer=e.createFramebuffer(),C(t)})}})}(i,p,b,j,C,l),S=Qi(i,f,p,b,x,w,0,A,{},y,_,{elements:null,primitive:4,count:-1,offset:0,instances:-1},g,d,r),E=Vn(i,A,S.procs.poll,g,o,p,b),k=S.next,O=i.canvas,M=[],T=[],P=[],z=[r.onDestroy],I=null;function B(){if(0===M.length)return d&&d.update(),void(I=null);I=L.next(B),Z();for(var e=M.length-1;e>=0;--e){var t=M[e];t&&t(g,null,0)}i.flush(),d&&d.update()}function F(){!I&&M.length>0&&(I=L.next(B))}function N(){I&&(L.cancel(B),I=null)}function W(e){e.preventDefault(),a=!0,N(),T.forEach(function(e){e()})}function K(e){i.getError(),a=!1,s.restore(),_.restore(),x.restore(),j.restore(),C.restore(),A.restore(),d&&d.restore(),S.procs.refresh(),F(),P.forEach(function(e){e()})}function q(e){function n(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];R.isDynamic(i)?n[r]=R.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}D(!!e,"invalid args to regl({...})"),D.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),n}(e)),c={gpuTime:0,cpuTime:0,count:0},u=S.compile(s,o,i,r,c),f=u.draw,l=u.batch,p=u.scope,d=[];return t(function(e,t){var n;if(a&&D.raise("context lost"),"function"==typeof e)return p.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(n=0;n<e;++n)p.call(this,null,t,n);return}if(Array.isArray(e)){for(n=0;n<e.length;++n)p.call(this,e[n],t,n);return}return p.call(this,e,t,0)}if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;d.length<e;)d.push(null);return d}(0|e),0|e)}else{if(!Array.isArray(e))return f.call(this,e);if(e.length)return l.call(this,e,e.length)}},{stats:c})}O&&(O.addEventListener(so,W,!1),O.addEventListener(co,K,!1));var G=A.setFBO=q({framebuffer:R.define.call(null,uo,"framebuffer")});function V(e,t){var n=0;S.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=ro),"depth"in t&&(i.clearDepth(+t.depth),n|=io),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=oo),D(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function $(e){return D.type(e,"function","regl.frame() callback must be a function"),M.push(e),F(),{cancel:function(){var t=po(M,e);D(t>=0,"cannot cancel a frame twice"),M[t]=function e(){var t=po(M,e);M[t]=M[M.length-1],M.length-=1,M.length<=0&&N()}}}}function Y(){var e=k.viewport,t=k.scissor_box;e[0]=e[1]=t[0]=t[1]=0,g.viewportWidth=g.framebufferWidth=g.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,g.viewportHeight=g.framebufferHeight=g.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function Z(){g.tick+=1,g.time=Q(),Y(),S.procs.poll()}function X(){Y(),S.procs.refresh(),d&&d.update()}function Q(){return(H()-h)/1e3}X();var J=t(q,{clear:function(e){if(D("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)G(t({framebuffer:e.framebuffer.faces[n]},e),V);else G(e,V);else V(null,e)},prop:R.define.bind(null,uo),context:R.define.bind(null,fo),this:R.define.bind(null,lo),draw:q({}),buffer:function(e){return x.create(e,ao,!1,!1)},elements:function(e){return w.create(e,!1)},texture:j.create2D,cube:j.createCube,renderbuffer:C.create,framebuffer:A.create,framebufferCube:A.createCube,attributes:o,frame:$,on:function(e,t){var n;switch(D.type(t,"function","listener callback must be a function"),e){case"frame":return $(t);case"lost":n=T;break;case"restore":n=P;break;case"destroy":n=z;break;default:D.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:b,hasExtension:function(e){return b.extensions.indexOf(e.toLowerCase())>=0},read:E,destroy:function(){M.length=0,N(),O&&(O.removeEventListener(so,W),O.removeEventListener(co,K)),_.clear(),A.clear(),C.clear(),j.clear(),w.clear(),x.clear(),d&&d.clear(),z.forEach(function(e){e()})},_gl:i,_refresh:X,poll:function(){Z(),d&&d.update()},now:Q,stats:l});return r.onDone(null,J),J}}()});var Ia=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};class Ba{constructor(){o(this,"_objectsByObjectHitmapIdMap",{}),o(this,"_commandsByObjectMap",new Map),o(this,"_nextObjectHitmapId",1),o(this,"_instanceIndexByObjectHitmapIdMap",{}),o(this,"assignNextColors",(e,t,n)=>{if(n<1)throw new Error("Must get at least 1 id");const r=function(e,t){return new Array(t).fill(0).map((t,n)=>e+n)}(this._nextObjectHitmapId,n);this._nextObjectHitmapId=Ia(r)+1,n>1&&r.forEach((e,t)=>{this._instanceIndexByObjectHitmapIdMap[e]=t});for(const e of r)this._objectsByObjectHitmapIdMap[e]=t;return this._commandsByObjectMap.set(t,e),r.map(e=>so(e))}),o(this,"getObjectByObjectHitmapId",e=>({object:this._objectsByObjectHitmapIdMap[e],instanceIndex:this._instanceIndexByObjectHitmapIdMap[e]})),o(this,"getCommandForObject",e=>this._commandsByObjectMap.get(e))}}function Fa(e,t){const n=t(e);return"function"==typeof n?n:e(n)}class Ra{constructor({dimension:e,canvasBackgroundColor:t,cameraState:n,onCameraStateChange:r}){o(this,"_commands",new Set),o(this,"_compiled",new Map),o(this,"_drawCalls",new Map),o(this,"_paintCalls",new Map),o(this,"_hitmapObjectIdManager",new Ba),o(this,"reglCommandObjects",[]),o(this,"counters",{}),o(this,"dimension",void 0),o(this,"onDirty",void 0),o(this,"cameraStore",void 0),o(this,"canvasBackgroundColor",[0,0,0,1]),o(this,"initializedData",void 0),o(this,"raycast",(e,t)=>{if(!this.initializedData)return;const{width:n,height:r}=this.dimension;return wa(this.initializedData.camera,{clientX:e,clientY:t,width:n,height:r})}),o(this,"_debouncedPaint",Pa(this.paint,10)),o(this,"_drawInput",(e,t)=>{e&&(this._hitmapObjectIdManager=new Ba),Array.from(this._drawCalls.values()).sort((e,t)=>(e.layerIndex||0)-(t.layerIndex||0)).forEach(n=>{const{reglCommand:r,children:i,instance:o,getChildrenForHitmap:a}=n;if(!i)return console.debug(`${e?"hitmap":""} draw skipped, props was falsy`,n);const s=this._compiled.get(r);if(!s)return console.warn("could not find draw command for",o?o.constructor.displayName:"Unknown");if(e&&a){const e=a(i,(...e)=>this._hitmapObjectIdManager.assignNextColors(o,...e),t||[]);e&&s(e,!0)}else e||s(i,!1)})}),o(this,"_clearCanvas",e=>{e.poll(),e.clear({color:this.canvasBackgroundColor,depth:1})}),this.onDirty=this._debouncedPaint,this.dimension=e,this.canvasBackgroundColor=t,this.cameraStore=new Mo(e=>{r?r(e):this.paint()},n)}initialize(e){if(this.initializedData)throw new Error("can not initialize regl twice");const t=this._instrumentCommands(za({canvas:e,extensions:["angle_instanced_arrays","oes_texture_float","oes_element_index_uint"],profile:"production"!==ha()}));this._commands.forEach(e=>{const n=Fa(t,e);this._compiled.set(e,n)});const n=new(Fa(t,Vo)),r=t.framebuffer({width:Math.round(this.dimension.width),height:Math.round(this.dimension.height)});this.initializedData={_fbo:r,camera:n,regl:t}}destroy(){this.initializedData&&this.initializedData.regl.destroy()}onMount(e,t){const{initializedData:n}=this;n&&!this._commands.has(t)&&(this._commands.add(t),this._compiled.set(t,Fa(n.regl,t)))}onUnmount(e){this._drawCalls.delete(e)}unregisterPaintCallback(e){this._paintCalls.delete(e)}registerDrawCall(e){this._drawCalls.set(e.instance,e)}registerPaintCallback(e){this._paintCalls.set(e,e)}setDimension(e){this.dimension=e}paint(){const e=Date.now();if(this.reglCommandObjects.forEach(e=>e.stats.count=0),!this.initializedData)return;const{regl:t,camera:n}=this.initializedData;this._clearCanvas(t),n.draw(this.cameraStore.state,()=>{const e=Date.now();this._drawInput(),this.counters.paint=Date.now()-e}),this._paintCalls.forEach(e=>{e()}),this.counters.render=Date.now()-e}readHitmapBox(e,t,n=1,r=1){if(!this.initializedData)return new Promise((e,t)=>t(new Error("regl data not initialized yet")));const{regl:i,camera:o,_fbo:a}=this.initializedData,{width:s,height:c}=this.dimension,u=e,f=c-t;return a.resize(Math.floor(s),Math.floor(c)),new Promise(e=>{i({framebuffer:a})(()=>{i.clear({color:so(0),depth:1});const t=[],a=[];o.draw(this.cameraStore.state,()=>{i.clear({color:so(0),depth:1}),this._drawInput(!0,t),uo(i.read({x:u,y:f,width:n,height:r})).forEach(e=>{const n=this._hitmapObjectIdManager.getObjectByObjectHitmapId(e);if(e>0&&n.object){const e=this._hitmapObjectIdManager.getCommandForObject(n.object);t.push(n),e&&a.push([n,e])}}),e(a)})})})}readHitmap(e,t,n,r){if(!this.initializedData)return new Promise((e,t)=>t(new Error("regl data not initialized yet")));const{regl:i,camera:o,_fbo:a}=this.initializedData,{width:s,height:c}=this.dimension,u=e,f=c-t;return a.resize(Math.floor(s),Math.floor(c)),new Promise(e=>{i({framebuffer:a})(()=>{i.clear({color:so(0),depth:1});let t=0;const a=[],l=[];let p=0;o.draw(this.cameraStore.state,()=>{do{if(p>=r){console.error(`Hit ${r} iterations. There is either a bug or that number of rendered hitmap layers under the mouse cursor.`);break}if(p++,i.clear({color:so(0),depth:1}),this._drawInput(!0,a),u<Math.floor(s)&&f<Math.floor(c)&&u>=0&&f>=0){const e=new Uint8Array(4);i.read({x:u,y:f,width:1,height:1,data:e}),t=co(e);const n=this._hitmapObjectIdManager.getObjectByObjectHitmapId(t);if(t>0&&!n&&console.error(`Clicked on an unknown object with id ${t}. This likely means that a command is painting an incorrect color into the hitmap.`),a.some(({object:e,instanceIndex:t})=>e===n.object&&t===n.instanceIndex)){console.error("Saw object twice when reading from hitmap. There is likely an error in getHitmapFromChildren",n);break}if(t>0&&n.object){const e=this._hitmapObjectIdManager.getCommandForObject(n.object);a.push(n),e&&l.push([n,e])}}}while(0!==t&&n);e(l)})})})}_instrumentCommands(e){return"production"===ha()?e:new Proxy(e,{apply:(e,t,n)=>{const r=e(...n);return"object"==typeof r.stats&&this.reglCommandObjects.push(r),r}})}}const La=[0,0,0,1],Ha=3;function Na(e,t,n,r){const i={ray:t,objects:e};try{r(n,i)}catch(e){console.error("Error during mouse handler",e)}}class Wa extends n.Component{constructor(e){super(e),o(this,"_canvas",n.createRef()),o(this,"_tick",void 0),o(this,"_dragStartPos",null),o(this,"_onDoubleClick",e=>{this._onMouseInteraction(e,"onDoubleClick")}),o(this,"_onMouseDown",e=>{this._dragStartPos={x:e.clientX,y:e.clientY},this._onMouseInteraction(e,"onMouseDown")}),o(this,"_onMouseMove",e=>{const{_dragStartPos:t}=this;if(!t)return void this._onMouseInteraction(e,"onMouseMove");const n=e.clientX-t.x,r=e.clientY-t.y;Math.sqrt(n*n+r*r)<Ha?this._onMouseInteraction(e,"onMouseMove"):this._onMouseDragInteraction(e,"onMouseMove")}),o(this,"_onMouseUp",e=>{const{_dragStartPos:t}=this;if(!t)return void this._onMouseInteraction(e,"onMouseUp");const n=e.clientX-t.x,r=e.clientY-t.y;if(Math.sqrt(n*n+r*r)<Ha)return this._onMouseInteraction(e,"onMouseUp"),this._onMouseInteraction(e,"onClick"),void(this._dragStartPos=null);this._onMouseDragInteraction(e,"onMouseUp"),this._dragStartPos=null}),o(this,"_onMouseDragInteraction",(e,t)=>{const{_dragStartPos:n}=this;if(!n)return;const r=e.clientX-n.x,i=e.clientY-n.y,{worldviewContext:o}=this.state,a=this.props[t];if(!(e.target instanceof window.HTMLElement)||0!==e.button)return;const{top:s,left:c}=e.target.getBoundingClientRect(),{clientX:u,clientY:f}=e,l=u-c,p=f-s,d=o.raycast(l,p);if(!d)return;const h=r>0?l-r:l,m=i>0?p:p-i;e.persist(),o.readHitmapBox(h,m,Math.abs(r),Math.abs(i)).then(n=>{const r=ga(n);for(const[n,i]of r.entries())if(n.handleMouseEvent(i,d,e,t),e.isPropagationStopped())break;if(a&&!e.isPropagationStopped()){Na(n.map(([e])=>e),d,e,a)}}).catch(e=>{console.error(e)})}),o(this,"_onMouseInteraction",(e,t)=>{const{worldviewContext:n}=this.state,r=this.props[t];if(!(e.target instanceof window.HTMLElement)||0!==e.button)return;const{top:i,left:o}=e.target.getBoundingClientRect(),{clientX:a,clientY:s}=e,c=a-o,u=s-i,f=n.raycast(c,u);if(f){if("onMouseMove"===t&&!this.props.hitmapOnMouseMove)return r?Na([],f,e,r):void 0;e.persist(),n.readHitmap(c,u,!!this.props.enableStackedObjectEvents,this.props.maxStackedObjectCount).then(n=>{const i=ga(n);for(const[n,r]of i.entries())if(n.handleMouseEvent(r,f,e,t),e.isPropagationStopped())break;if(r&&!e.isPropagationStopped()){Na(n.map(([e])=>e),f,e,r)}}).catch(e=>{console.error(e)})}});const{width:t,height:r,top:i,left:a,backgroundColor:s,onCameraStateChange:c,cameraState:u,defaultCameraState:f}=e;c?(u||console.warn("You provided `onCameraStateChange` without `cameraState`. Use Worldview as a controlled component with `cameraState` and `onCameraStateChange`, or uncontrolled with `defaultCameraState`."),u&&f&&console.warn("You provided both `cameraState` and `defaultCameraState`. `defaultCameraState` will be ignored.")):u&&console.warn("You provided `cameraState` without an `onCameraStateChange` handler. This will prevent moving the camera. If the camera should be movable, use `defaultCameraState`, otherwise set `onCameraStateChange`."),this.state={worldviewContext:new Ra({dimension:{width:t,height:r,top:i,left:a},canvasBackgroundColor:s||La,cameraState:e.cameraState||e.defaultCameraState||Oo,onCameraStateChange:e.onCameraStateChange||void 0})}}static getDerivedStateFromProps({width:e,height:t,top:n,left:r},{worldviewContext:i}){return i.setDimension({width:e,height:t,top:n,left:r}),null}componentDidMount(){if(!this._canvas.current)return console.warn("missing canvas element");const{worldviewContext:e}=this.state;e.initialize(this._canvas.current),this.setState({}),e.paint()}componentWillUnmount(){this._tick&&cancelAnimationFrame(this._tick),this.state.worldviewContext.destroy()}componentDidUpdate(){const{worldviewContext:e}=this.state;this.props.cameraState&&e.cameraStore.setCameraState(this.props.cameraState),this._tick||(this._tick=requestAnimationFrame(()=>{this._tick=void 0;try{e.paint()}catch(e){if("(regl) context lost"!==e.message)throw e;console.warn(e)}}))}_renderDebug(){const{worldviewContext:e}=this.state,t=e.initializedData;if("production"===ha()||!t)return null;const{regl:r}=t,i=window.performance.memory,{counters:o,reglCommandObjects:a}=e,s=ar(o,e=>`${e} ms`);if(s["draw calls"]=a.reduce((e,t)=>e+t.stats.count,0),i&&(s["heap used"]=`${(i.usedJSHeapSize/i.jsHeapSizeLimit*100).toFixed(3)}%`),Object.assign(s,br(r.stats,e=>"number"==typeof e&&0!==e)),r.stats.bufferCount>1e3)throw new Error("Memory leak: Buffer count > 1000.");const c=Object.keys(s).map(e=>n.createElement("tr",{key:e,style:{backgroundColor:"transparent",border:"none"}},n.createElement("td",{style:{paddingRight:10,border:"none"}},e),n.createElement("td",{style:{width:"100%",border:"none"}},s[e])));return n.createElement("table",{style:{bottom:5,right:10,width:200,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",fontFamily:"monospace",fontSize:10}},n.createElement("tbody",null,c))}render(){const{width:e,height:t,showDebug:r,keyMap:i,shiftKeys:o,style:s,cameraState:c,onCameraStateChange:u}=this.props,{worldviewContext:f}=this.state,l=c&&!u,p=n.createElement(n.Fragment,null,n.createElement("canvas",{style:{width:e,height:t,maxWidth:"100%",maxHeight:"100%"},width:e,height:t,ref:this._canvas,onMouseUp:this._onMouseUp,onMouseDown:this._onMouseDown,onDoubleClick:this._onDoubleClick,onMouseMove:this._onMouseMove}),r&&this._renderDebug());return n.createElement("div",{style:a({position:"relative",overflow:"hidden"},s)},l?p:n.createElement(da,{cameraStore:f.cameraStore,keyMap:i,shiftKeys:o},p),f.initializedData&&n.createElement(ma.Provider,{value:f},this.props.children))}}o(Wa,"defaultProps",{maxStackedObjectCount:100,backgroundColor:La,shiftKeys:!0,style:{}});const Ua=e=>n.createElement(Yr,null,({width:t,height:r,left:o,top:a})=>n.createElement(Wa,i({width:t,height:r,left:o,top:a},e)));Ua.displayName="Worldview";class Ka{constructor(){o(this,"min",void 0),o(this,"max",void 0),this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER}update(e){this.min=Math.min(this.min,e),this.max=Math.max(this.max,e)}}const qa=[0,0,0,0,0,0,0,0,0];var Ga=(e,t)=>n=>{const r=Float32Array.from([].concat(...e));if(t.some(e=>e.some(e=>e<0||e>=65536)))throw new Error("Element index out of bounds for Uint16");const i=Uint16Array.from([].concat(...t)),o=n.buffer({usage:"dynamic",data:[]}),a=oo(n);return ro({vert:"\n    precision mediump float;\n    attribute vec3 point;\n    attribute vec3 offset;\n    attribute vec4 color;\n    uniform mat4 projection, view;\n    uniform vec3 scale;\n    varying vec4 vColor;\n\n    #WITH_POSE\n\n    void main () {\n      vec3 p = applyPose(scale * point) + offset;\n      vColor = color;\n      gl_Position = projection * view * vec4(p, 1);\n    }\n    ",frag:"\n    precision mediump float;\n    varying vec4 vColor;\n    void main () {\n      gl_FragColor = vColor;\n    }",attributes:{point:r,color:(e,t)=>a(t.color,t.colors,t.points?t.points.length:1),offset:(e,t)=>{const n=ao(t.points)?t.points.map(Wi):t.points||[0,0,0];return{buffer:o({usage:"dynamic",data:n}),divisor:1}}},elements:i,depth:eo,blend:to,uniforms:{scale:(e,t)=>ao(t.scale)?Wi(t.scale):t.scale},count:i.length,instances:(e,t)=>t.points?t.points.length:1})};async function Va(e){const t=new DataView(e);let n=0;function r(){const e=t.getUint32(n,!0);return n+=4,e}const i=r();if(1179937895!==i)throw new Error(`incorrect magic value 0x${i.toString(16)}`);const o=r();if(2!==o)throw new Error(`incorrect version ${o}`);const a=r();if(a!==t.byteLength)throw new Error(`length ${a} doesn't match response length ${t.byteLength}`);function s(e){do{const i=r();if(r()===e){const e=new DataView(t.buffer,n,i);return n+=i,e}n+=i}while(n<a)}const c=s(1313821514);if(!c)throw new Error("no JSON chunk found");const u=JSON.parse((new TextDecoder).decode(c)),f=s(5130562);if(!f)return{json:u};if(void 0!==u.buffers[0].uri)throw new Error("expected GLB-stored buffer");const l=u.accessors.map(e=>{let t,n;switch(e.componentType){case WebGLRenderingContext.BYTE:t=Int8Array;break;case WebGLRenderingContext.UNSIGNED_BYTE:t=Uint8Array;break;case WebGLRenderingContext.SHORT:t=Int16Array;break;case WebGLRenderingContext.UNSIGNED_SHORT:t=Uint16Array;break;case WebGLRenderingContext.UNSIGNED_INT:t=Uint32Array;break;case WebGLRenderingContext.FLOAT:t=Float32Array;break;default:throw new Error(`unrecognized componentType ${e.componentType}`)}switch(e.type){case"SCALAR":n=1;break;case"VEC2":n=2;break;case"VEC3":n=3;break;case"VEC4":case"MAT2":n=4;break;case"MAT3":n=9;break;case"MAT4":n=16;break;default:throw new Error(`unrecognized type ${e.type}`)}const r=u.bufferViews[e.bufferView];if(0!==r.buffer)throw new Error("only GLB-stored buffers are supported");if(r.byteLength%t.BYTES_PER_ELEMENT!=0)throw new Error("bufferView.byteLength mismatch");return new t(f.buffer,f.byteOffset+(r.byteOffset||0)+(e.byteOffset||0),e.count*n)}),p=u.images&&await Promise.all(u.images.map(e=>{const t=u.bufferViews[e.bufferView],n=new DataView(f.buffer,f.byteOffset+t.byteOffset,t.byteLength);return self.createImageBitmap(new Blob([n],{type:e.mimeType}))}));return{json:u,accessors:l,images:p}}var $a=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};var Ya=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?V(n,s,c):cr(n,s,c)}return n};var Za=function(e,t){return e&&Ya(t,Se(t),e)};var Xa=function(e,t){return e&&Ya(t,vr(t),e)},Qa=u(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?p.Buffer:void 0,o=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}});var Ja=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};var es=function(e,t){return Ya(e,Yt(e),t)};var ts=function(e,t){return Ya(e,pr(e),t)},ns=Object.prototype.hasOwnProperty;var rs=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ns.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var is=function(e){var t=new e.constructor(e.byteLength);return new Ct(t).set(new Ct(e)),t};var os=function(e,t){var n=t?is(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},as=/\w*$/;var ss=function(e){var t=new e.constructor(e.source,as.exec(e));return t.lastIndex=e.lastIndex,t},cs=d?d.prototype:void 0,us=cs?cs.valueOf:void 0;var fs=function(e){return us?Object(us.call(e)):{}};var ls=function(e,t){var n=t?is(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},ps="[object Boolean]",ds="[object Date]",hs="[object Map]",ms="[object Number]",vs="[object RegExp]",gs="[object Set]",bs="[object String]",ys="[object Symbol]",xs="[object ArrayBuffer]",ws="[object DataView]",_s="[object Float32Array]",js="[object Float64Array]",Cs="[object Int8Array]",As="[object Int16Array]",Ss="[object Int32Array]",Es="[object Uint8Array]",ks="[object Uint8ClampedArray]",Os="[object Uint16Array]",Ms="[object Uint32Array]";var Ts=function(e,t,n){var r=e.constructor;switch(t){case xs:return is(e);case ps:case ds:return new r(+e);case ws:return os(e,n);case _s:case js:case Cs:case As:case Ss:case Es:case ks:case Os:case Ms:return ls(e,n);case hs:return new r;case ms:case bs:return new r(e);case vs:return ss(e);case gs:return new r;case ys:return fs(e)}},Ds=Object.create,Ps=function(){function e(){}return function(t){if(!A(t))return{};if(Ds)return Ds(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var zs=function(e){return"function"!=typeof e.constructor||xe(e)?{}:Ps(lr(e))},Is="[object Map]";var Bs=function(e){return Z(e)&&ln(e)==Is},Fs=he&&he.isMap,Rs=Fs?de(Fs):Bs,Ls="[object Set]";var Hs=function(e){return Z(e)&&ln(e)==Ls},Ns=he&&he.isSet,Ws=Ns?de(Ns):Hs,Us=1,Ks=2,qs=4,Gs="[object Arguments]",Vs="[object Function]",$s="[object GeneratorFunction]",Ys="[object Object]",Zs={};Zs[Gs]=Zs["[object Array]"]=Zs["[object ArrayBuffer]"]=Zs["[object DataView]"]=Zs["[object Boolean]"]=Zs["[object Date]"]=Zs["[object Float32Array]"]=Zs["[object Float64Array]"]=Zs["[object Int8Array]"]=Zs["[object Int16Array]"]=Zs["[object Int32Array]"]=Zs["[object Map]"]=Zs["[object Number]"]=Zs[Ys]=Zs["[object RegExp]"]=Zs["[object Set]"]=Zs["[object String]"]=Zs["[object Symbol]"]=Zs["[object Uint8Array]"]=Zs["[object Uint8ClampedArray]"]=Zs["[object Uint16Array]"]=Zs["[object Uint32Array]"]=!0,Zs["[object Error]"]=Zs[Vs]=Zs["[object WeakMap]"]=!1;var Xs=function e(t,n,r,i,o,a){var s,c=n&Us,u=n&Ks,f=n&qs;if(r&&(s=o?r(t,i,o,a):r(t)),void 0!==s)return s;if(!A(t))return t;var l=re(t);if(l){if(s=rs(t),!c)return Ja(t,s)}else{var p=ln(t),d=p==Vs||p==$s;if(oe(t))return Qa(t,c);if(p==Ys||p==Gs||d&&!o){if(s=u||d?{}:zs(t),!c)return u?ts(t,Xa(s,t)):es(t,Za(s,t))}else{if(!Zs[p])return o?t:{};s=Ts(t,p,c)}}a||(a=new dt);var h=a.get(t);if(h)return h;if(a.set(t,s),Ws(t))return t.forEach(function(i){s.add(e(i,n,r,i,t,a))}),s;if(Rs(t))return t.forEach(function(i,o){s.set(o,e(i,n,r,o,t,a))}),s;var m=f?u?gr:Zt:u?keysIn:Se,v=l?void 0:m(t);return $a(v||t,function(i,o){v&&(i=t[o=i]),cr(s,o,e(i,n,r,o,t,a))}),s};var Qs=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o};var Js=function(e,t){return t.length<2?e:Vn(e,Qs(t,0,-1))};var ec=function(e,t){return t=Kn(t,e),null==(e=Js(e,t))||delete e[Gn(Ia(t))]},tc="[object Object]",nc=Function.prototype,rc=Object.prototype,ic=nc.toString,oc=rc.hasOwnProperty,ac=ic.call(Object);var sc=function(e){if(!Z(e)||C(e)!=tc)return!1;var t=lr(e);if(null===t)return!0;var n=oc.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ic.call(n)==ac};var cc=function(e){return sc(e)?void 0:e},uc=d?d.isConcatSpreadable:void 0;var fc=function(e){return re(e)||ne(e)||!!(uc&&e&&e[uc])};var lc=function e(t,n,r,i,o){var a=-1,s=t.length;for(r||(r=fc),o||(o=[]);++a<s;){var c=t[a];n>0&&r(c)?n>1?e(c,n-1,r,i,o):Ut(o,c):i||(o[o.length]=c)}return o};var pc=function(e){return null!=e&&e.length?lc(e,1):[]};var dc=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},hc=Math.max;var mc=function(e,t,n){return t=hc(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=hc(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),dc(e,this,s)}};var vc=function(e){return function(){return e}},gc=G?function(e,t){return G(e,"toString",{configurable:!0,enumerable:!1,value:vc(t),writable:!0})}:tr,bc=800,yc=16,xc=Date.now;var wc=function(e){var t=0,n=0;return function(){var r=xc(),i=yc-(r-n);if(n=r,i>0){if(++t>=bc)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(gc);var _c=function(e){return wc(mc(e,void 0,pc),e+"")}(function(e,t){var n={};if(null==e)return n;var r=!1;t=Rn(t,function(t){return t=Kn(t,e),r||(r=t.length>1),t}),Ya(e,gr(e),n),r&&(n=Xs(n,7,cc));for(var i=t.length;i--;)ec(n,t[i]);return n});function jc(e,t,n,r=!1){const i=r?e.originalMarker:e;if(n.some(({object:e})=>e===i))return null;const o=a({},e),[s]=t(i,1);return o.color=s,o.colors&&o.points&&o.points.length&&(o.colors=new Array(o.points.length).fill(s)),o}const Cc=(e,t,n)=>Array.isArray(e)?e.map(e=>jc(e,t,n)).filter(Boolean):jc(e,t,n),Ac=(e,t,n)=>Array.isArray(e)?e.map(e=>jc(e,t,n,!0)).filter(Boolean):jc(e,t,n,!0);function Sc(e,t,n,r){const i=n.filter(({object:t,instanceIndex:n})=>t===e),o=i.map(({object:e,instanceIndex:t})=>t).filter(e=>"number"==typeof e),s=a({},e),c=s.points&&Math.ceil(s.points.length/r)||1,u=t(e,c),f=u[0];if(s.points&&s.points.length){const e=new Array(s.points.length).fill().map(()=>f);for(let t=0;t<c;t++)for(let n=0;n<r;n++){const i=t*r+n;i<e.length&&(e[i]=u[t])}if(s.colors=e,o.length)s.points=s.points.filter((e,t)=>!o.includes(Math.floor(t/r))),s.colors=s.colors.filter((e,t)=>!o.includes(Math.floor(t/r)));else if(i.length)return null}else if(s.color=f,i.length)return null;return s}const Ec=e=>(t,n,r)=>Array.isArray(t)?t.map(t=>Sc(t,n,r,e)).filter(Boolean):Sc(t,n,r,e);function kc(e,t){const n=[[0,0,.5],[0,0,-.5]],r=[],i=[];for(let o=0;o<e;o++){const a=2*Math.PI*o/e,s=.5*Math.cos(a),c=.5*Math.sin(a);n.push([s,c,.5],[s,c,-.5]);const u=n.length-1,f=t?0:o+1===e?2:n.length,l=o+1===e?3:n.length+1;if(r.push([u,f,l]),i.push([u,l,1]),!t){const e=n.length-2;r.push([e,u,f]),i.push([e,f,0])}}return{points:n,sideFaces:r,endCapFaces:i}}const{points:Oc,sideFaces:Mc,endCapFaces:Tc}=kc(30,!1),Dc=Ga(Oc,Mc.concat(Tc)),Pc=Ec(1);function zc(e){return n.createElement(va,i({getChildrenForHitmap:Pc},e,{reglCommand:Dc}))}const{points:Ic,sideFaces:Bc,endCapFaces:Fc}=kc(30,!0),Rc=Ga(Ic,Bc.concat(Fc)),Lc=Ec(1);function Hc(e){return n.createElement(va,i({getChildrenForHitmap:Lc},e,{reglCommand:Rc}))}const Nc=Object.freeze([0,0,1]);var Wc=n.memo(function(e){const t=_c(e,"children"),o=[],a=[];for(const t of e.children){let e,n,r,i,s,c,u,f,l;if(t.points&&2===t.points.length){const[o,a]=t.points;u=[o.x,o.y,o.z];const p=[a.x,a.y,a.z],d=li(u,p);di(l=ui([0,0,0],p,u),l),f=Di([0,0,0,0],Nc,l),i=s=t.scale.y,c=t.scale.z||.3*d,e=n=t.scale.x,r=d-c}else u=Wi(t.pose.position),_i(f=Ui(t.pose.orientation),f,Math.PI/2),l=gi([0,0,0],Nc,f),e=t.scale.y||1,n=t.scale.z||1,i=2*e,s=2*n,c=.23*(t.scale.x||1),r=.77*(t.scale.x||1);const p=fi([0,0,0],u,l,r/2),d=fi([0,0,0],u,l,r+c/2);o.push({originalMarker:t,scale:{x:e,y:n,z:r},color:t.color,pose:{position:Ki(p),orientation:qi(f)}}),a.push({originalMarker:t,scale:{x:i,y:s,z:c},color:t.color,pose:{position:Ki(d),orientation:qi(f)}})}return r.createElement(n.Fragment,null,r.createElement(zc,i({getChildrenForHitmap:Ac},t),o),r.createElement(Hc,i({getChildrenForHitmap:Ac},t),a))});const Uc=Float32Array.BYTES_PER_ELEMENT,Kc=3*Uc,qc=[1,1,1,.2],Gc={BL:0,TR:1,BR:2,TL:3},Vc=Object.keys(Gc).length,$c=`\nprecision mediump float;\n\nattribute float pointType;\n\n// per-instance attributes\nattribute vec4 colorB;\nattribute vec4 colorC;\nattribute vec3 positionA;\nattribute vec3 positionB;\nattribute vec3 positionC;\nattribute vec3 positionD;\n// per-instance pose attributes\nattribute vec3 posePosition;\nattribute vec4 poseRotation;\n\nuniform mat4 projection, view;\nuniform float viewportWidth;\nuniform float viewportHeight;\nuniform float alpha;\nuniform float thickness;\nuniform bool joined;\nuniform bool scaleInvariant;\n\nvarying vec4 vColor;\n\n${Object.keys(Gc).map(e=>`const float POINT_${e} = ${Gc[e]}.0;`).join("\n")}\n\n#WITH_POSE\n\nvec3 applyPoseInstance(vec3 point, vec4 rotation, vec3 position) {\n  // rotate the point and then add the position of the pose\n  // this function is defined in WITH_POSE\n  return rotate(point, rotation) + position;\n}\n\nvec2 rotateCCW(vec2 v) {\n  return vec2(-v.y, v.x);\n}\n\nvec2 normalizeOrZero(vec2 v) {\n  return length(v) < 0.00001 ? vec2(0, 0) : normalize(v);\n}\n\nvoid setPosition(vec4 proj, vec2 offset) {\n  gl_Position = proj;\n\n  offset *= thickness / 2.;\n\n  if (scaleInvariant) {\n    // The given thickness is a number of pixels on screen. Divide x by width/2 and\n    // y by height/2 so that they correspond to pixel distances when scaled from clip space to NDC.\n    offset.x /= viewportWidth / 2.0;\n    offset.y /= viewportHeight / 2.0;\n    // Compensate for automatic division by w\n    offset *= proj.w;\n  } else {\n    // The line thickness should be scaled the same way the camera scales other distances.\n    // projection[0].xyz is the result of projecting a unit x-vector, so its length represents\n    // how much distances are scaled by the camera projection.\n    offset *= length(projection[0].xyz);\n    offset.y *= viewportWidth / viewportHeight;\n  }\n\n  gl_Position.xy += offset;\n}\n\nvoid main () {\n  bool isStart = positionA == positionB;\n  bool isEnd = positionC == positionD;\n  bool isLeft = (pointType == POINT_TL || pointType == POINT_BL);\n  bool isTop = (pointType == POINT_TL || pointType == POINT_TR);\n  bool isEndpoint = isLeft ? isStart : isEnd;\n\n  float scale = isTop ? 1. : -1.;\n\n  mat4 projView = projection * view;\n  vec4 projA = projView * vec4(applyPose(applyPoseInstance(positionA, poseRotation, posePosition)), 1);\n  vec4 projB = projView * vec4(applyPose(applyPoseInstance(positionB, poseRotation, posePosition)), 1);\n  vec4 projC = projView * vec4(applyPose(applyPoseInstance(positionC, poseRotation, posePosition)), 1);\n  vec4 projD = projView * vec4(applyPose(applyPoseInstance(positionD, poseRotation, posePosition)), 1);\n\n  vec2 aspectVec = vec2(viewportWidth / viewportHeight, 1.0);\n  vec2 screenA = projA.xy / projA.w * aspectVec;\n  vec2 screenB = projB.xy / projB.w * aspectVec;\n  vec2 screenC = projC.xy / projC.w * aspectVec;\n  vec2 screenD = projD.xy / projD.w * aspectVec;\n\n  vec2 dirAB = normalizeOrZero(screenB - screenA);\n  vec2 dirBC = normalizeOrZero(screenC - screenB);\n  vec2 dirCD = normalizeOrZero(screenD - screenC);\n\n  vec2 perpAB = rotateCCW(dirAB); // vector perpendicular to AB\n  vec2 perpBC = rotateCCW(dirBC); // vector perpendicular to BC\n\n  vColor = isLeft ? colorB : colorC;\n  vColor.a *= alpha;\n\n  vec4 proj = isLeft ? projB : projC;\n\n  // simple case: non-joined line list\n  if (!joined || isEndpoint) {\n    setPosition(proj, scale * perpBC);\n    return;\n  }\n\n  // clamp to prevent rounding errors from breaking the sqrt()s below\n  float cosB = clamp(-dot(dirAB, dirBC), -1., 1.);\n  float cosC = clamp(-dot(dirBC, dirCD), -1., 1.);\n\n  bool tooSharpB = cosB > 0.01;\n  bool tooSharpC = cosC > 0.01;\n  bool tooSharp = isLeft ? tooSharpB : tooSharpC;\n\n  bool turningRightB = dot(dirAB, rotateCCW(dirBC)) > 0.;\n  bool turningRightC = dot(dirBC, rotateCCW(dirCD)) > 0.;\n  bool turningRight = isLeft ? turningRightB : turningRightC;\n\n  if (tooSharp) {\n    // "fold join"\n    vec2 perp = isLeft ? perpAB : perpBC;\n    vec2 dir = isLeft ? dirAB : dirBC;\n    float scalePerp = isLeft ? -1. : 1.;\n    float scaleDir = (turningRight == isLeft) ? 1. : -1.;\n    float tanHalfB = sqrt((1. - cosB) / (1. + cosB));\n    float tanHalfC = sqrt((1. - cosC) / (1. + cosC));\n    float tanHalf = isLeft ? tanHalfB : tanHalfC;\n    setPosition(proj, scale * (scalePerp * perp + scaleDir * dir * tanHalf));\n  } else {\n    // miter join\n    vec2 bisectorB = rotateCCW(normalize(dirAB + dirBC)); // angle bisector of ABC\n    vec2 bisectorC = rotateCCW(normalize(dirBC + dirCD)); // angle bisector of BCD\n    vec2 bisector = isLeft ? bisectorB : bisectorC;\n    float sinHalfB = sqrt((1. - cosB) / 2.);\n    float sinHalfC = sqrt((1. - cosC) / 2.);\n    float sinHalf = isLeft ? sinHalfB : sinHalfC;\n    setPosition(proj, scale * bisector / sinHalf);\n  }\n}\n`;const Yc=e=>{const t=e.buffer({type:"uint16",usage:"static",data:[Gc.TL,Gc.BL,Gc.TR,Gc.BR]}),n=e.buffer({type:"float",usage:"static",data:[[0,1,1,1],[1,0,0,1],[0,1,0,1],[1,0,1,1]]}),r=e.buffer({type:"float",usage:"static",data:pc(new Array(Vc).fill([0,0,0]))}),i=e.buffer({type:"float",usage:"static",data:pc(new Array(Vc).fill([0,0,0,1]))}),o=e.buffer({type:"float"}),a=e.buffer({type:"float"}),s=e.buffer({type:"float"}),c=e.buffer({type:"float"}),u=e.buffer({type:"float"}),f=e(ro({vert:$c,frag:"\nprecision mediump float;\nvarying vec4 vColor;\nvoid main () {\n  gl_FragColor = vColor;\n}\n",blend:to,uniforms:{thickness:e.prop("scale.x"),viewportWidth:e.context("viewportWidth"),viewportHeight:e.context("viewportHeight"),alpha:e.prop("alpha"),joined:e.prop("joined"),scaleInvariant:e.prop("scaleInvariant")},attributes:{pointType:t,colorB:(e,{joined:t,monochrome:r,debug:i})=>({buffer:i?n:o,offset:0,stride:4*(t||r||i?1:2)*Uc,divisor:r||i?0:1}),colorC:(e,{joined:t,monochrome:r,debug:i})=>({buffer:i?n:o,offset:r||i?0:4*Uc,stride:4*(t||r||i?1:2)*Uc,divisor:r||i?0:1}),positionA:(e,{joined:t})=>({buffer:a,offset:0,stride:(t?1:2)*Kc,divisor:1}),positionB:(e,{joined:t})=>({buffer:a,offset:Kc,stride:(t?1:2)*Kc,divisor:1}),positionC:(e,{joined:t})=>({buffer:s,offset:2*Kc,stride:(t?1:2)*Kc,divisor:1}),positionD:(e,{joined:t})=>({buffer:s,offset:3*Kc,stride:(t?1:2)*Kc,divisor:1}),posePosition:(e,{hasInstancedPoses:t})=>({buffer:t?c:r,divisor:t?1:0}),poseRotation:(e,{hasInstancedPoses:t})=>({buffer:t?u:i,divisor:t?1:0})},count:Vc,instances:e.prop("instances"),primitive:e.prop("primitive")}));let l=new Float32Array(4*Vc),p=new Float32Array(0),d=0,h=new Float32Array(0),m=new Float32Array(0);function v(e){return ao(e)?e.map(Vi):e}const g=(t,n)=>{t?e({depth:{enable:!1}})(n):n()};function b(e){const{debug:t,primitive:n="lines",scaleInvariant:r=!1}=e,i=e.points.length;if(i<2)return;const b=i>2&&function(e,t){const[n,r,i]=ao(e)?Wi(e):e,[o,a,s]=ao(t)?Wi(t):t;return n===o&&r===a&&i===s}(e.points[0],e.points[i-1]),y=!b&&e.closed;!function(e,t,n){const r=e.length+(n?3:2);d<r&&(p=new Float32Array(3*r),d=r),e.forEach((e,t)=>{const[n,r,i]=ao(e)?Wi(e):e,o=3+3*t;p[o+0]=n,p[o+1]=r,p[o+2]=i});const i=3*r;t?(p.copyWithin(0,i-9,i-6),p.copyWithin(i-3,6,9)):n?(p.copyWithin(0,i-9,i-6),p.copyWithin(i-6,3,9)):(p.copyWithin(0,3,6),p.copyWithin(i-3,i-6,i-3))}(e.points,b,y),a({data:p,usage:"dynamic"}),s({data:p,usage:"dynamic"});const x=!(e.colors&&e.colors.length);!function(e,t,n,r){if(n){l.length<4*Vc&&(l=new Float32Array(4*Vc));const t=e||qc,[n]=v([t]),[r,i,o,a]=n;for(let e=0;e<Vc;e++){const t=4*e;l[t+0]=r,l[t+1]=i,l[t+2]=o,l[t+3]=a}}else if(t){const e=r?t.length+1:t.length;l.length<4*e&&(l=new Float32Array(4*e));const n=v(t);for(let e=0;e<n.length;e++){const t=4*e,[r,i,o,a]=n[e];l[t+0]=r,l[t+1]=i,l[t+2]=o,l[t+3]=a}if(r){const[t,r,i,o]=n[0],a=e-1;l[4*a+0]=t,l[4*a+1]=r,l[4*a+2]=i,l[4*a+3]=o}}}(e.color,e.colors,x,y),o({data:l,usage:"dynamic"});const w="line strip"===n,_=i+(y?1:0),j=w?_-1:Math.floor(_/2),{poses:C}=e,A=!!C&&C.length>0;if(A&&C){if(j!==C.length)return void console.error(`Expected ${j} poses but given ${C.length} poses: will result in webgl error.`);!function(e,t){h.length<3*e&&(h=new Float32Array(3*e),m=new Float32Array(4*e));for(let e=0;e<t.length;e++){const n=3*e,r=4*e,{position:i,orientation:o}=t[e],a=Array.isArray(i)?i:Wi(i);h[n+0]=a[0],h[n+1]=a[1],h[n+2]=a[2];const s=Array.isArray(o)?o:[o.x,o.y,o.z,o.w];m[r+0]=s[0],m[r+1]=s[1],m[r+2]=s[2],m[r+3]=s[3]}}(j,C),c({data:h,usage:"dynamic"}),u({data:m,usage:"dynamic"})}g(t,()=>{f(Object.assign({},e,{joined:w,primitive:"triangle strip",alpha:t?.2:1,monochrome:x,instances:j,scaleInvariant:r,hasInstancedPoses:A})),t&&f(Object.assign({},e,{joined:w,primitive:"line strip",alpha:1,monochrome:x,instances:j,scaleInvariant:r,hasInstancedPoses:A}))})}return e=>{Array.isArray(e)?e.forEach(b):b(e)}};function Zc(e){return n.createElement(va,i({getChildrenForHitmap:Cc},e,{reglCommand:Yc}))}const Xc=e=>({x:e[0],y:e[1],z:e[2]}),Qc=100,Jc={orientation:{x:0,y:0,z:0,w:0},position:{x:0,y:0,z:0}};class eu extends r.Component{render(){return r.createElement(Zc,null,this.props.children)}}o(eu,"defaultProps",{children:[{pose:Jc,points:[[-Qc,0,0],[Qc,0,0]].map(Xc),scale:{x:.5,y:.5,z:.5},color:{r:.95,g:.26,b:.4,a:1}},{pose:Jc,points:[[0,-100,0],[0,100,0]].map(Xc),scale:{x:.5,y:.5,z:.5},color:{r:.02,g:.82,b:.49,a:1}},{pose:Jc,points:[[0,0,-100],[0,0,100]].map(Xc),scale:{x:.5,y:.5,z:.5},color:{r:.11,g:.51,b:.92,a:1}}]});const tu=Ga([[-.5,-.5,-.5],[-.5,.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,-.5,.5],[-.5,.5,.5],[.5,-.5,.5],[.5,.5,.5]],[[0,1,2],[1,2,3],[4,5,6],[5,6,7],[0,2,4],[2,4,6],[1,3,5],[3,5,7],[2,3,6],[3,6,7],[0,1,4],[1,4,5]]),nu=Ec(1);const ru=[[0,0,.5],[0,0,-.5]],iu=[];for(let e=0;e<15;e++){for(let t=0;t<15;t++){const n=(e+1)/16*Math.PI,r=.5*Math.cos(n),i=.5*Math.sin(n),o=2*t*Math.PI/15,a=i*Math.cos(o),s=i*Math.sin(o);if(ru.push([a,s,r]),t>0){const t=0===e?0:ru.length-1-15;iu.push([ru.length-2,ru.length-1,t]),e>0&&iu.push([ru.length-2,t-1,t])}}const t=0===e?0:ru.length-30;iu.push([ru.length-1,ru.length-15,t]),e>0&&iu.push([ru.length-1,ru.length-15-1,t])}for(let e=0;e<15;e++){const t=ru.length-15+e,n=0===e?ru.length-1:t-1;iu.push([t,n,1])}const ou=Ga(ru,iu),au=Ec(1);function su(e){return n.createElement(va,i({getChildrenForHitmap:au},e,{reglCommand:ou}))}function cu(e,t){return{x:e.x*t,y:e.y*t,z:e.z*t}}const uu=[1,1,1,1],fu=[.8,0,.8,1],lu=[1,.2,1,1],pu="line strip",du={x:.1,y:.1,z:.1},hu=cu(du,1.3),mu={x:.5,y:.5,z:.5},vu=cu(mu,1.3),gu={position:{x:0,y:0,z:0},orientation:{x:0,y:0,z:0,w:0}};let bu=1;class yu{constructor(e){o(this,"id",void 0),o(this,"point",void 0),o(this,"active",!1),this.id=bu++,this.point=e}}class xu{constructor(e=""){o(this,"id",void 0),o(this,"name",void 0),o(this,"points",[]),o(this,"active",!1),this.name=e,this.id=bu++}}const wu=(e,t,n)=>e.map(e=>{if(n.some(({object:t})=>t===e))return null;const r=a({},e),[i]=t(e.originalMarker,1);return r.scale=mu,r.color=i,r.colors&&r.points&&r.points.length&&(r.colors=new Array(r.points.length).fill(i)),r}).filter(Boolean);class _u extends r.Component{render(){const e=this.props.children,t=[];for(const n of e){const e=n.active?fu:uu,r=n.points.map(({point:e})=>Ki(e));t.push({primitive:pu,pose:gu,points:r,scale:du,color:$i(e),originalMarker:n})}return r.createElement(Zc,{getChildrenForHitmap:wu},t)}}const ju=(e,t,n)=>e.map(e=>{if(n.some(({object:t})=>t===e))return null;const r=a({},e);return r.colors=r.colors.map((n,r)=>t(e.originalMarkers[r],1)),r.scale=vu,r}).filter(Boolean);class Cu extends r.Component{render(){const e=this.props.children,t={points:[],colors:[],pose:gu,scale:hu,originalMarkers:[]};for(const n of e){const e=n.active?fu:uu;for(const r of n.points){const n=Ki(r.point);t.points.push(n),t.colors.push(r.active?lu:e),t.originalMarkers.push(r)}}return r.createElement(su,{getChildrenForHitmap:ju},[t])}}function Au(e,t,n,r,i,o,a){var s;i?(s=((o-e)*n+(a-t)*r)/i)<0?s=0:s>1&&(s=1):s=0;var c=o-(e+s*n),u=a-(t+s*r);return c*c+u*u}function Su(e,t,n,r,i,o){var a=n-e,s=r-t;return Au(e,t,a,s,a*a+s*s,i,o)}function Eu(e,t,n,r,i,o){return Math.sqrt(Su(e,t,n,r,i,o))}Eu.squared=Su,Eu.squaredWithPrecalc=Au;var ku=Eu;function Ou(e,t){const[n,r,i]=e.point,[o,a,s]=t.point;return n===o&&r===a&&i===s}function Mu(e){const{points:t}=e;for(let e=0;e<t.length-1;e++)if(Ou(t[e],t[e+1]))return!0;return Ou(t[0],t[t.length-1])}function Tu(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Du=zu,Pu=zu;function zu(e,t,n){n=n||2;var r,i,o,a,s,c,u,f=t&&t.length,l=f?t[0]*n:e.length,p=Iu(e,0,l,n,!0),d=[];if(!p||p.next===p.prev)return d;if(f&&(p=function(e,t,n,r){var i,o,a,s,c,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(c=Iu(e,a,s,r,!1))===c.next&&(c.steiner=!0),u.push(qu(c));for(u.sort(Wu),i=0;i<u.length;i++)Uu(u[i],n),n=Bu(n,n.next);return n}(e,t,p,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var h=n;h<l;h+=n)(s=e[h])<r&&(r=s),(c=e[h+1])<i&&(i=c),s>o&&(o=s),c>a&&(a=c);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return Fu(p,d,n,r,i,u),d}function Iu(e,t,n,r,i){var o,a;if(i===nf(e,t,n,r)>0)for(o=t;o<n;o+=r)a=Ju(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=Ju(o,e[o],e[o+1],a);return a&&Yu(a,a.next)&&(ef(a),a=a.next),a}function Bu(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Yu(r,r.next)&&0!==$u(r.prev,r,r.next))r=r.next;else{if(ef(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Fu(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Ku(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,c,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(e,r,i,o);for(var s,c,u=e;e.prev!==e.next;)if(s=e.prev,c=e.next,o?Lu(e,r,i,o):Ru(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),ef(e),e=c.next,u=c.next;else if((e=c)===u){a?1===a?Fu(e=Hu(e,t,n),t,n,r,i,o,2):2===a&&Nu(e,t,n,r,i,o):Fu(Bu(e),t,n,r,i,o,1);break}}}function Ru(e){var t=e.prev,n=e,r=e.next;if($u(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Gu(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&$u(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Lu(e,t,n,r){var i=e.prev,o=e,a=e.next;if($u(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,f=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=Ku(s,c,t,n,r),p=Ku(u,f,t,n,r),d=e.prevZ,h=e.nextZ;d&&d.z>=l&&h&&h.z<=p;){if(d!==e.prev&&d!==e.next&&Gu(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$u(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,h!==e.prev&&h!==e.next&&Gu(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&$u(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;d&&d.z>=l;){if(d!==e.prev&&d!==e.next&&Gu(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$u(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;h&&h.z<=p;){if(h!==e.prev&&h!==e.next&&Gu(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&$u(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function Hu(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Yu(i,o)&&Zu(i,r,r.next,o)&&Xu(i,o)&&Xu(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),ef(r),ef(r.next),r=e=o),r=r.next}while(r!==e);return r}function Nu(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Vu(a,s)){var c=Qu(a,s);return a=Bu(a,a.next),c=Bu(c,c.next),Fu(a,t,n,r,i,o),void Fu(c,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Wu(e,t){return e.x-t.x}function Uu(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var c,u=n,f=n.x,l=n.y,p=1/0;r=n.next;for(;r!==u;)i>=r.x&&r.x>=f&&i!==r.x&&Gu(o<l?i:a,o,f,l,o<l?a:i,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(i-r.x))<p||c===p&&r.x>n.x)&&Xu(r,e)&&(n=r,p=c),r=r.next;return n}(e,t)){var n=Qu(t,e);Bu(n,n.next)}}function Ku(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qu(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Gu(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Vu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Zu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&Xu(e,t)&&Xu(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function $u(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Yu(e,t){return e.x===t.x&&e.y===t.y}function Zu(e,t,n,r){return!!(Yu(e,t)&&Yu(n,r)||Yu(e,r)&&Yu(n,t))||$u(e,t,n)>0!=$u(e,t,r)>0&&$u(n,r,e)>0!=$u(n,r,t)>0}function Xu(e,t){return $u(e.prev,e,e.next)<0?$u(e,t,e.next)>=0&&$u(e,e.prev,t)>=0:$u(e,t,e.prev)<0||$u(e,e.next,t)<0}function Qu(e,t){var n=new tf(e.i,e.x,e.y),r=new tf(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ju(e,t,n,r){var i=new tf(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ef(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function tf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nf(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}zu.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(nf(e,0,o,n));if(i)for(var s=0,c=t.length;s<c;s++){var u=t[s]*n,f=s<c-1?t[s+1]*n:e.length;a-=Math.abs(nf(e,u,f,n))}var l=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,d=r[s+1]*n,h=r[s+2]*n;l+=Math.abs((e[p]-e[h])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[h+1]-e[p+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},zu.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},Du.default=Pu;const rf=!0,of=!1,af=!0,sf=!0,cf=e=>{const t=e((e=>ro({primitive:"triangles",vert:"\n  precision mediump float;\n\n  attribute vec3 point;\n\n  uniform mat4 projection, view;\n\n  #WITH_POSE\n\n  void main () {\n    vec3 pos = applyPose(point);\n    gl_Position = projection * view * vec4(pos, 1);\n  }\n  ",frag:"\n  precision mediump float;\n  uniform vec4 color;\n  void main () {\n    gl_FragColor = color;\n  }\n  ",attributes:{point:(e,t)=>ao(t.points)?Gi(t.points):t.points,color:(e,t)=>ao(t.colors)||ao(t.color)?io(t):t.color||t.colors},uniforms:{color:(e,t)=>ao(t.color)?Vi(t.color):t.color},depth:{enable:(e,t)=>t.depth&&t.depth.enable||rf,mask:(e,t)=>t.depth&&t.depth.mask||of},blend:to,count:(e,t)=>t.points.length}))()),n=e((e=>ro({primitive:"triangles",vert:"\n  precision mediump float;\n\n  attribute vec3 point;\n  attribute vec4 color;\n\n  uniform mat4 projection, view;\n\n  varying vec4 vColor;\n\n  #WITH_POSE\n\n  void main () {\n    vec3 pos = applyPose(point);\n    vColor = color;\n    gl_Position = projection * view * vec4(pos, 1);\n  }\n  ",frag:"\n  precision mediump float;\n  varying vec4 vColor;\n  void main () {\n    gl_FragColor = vColor;\n  }\n  ",attributes:{point:(e,t)=>ao(t.points)?Gi(t.points):t.points,color:(e,t)=>ao(t.colors)||ao(t.color)?io(t):t.color||t.colors},depth:{enable:(e,t)=>t.depth&&t.depth.enable||af,mask:(e,t)=>t.depth&&t.depth.mask||sf},blend:to,count:(e,t)=>t.points.length}))());return(e,r)=>{const i=Array.isArray(e)?e:[e],o=[],a=[];i.forEach(e=>{!r&&e.onlyRenderInHitmap||(e.colors&&e.colors.length?a.push(e):o.push(e))}),t(o),n(a)}},uf=Ec(3);function ff(e){return n.createElement(va,i({getChildrenForHitmap:uf},e,{reglCommand:cf}))}const lf={position:{x:0,y:0,z:0},orientation:{x:0,y:0,z:0,w:0}},pf={x:1,y:1,z:1};function df(e){const t=function(e){const t=new Float32Array(3*e.length);for(let n=0;n<e.length;n++){const[r,i,o]=e[n];t[3*n]=r,t[3*n+1]=i,t[3*n+2]=o}return t}(e),n=Du(t,null,3),r=[];for(let t=0;t<n.length;t++){const i=n[t];r.push(e[i])}return r}function hf(e){return"object"!=typeof e&&"function"!=typeof e||null===e}function mf(){this.childBranches=new WeakMap,this.primitiveKeys=new Map,this.hasValue=!1,this.value=void 0}mf.prototype.has=function(e){var t=hf(e)?this.primitiveKeys.get(e):e;return!!t&&this.childBranches.has(t)},mf.prototype.get=function(e){var t=hf(e)?this.primitiveKeys.get(e):e;return t?this.childBranches.get(t):void 0},mf.prototype.resolveBranch=function(e){if(this.has(e))return this.get(e);var t=new mf,n=this.createKey(e);return this.childBranches.set(n,t),t},mf.prototype.setValue=function(e){return this.hasValue=!0,this.value=e},mf.prototype.createKey=function(e){if(hf(e)){var t={};return this.primitiveKeys.set(e,t),t}return e},mf.prototype.clear=function(){if(0===arguments.length)this.childBranches=new WeakMap,this.primitiveKeys.clear(),this.hasValue=!1,this.value=void 0;else if(1===arguments.length){var e=arguments[0];if(hf(e)){var t=this.primitiveKeys.get(e);t&&(this.childBranches.delete(t),this.primitiveKeys.delete(e))}else this.childBranches.delete(e)}else{var n=arguments[0];if(this.has(n)){var r=this.get(n);r.clear.apply(r,Array.prototype.slice.call(arguments,1))}}};var vf=function(e){var t=new mf;function n(){var n=Array.prototype.slice.call(arguments),r=n.reduce(function(e,t){return e.resolveBranch(t)},t);if(r.hasValue)return r.value;var i=e.apply(null,n);return r.setValue(i)}return n.clear=t.clear.bind(t),n};function gf(e){if(void 0!==e){switch(e){case WebGLRenderingContext.NEAREST:return"nearest";case WebGLRenderingContext.LINEAR:return"linear";case WebGLRenderingContext.NEAREST_MIPMAP_NEAREST:return"nearest mipmap nearest";case WebGLRenderingContext.NEAREST_MIPMAP_LINEAR:return"nearest mipmap linear";case WebGLRenderingContext.LINEAR_MIPMAP_NEAREST:return"linear mipmap nearest";case WebGLRenderingContext.LINEAR_MIPMAP_LINEAR:return"linear mipmap linear";case WebGLRenderingContext.REPEAT:return"repeat";case WebGLRenderingContext.CLAMP_TO_EDGE:return"clamp";case WebGLRenderingContext.MIRRORED_REPEAT:return"mirror"}throw new Error(`unhandled constant value ${JSON.stringify(e)}`)}}const bf=e=>{const t=e({primitive:"triangles",blend:to,uniforms:{globalAlpha:e.context("globalAlpha"),poseMatrix:e.context("poseMatrix"),baseColorTexture:e.prop("baseColorTexture"),baseColorFactor:e.prop("baseColorFactor"),nodeMatrix:e.prop("nodeMatrix"),"light.direction":[0,0,-1],"light.ambientIntensity":.5,"light.diffuseIntensity":.5,hitmapColor:e.context("hitmapColor"),isHitmap:e.context("isHitmap")},attributes:{position:e.prop("positions"),normal:e.prop("normals"),texCoord:e.prop("texCoords")},elements:e.prop("indices"),vert:"\n  uniform mat4 projection, view;\n  uniform mat4 nodeMatrix;\n  uniform mat4 poseMatrix;\n  attribute vec3 position, normal;\n  varying vec3 vNormal;\n  attribute vec2 texCoord;\n  varying vec2 vTexCoord;\n\n  void main() {\n    // using the projection matrix for normals breaks lighting for orthographic mode\n    mat4 mv = view * poseMatrix * nodeMatrix;\n    vNormal = normalize((mv * vec4(normal, 0)).xyz);\n    vTexCoord = texCoord;\n    gl_Position = projection * mv * vec4(position, 1);\n  }\n  ",frag:"\n  precision mediump float;\n  uniform bool isHitmap;\n  uniform vec4 hitmapColor;\n  uniform float globalAlpha;\n  uniform sampler2D baseColorTexture;\n  uniform vec4 baseColorFactor;\n  varying mediump vec2 vTexCoord;\n  varying mediump vec3 vNormal;\n\n  // Basic directional lighting from:\n  // http://ogldev.atspace.co.uk/www/tutorial18/tutorial18.html\n  struct DirectionalLight {\n    mediump vec3 direction;\n    lowp float ambientIntensity;\n    lowp float diffuseIntensity;\n  };\n  uniform DirectionalLight light;\n\n  void main() {\n    vec4 baseColor = texture2D(baseColorTexture, vTexCoord) * baseColorFactor;\n    float diffuse = light.diffuseIntensity * max(0.0, dot(vNormal, -light.direction));\n    gl_FragColor = isHitmap ? hitmapColor : vec4((light.ambientIntensity + diffuse) * baseColor.rgb, baseColor.a * globalAlpha);\n  }\n  "}),n=e.buffer([0,0]),r=e.texture({data:[255,255,255,255],width:1,height:1}),i=vf(t=>{const{accessors:i}=t,o=t.json.textures&&t.json.textures.map(n=>{const r=t.json.samplers[n.sampler],i=t.images&&t.images[n.source];return e.texture({data:i,min:gf(r.minFilter),mag:gf(r.magFilter),wrapS:gf(r.wrapS),wrapT:gf(r.wrapT)})});t.images&&t.images.forEach(e=>e.close());const a=[];function s(e,c){const u=e.matrix?(f=e.matrix,(l=new Xr(16))[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l):ii(Qr(),e.rotation||[0,0,0,1],e.translation||[0,0,0],e.scale||[1,1,1]);var f,l;if(oi(u,c,u),null!=e.mesh&&function(e,s){for(const c of e.primitives){const e=t.json.materials[c.material],u=e.pbrMetallicRoughness.baseColorTexture;if(!i)throw new Error("Error decoding GLB model: Missing `accessors` in JSON data");a.push({indices:i[c.indices],positions:i[c.attributes.POSITION],normals:i[c.attributes.NORMAL],texCoords:u?i[c.attributes[`TEXCOORD_${u.texCoord||0}`]]:{divisor:1,buffer:n},baseColorTexture:u?o[u.index]:r,baseColorFactor:e.pbrMetallicRoughness.baseColorFactor||[1,1,1,1],nodeMatrix:s})}}(t.json.meshes[e.mesh],u),e.children)for(const n of e.children)s(t.json.nodes[n],u)}for(const e of t.json.scenes[t.json.scene].nodes){const n=Qr();ni(n,n,Math.PI/2),ri(n,n,Math.PI/2),s(t.json.nodes[e],n)}return a}),o=e({context:{poseMatrix:(e,t)=>ii(Qr(),Ui(t.pose.orientation),Wi(t.pose.position),t.scale?Wi(t.scale):[1,1,1]),globalAlpha:(e,t)=>null==t.alpha?1:t.alpha,hitmapColor:(e,t)=>t.color||[0,0,0,1],isHitmap:(e,t)=>!!t.isHitmap}});return(e,n)=>{const r=i(e.model);o(n?a({},e,{isHitmap:n}):e,()=>{t(r)})}};function yf(e){return n.useDebugValue(e),function(e,t){const[r,i]=n.useState();return n.useEffect(n.useCallback(()=>{let t=!1;return e().then(e=>{t||i(e)}),()=>{t=!0,i(void 0)}},t||[e]),t||[e]),r}(async()=>{if("function"==typeof e)return e();if("string"==typeof e){const t=await fetch(e);if(!t.ok)throw new Error(`failed to fetch GLTF model: ${t.status}`);return Va(await t.arrayBuffer())}throw new Error(`unsupported model prop: ${typeof e}`)},[e])}const xf=[.3,.3,.3,1];function wf(){return ro({vert:"\n    precision mediump float;\n    uniform mat4 projection, view;\n\n    attribute vec3 point;\n    attribute vec4 color;\n    varying vec4 fragColor;\n\n    void main () {\n      fragColor = color;\n      vec3 p = point;\n      gl_Position = projection * view * vec4(p, 1);\n    }\n    ",frag:"\n      precision mediump float;\n      varying vec4 fragColor;\n      void main () {\n        gl_FragColor = fragColor;\n      }\n    ",primitive:"lines",attributes:{point:(e,t)=>{const n=[],r=t.count;for(let e=-t.count;e<t.count;e++)n.push([-r,e,0]),n.push([r,e,0]),n.push([e,-r,0]),n.push([e,r,0]);return n},color:(e,t)=>{const n=t.color||xf;return new Array(4*t.count*2).fill(n)}},count:(e,t)=>{return 4*t.count*2}})}function _f(e){let{count:t}=e,n=Tu(e,["count"]);const o={count:t};return r.createElement(va,i({getChildrenForHitmap:Cc},n,{reglCommand:wf}),o)}_f.defaultProps={count:6};const jf=e=>{const[t,n]=e.limits.pointSizeDims;return ro({primitive:"points",vert:"\n    precision mediump float;\n\n    #WITH_POSE\n\n    uniform mat4 projection, view;\n    uniform float pointSize;\n\n    attribute vec3 point;\n    attribute vec4 color;\n    varying vec4 fragColor;\n    void main () {\n      gl_PointSize = pointSize;\n      vec3 pos = applyPose(point);\n      gl_Position = projection * view * vec4(pos, 1);\n      fragColor = color;\n    }\n    ",frag:"\n    precision mediump float;\n    varying vec4 fragColor;\n    void main () {\n      gl_FragColor = vec4(fragColor.x, fragColor.y, fragColor.z, 1);\n    }\n    ",attributes:{point:(e,t)=>t.points.map(e=>Array.isArray(e)?e:Wi(e)),color:(e,t)=>{return io(t)}},uniforms:{pointSize:(e,r)=>{const i=r.scale.x||1;return Math.min(n,Math.max(t,i))}},count:e.prop("points.length")})},Cf=Ec(1);const Af="#ffffff",Sf="rgba(0,0,0,0.8)",Ef=128,kf={r:1,g:1,b:1,a:1},Of={r:0,g:0,b:0,a:.8};let Mf=!1;function Tf(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}class Df{constructor(){o(this,"wrapper",document.createElement("span")),o(this,"_inner",document.createElement("span")),o(this,"_text",document.createTextNode("")),o(this,"_prevTextColor",kf),o(this,"_prevBgColor",Of),o(this,"_prevAutoBackgroundColor",null),function(){if(Mf)return;const e=document.createElement("style");e.innerHTML="\n    .regl-worldview-text-wrapper {\n      position: absolute;\n      white-space: nowrap;\n      z-index: 100;\n      pointer-events: none;\n      top: 0;\n      left: 0;\n      will-change: transform;\n    }\n    .regl-worldview-text-inner {\n      position: relative;\n      left: -50%;\n      top: -0.5em;\n      white-space: pre-line;\n    }\n  ",document.body&&document.body.appendChild(e),Mf=!0}(),this.wrapper.className="regl-worldview-text-wrapper",this._inner.className="regl-worldview-text-inner",this.wrapper.appendChild(this._inner),this._inner.appendChild(this._text),this.wrapper.style.color=Yi(kf)}update(e,t,n,r){this.wrapper.style.transform=`translate(${t.toFixed()}px,${n.toFixed()}px)`;const{color:i,colors:o=[]}=e,a=o.length>=2,s=a?o[0]:i;if(s)if(Tf(this._prevTextColor,s)||(this._prevTextColor=s,this.wrapper.style.color=Yi(s)),r||r===this._prevAutoBackgroundColor)if(r&&(!this._prevBgColor||this._prevBgColor&&!Tf(s,this._prevBgColor))){this._prevBgColor=s;const e=function({r:e,g:t,b:n}){return 54.213*e+182.376*t+18.411*n<Ef}(s)?Af:Sf;this._inner.style.background=e}else a&&this._prevBgColor&&!Tf(o[1],this._prevBgColor)&&(this._prevBgColor=o[1],this._inner.style.background=Yi(o[1]));else this._inner.style.background="transparent",this._prevBgColor=null;this._prevAutoBackgroundColor=r,this._text.textContent!==e.text&&(this._text.textContent=e.text||"")}}class Pf extends r.Component{constructor(...e){super(...e),o(this,"_context",void 0),o(this,"_textComponents",new Map),o(this,"_textContainerRef",r.createRef()),o(this,"componentWillUnmount",()=>{this._context&&this._context.unregisterPaintCallback(this.paint)}),o(this,"paint",()=>{const e=this._context,t=this._textComponents,{children:n,autoBackgroundColor:r}=this.props,{current:i}=this._textContainerRef,o=e&&e.initializedData;if(!i||!e||!o)return;const{dimension:a,dimension:{width:s,height:c}}=e,{camera:u}=o,f=new Set(t.keys());for(const e of n){const{pose:n,name:o}=e,{position:l}=n,p=this.project(l,u,a);if(!p)continue;const[d,h]=p;if(d<-10||h<-10||d>s+10||h>c+10)continue;let m=t.get(o||e);m?f.delete(o||e):(m=new Df,t.set(o||e,m),i.appendChild(m.wrapper)),m.update(e,d,h,r)}for(const e of f){const n=t.get(e);n&&(n.wrapper.remove(),t.delete(e))}}),o(this,"project",(e,t,n)=>{const r=[e.x,e.y,e.z],{left:i,top:o,width:a,height:s}=n,c=[i,o,a,s];return t.toScreenCoord(c,r)})}componentDidMount(){this._context&&this._context.registerPaintCallback(this.paint)}render(){return r.createElement(r.Fragment,null,r.createElement("div",{ref:this._textContainerRef}),r.createElement(ma.Consumer,null,e=>(e&&(this._context=e),null)))}}return o(Pf,"defaultProps",{children:[]}),e.Worldview=Ua,e.default=Ua,e.Bounds=class{constructor(){o(this,"x",void 0),o(this,"y",void 0),o(this,"z",void 0),this.x=new Ka,this.y=new Ka,this.z=new Ka}update(e){this.x.update(e.x),this.y.update(e.y),this.z.update(e.z)}},e.cameraStateSelectors=So,e.CameraStore=Mo,e.DEFAULT_CAMERA_STATE=Oo,e.eulerFromQuaternion=function(e,t){const n=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,c=i+i,u=n*a,f=r*a,l=r*s,p=i*a,d=i*s,h=i*c,m=o*a,v=o*s,g=o*c;return e[0]=1-l-h,e[3]=f-g,e[6]=p+v,e[1]=f+g,e[4]=1-u-h,e[7]=d-m,e[2]=p-v,e[5]=d+m,e[8]=1-u-l,e}(qa,t),r=n[0],i=n[3],o=n[6],a=n[4],s=n[7],c=n[5],u=n[8];return e[1]=Math.asin(o<-1?-1:o>1?1:o),Math.abs(o)<.99999?(e[0]=Math.atan2(-s,u),e[2]=Math.atan2(-i,r)):(e[0]=Math.atan2(c,a),e[2]=0),e},e.fromGeometry=Ga,e.parseGLB=Va,e.WorldviewReactContext=ma,e.pointToVec3=Wi,e.orientationToVec4=Ui,e.vec3ToPoint=Ki,e.vec4ToOrientation=qi,e.pointToVec3Array=Gi,e.toRGBA=Vi,e.vec4ToRGBA=$i,e.getCSSColor=Yi,e.defaultReglBlend=Qi,e.defaultReglDepth=Ji,e.defaultDepth=eo,e.defaultBlend=to,e.blend=no,e.withPose=ro,e.getVertexColors=io,e.colorBuffer=oo,e.shouldConvert=ao,e.intToRGB=so,e.getIdFromColor=function(e){const t=255*e[0],n=255*e[1];return 255*e[2]|n<<8|t<<16},e.getIdFromPixel=co,e.getIdsFromPixels=uo,e.fromSpherical=fo,e.Ray=xa,e.getRayFromClick=wa,e.Arrows=Wc,e.Axes=eu,e.Command=va,e.SUPPORTED_MOUSE_EVENTS=["onClick","onMouseUp","onMouseMove","onMouseDown","onDoubleClick"],e.Cones=Hc,e.Cubes=function(e){return n.createElement(va,i({getChildrenForHitmap:nu},e,{reglCommand:tu}))},e.Cylinders=zc,e.DrawPolygons=function({children:e=[]}){return 0===e.length?null:r.createElement(r.Fragment,null,r.createElement(_u,null,e),r.createElement(Cu,null,e))},e.Polygon=xu,e.PolygonPoint=yu,e.PolygonBuilder=class{constructor(e=[]){o(this,"mouseDown",!1),o(this,"polygons",void 0),o(this,"onChange",()=>{}),o(this,"activePolygon",void 0),o(this,"activePoint",void 0),o(this,"mouseDownPoint",void 0),o(this,"onMouseMove",(e,t)=>{if(this.activePolygon&&(e.preventDefault(),e.stopPropagation()),!this.mouseDown)return;if(!t)return;if(!this.activePoint&&!this.activePolygon)return;const{ray:n}=t,r=n.planeIntersection([0,0,0],[0,0,1]);if(!r)return;const{activePolygon:i}=this;if(this.activePoint)this.updateActivePoint(r);else if(i&&this.mouseDownPoint){const[e,t]=r,[n,o]=this.mouseDownPoint,a=e-n,s=t-o;this.mouseDownPoint=r;const c=i.points.reduce((e,t)=>(e.includes(t)||e.push(t),e),[]);for(const e of c){const{point:t}=e;t[0]=t[0]+a,t[1]=t[1]+s}this.onChange()}}),o(this,"onKeyDown",e=>{const{activePolygon:t}=this;if(t)switch(e.key){case"Delete":case"Backspace":this.activePoint?this.deletePoint(this.activePoint):this.deletePolygon(t),this.onChange()}}),o(this,"onMouseUp",(e,t)=>{e.ctrlKey||(this.mouseDown=!1)}),o(this,"onDoubleClick",(e,t)=>{if(!t)return;if(!t.objects.length)return;if(this.selectObject(t.objects[0].object),this.activePoint)return void this.deletePoint(this.activePoint);const{activePolygon:n}=this;if(!n)return;let r=Number.MAX_SAFE_INTEGER,i=-1;const{ray:o}=t,a=o.planeIntersection([0,0,0],[0,0,1]);if(!a)return;const[s,c]=a,{points:u}=n;for(let e=0;e<u.length-1;e++){const t=u[e],n=u[e+1],[o,a]=t.point,[f,l]=n.point,p=ku.squared(o,a,f,l,s,c);p<r&&(r=p,i=e)}if(i>-1){const e=new yu(a);n.points.splice(i+1,0,e),this.activePoint=e}this.onChange()}),o(this,"onMouseDown",(e,t)=>{if(!t)return;const{ray:n}=t,r=n.planeIntersection([0,0,0],[0,0,1]);if(!r)return;const i=!this.mouseDown;this.mouseDown=!0,this.mouseDownPoint=r;const o=e.ctrlKey;if(i&&!o){const e=t.objects[0];return this.selectObject(e&&e.object),this.onChange()}return o?(this.pushPoint(r),this.onChange()):(this.closeActivePolygon(),this.onChange())}),this.polygons=e}isActivePolygonClosed(){return!!this.activePolygon&&Mu(this.activePolygon)}addPolygon(e){const{points:t,name:n}=e;if(t.length<3)return;this.selectObject();const r=new xu(n);r.points=t.map(e=>new yu([e.x,e.y,e.z||0])),Mu(r)||r.points.push(r.points[0]),this.polygons.push(r)}pushPoint(e){const{activePolygon:t}=this;if(t&&!Mu(t)){const n=new yu(e);return t.points.push(n),void this.selectObject(n)}const n=new xu;n.points.push(new yu(e));const r=new yu(e);n.points.push(r),this.polygons.push(n),this.selectObject(r),this.onChange()}updateActivePoint(e){this.activePoint&&(this.activePoint.point=e,this.onChange())}closeActivePolygon(){const e=this.activePolygon;e&&(2===e.points.length?this.deletePolygon(e):e.points.push(e.points[0]),this.onChange())}deletePolygon(e){this.polygons=this.polygons.filter(t=>t!==e),this.activePolygon=null}deletePoint(e){const{activePolygon:t}=this;if(!t)return;const n=t.points.filter(t=>t.id!==e.id);n.length===t.points.length-2&&n.push(n[0]),t.points=n,this.activePoint=null,t.points.length<4&&this.deletePolygon(t),this.onChange()}selectObject(e){this.activePolygon=null,this.activePoint&&(this.activePoint.active=!1),this.activePoint=null;for(const t of this.polygons){let n=t===e;t.active=n,n&&(this.activePolygon=t);for(const r of t.points)r===e&&(this.activePoint=r,r.active=!0,t.active=!0,this.activePolygon=t,n=!0)}this.onChange()}},e.FilledPolygons=function(e){let{children:t=[]}=e,n=Tu(e,["children"]);const o=t.map(e=>{const t=ao(e.points)?e.points.map(Wi):e.points,n=e.pose?e.pose:lf;return a({},e,{points:df(t),pose:n,scale:pf,originalMarker:e})});return r.createElement(ff,i({getChildrenForHitmap:Ac},n),o)},e.GLTFScene=function(e){const{children:t,model:o}=e,s=Tu(e,["children","model"]),c=n.useContext(ma),u=yf(o);return n.useEffect(()=>{c&&c.onDirty()},[c,u]),u?r.createElement(va,i({},s,{reglCommand:bf,getChildrenForHitmap:Ac}),a({},t,{model:u,originalMarker:t})):null},e.Grid=_f,e.Lines=Zc,e.Overlay=class extends n.Component{constructor(...e){super(...e),o(this,"_context",void 0),o(this,"state",{items:[]}),o(this,"componentWillUnmount",()=>{this._context&&this._context.unregisterPaintCallback(this.paint)}),o(this,"paint",()=>{const e=this._context,t=e&&e.dimension,{renderItem:n,children:r}=this.props;if(!e||!t)return;const i=r.map((r,i)=>{const o=this.project(r.pose.position,e);return n({item:r,index:i,coordinates:o,dimension:t})});this.setState({items:i})}),o(this,"project",(e,t)=>{if(!t||!t.initializedData)return;const{dimension:n}=t,{camera:r}=t.initializedData,i=[e.x,e.y,e.z],{left:o,top:a,width:s,height:c}=n,u=[o,a,s,c];return r.toScreenCoord(u,i)})}componentDidMount(){this._context&&this._context.registerPaintCallback(this.paint)}render(){return n.createElement(n.Fragment,null,n.createElement(ma.Consumer,null,e=>(e&&(this._context=e),this.state.items)))}},e.Points=function(e){return n.createElement(va,i({getChildrenForHitmap:Cf},e,{reglCommand:jf}))},e.Spheres=su,e.Text=Pf,e.Triangles=ff,e.nonInstancedGetChildrenForHitmap=Cc,e.getChildrenForHitmapWithOriginalMarker=Ac,e.createInstancedGetChildrenForHitmap=Ec,e}({},ReactDOM,React);
//# sourceMappingURL=index.umd.js.map
